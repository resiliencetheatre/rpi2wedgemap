import{O as b,_ as f,o as l,q as d,k as e,y as c,z as g,B as h,H as p,S as m,A as x}from"./_plugin-vue_export-helper-oA2e8qpL.js";import{D as u}from"./app-DgFzPxLe.js";const{Axios:O,AxiosError:U,CanceledError:y,isCancel:$,CancelToken:M,VERSION:j,all:J,Cancel:L,isAxiosError:G,spread:K,toFormData:Q,AxiosHeaders:W,HttpStatusCode:X,formToJSON:Y,getAdapter:Z,mergeConfig:tt}=b,v={name:"PingPage",data(){return{isRunning:!1,destinationHash:null,timeout:10,seq:0,pingResults:[],abortController:null}},beforeUnmount(){this.stop()},methods:{async start(){if(!this.isRunning){if(this.destinationHash==null||this.destinationHash.length!==32){u.alert("Invalid Destination Hash!");return}if(this.timeout==null||this.timeout<0){u.alert("Timeout must be a number!");return}for(this.seq=0,this.isRunning=!0,this.abortController=new AbortController;this.isRunning;)await this.ping(),await this.sleep(1e3)}},async stop(){this.isRunning=!1,this.abortController.abort()},async clear(){this.pingResults=[]},async sleep(o){return new Promise((t,n)=>setTimeout(t,o))},async ping(){var o,t;try{this.seq++;const i=(await window.axios.get(`/api/v1/ping/${this.destinationHash}/lxmf.delivery`,{signal:this.abortController.signal,params:{timeout:this.timeout}})).data.ping_result,r=`${(i.rtt*1e3).toFixed(3)}ms`,s=[`seq=${this.seq}`,`duration=${r}`,`hops_there=${i.hops_there}`,`hops_back=${i.hops_back}`];i.rssi!=null&&s.push(`rssi=${i.rssi}dBm`),i.snr!=null&&s.push(`snr=${i.snr}dB`),i.quality!=null&&s.push(`quality=${i.quality}%`),s.push(`via=${i.receiving_interface}`),this.addPingResult(s.join(" "))}catch(n){if(n instanceof y)return;console.log(n);const i=((t=(o=n.response)==null?void 0:o.data)==null?void 0:t.message)??n;this.addPingResult(`seq=${this.seq} error=${i}`)}},async dropPath(){var o,t;if(this.destinationHash==null||this.destinationHash.length!==32){u.alert("Invalid Destination Hash!");return}try{const n=await window.axios.post(`/api/v1/destination/${this.destinationHash}/drop-path`);u.alert(n.data.message)}catch(n){console.log(n);const i=((t=(o=n.response)==null?void 0:o.data)==null?void 0:t.message)??`Failed to drop path: ${n}`;u.alert(i)}},addPingResult(o){this.pingResults.push(o),this.scrollPingResultsToBottom()},scrollPingResultsToBottom:function(){this.$nextTick(()=>{setTimeout(()=>{const o=document.getElementById("results");o&&(o.scrollTop=o.scrollHeight)},0)})}}},k={class:"flex flex-col flex-1 overflow-hidden min-w-full sm:min-w-[500px] dark:bg-zinc-950"},w={class:"flex flex-col h-full space-y-2 p-2 overflow-y-auto"},_=e("div",{class:"bg-white dark:bg-zinc-800 rounded shadow"},[e("div",{class:"flex border-b border-gray-300 dark:border-zinc-700 text-gray-700 dark:text-gray-200 p-2 font-semibold"},"Ping"),e("div",{class:"dark:divide-zinc-700 text-gray-900 dark:text-gray-100 p-2"}," Only lxmf.delivery destinations can be pinged. ")],-1),z={class:"bg-white dark:bg-zinc-800 rounded shadow"},R={class:"divide-y divide-gray-300 dark:divide-zinc-700 text-gray-900 dark:text-gray-100"},C={class:"p-2"},H=e("div",{class:"text-sm font-medium text-gray-900 dark:text-gray-100"},"Destination Hash",-1),P={class:"flex"},T={class:"p-2"},q=e("div",{class:"text-sm font-medium text-gray-900 dark:text-gray-100"},"Ping Timeout (seconds)",-1),D={class:"flex"},B={class:"p-2 space-x-1"},S={class:"flex flex-col h-full bg-white dark:bg-zinc-800 rounded shadow overflow-hidden min-h-52"},A=e("div",{class:"flex border-b border-gray-300 dark:border-zinc-700 text-gray-700 dark:text-gray-200 p-2 font-semibold"},"Results",-1),E={id:"results",class:"flex flex-col h-full bg-black text-white dark:bg-zinc-800 dark:text-gray-200 p-2 overflow-y-auto overflow-x-auto font-mono whitespace-nowrap"},V={class:"w-fit"};function F(o,t,n,i,a,r){return l(),d("div",k,[e("div",w,[_,e("div",z,[e("div",R,[e("div",C,[H,e("div",P,[c(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>a.destinationHash=s),type:"text",placeholder:"e.g: 7b746057a7294469799cd8d7d429676a",class:"bg-gray-50 dark:bg-zinc-700 border border-gray-300 dark:border-zinc-600 text-gray-900 dark:text-gray-100 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 dark:focus:ring-blue-600 dark:focus:border-blue-600 block w-full p-2.5"},null,512),[[g,a.destinationHash]])])]),e("div",T,[q,e("div",D,[c(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>a.timeout=s),type:"number",placeholder:"Timeout",class:"bg-gray-50 dark:bg-zinc-700 border border-gray-300 dark:border-zinc-600 text-gray-900 dark:text-gray-100 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 dark:focus:ring-blue-600 dark:focus:border-blue-600 block w-full p-2.5"},null,512),[[g,a.timeout]])])]),e("div",B,[a.isRunning?h("",!0):(l(),d("button",{key:0,onClick:t[2]||(t[2]=(...s)=>r.start&&r.start(...s)),type:"button",class:"my-auto inline-flex items-center gap-x-1 rounded-md bg-gray-500 px-2 py-1 text-sm font-semibold text-white shadow-sm hover:bg-gray-400 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-gray-500 dark:bg-zinc-700 dark:text-white dark:hover:bg-zinc-600 dark:focus-visible:outline-zinc-500"}," Start ")),a.isRunning?(l(),d("button",{key:1,onClick:t[3]||(t[3]=(...s)=>r.stop&&r.stop(...s)),type:"button",class:"my-auto inline-flex items-center gap-x-1 rounded-md bg-gray-500 px-2 py-1 text-sm font-semibold text-white shadow-sm hover:bg-gray-400 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-gray-500 dark:bg-zinc-700 dark:text-white dark:hover:bg-zinc-600 dark:focus-visible:outline-zinc-500"}," Stop ")):h("",!0),e("button",{onClick:t[4]||(t[4]=(...s)=>r.clear&&r.clear(...s)),type:"button",class:"my-auto inline-flex items-center gap-x-1 rounded-md bg-gray-500 px-2 py-1 text-sm font-semibold text-white shadow-sm hover:bg-gray-400 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-gray-500 dark:bg-zinc-700 dark:text-white dark:hover:bg-zinc-600 dark:focus-visible:outline-zinc-500"}," Clear Results "),e("button",{onClick:t[5]||(t[5]=(...s)=>r.dropPath&&r.dropPath(...s)),type:"button",class:"my-auto inline-flex items-center gap-x-1 rounded-md bg-red-500 px-2 py-1 text-sm font-semibold text-white shadow-sm hover:bg-red-400 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-red-500"}," Drop Path ")])])]),e("div",S,[A,e("div",E,[(l(!0),d(p,null,m(a.pingResults,s=>(l(),d("div",V,x(s),1))),256))])])])])}const et=f(v,[["render",F]]);export{et as default};
