import{W as u,U as p}from"./app-0wRDqa6X.js";import{_ as f,o as a,t as n,y as m,z as b,l as e,B as d,I as x,J as y,A as l,D as _}from"./_plugin-vue_export-helper-N_0dE8fx.js";const v={name:"PropagationNodesPage",data(){return{searchTerm:"",propagationNodes:[],config:{lxmf_preferred_propagation_node_destination_hash:null}}},beforeUnmount(){u.off("message",this.onWebsocketMessage)},mounted(){u.on("message",this.onWebsocketMessage),this.getConfig(),this.loadPropagationNodes()},methods:{async onWebsocketMessage(o){const s=JSON.parse(o.data);switch(s.type){case"config":{this.config=s.config;break}}},async getConfig(){try{const o=await window.axios.get("/api/v1/config");this.config=o.data.config}catch(o){console.log(o)}},async updateConfig(o){try{const s=await window.axios.patch("/api/v1/config",o);this.config=s.data.config}catch(s){alert("Failed to save config!"),console.log(s)}},async loadPropagationNodes(){try{const o=await window.axios.get("/api/v1/lxmf/propagation-nodes",{params:{limit:500}});this.propagationNodes=o.data.lxmf_propagation_nodes}catch{}},async usePropagationNode(o){await this.updateConfig({lxmf_preferred_propagation_node_destination_hash:o})},async stopUsingPropagationNode(){await this.updateConfig({lxmf_preferred_propagation_node_destination_hash:null})},formatTimeAgo:function(o){return p.formatTimeAgo(o)}},computed:{searchedPropagationNodes(){return this.propagationNodes.filter(o=>{var t,i;const s=this.searchTerm.toLowerCase(),c=((i=(t=o.operator_display_name)==null?void 0:t.toLowerCase())==null?void 0:i.includes(s))??!1,g=o.destination_hash.toLowerCase().includes(s);return c||g})}}},k={class:"flex flex-col flex-1 overflow-hidden min-w-full sm:min-w-[500px] dark:bg-zinc-950"},w={key:0,class:"flex bg-white dark:bg-zinc-800 p-1 border-b border-gray-300 dark:border-zinc-700"},N=["placeholder"],P={class:"h-full overflow-y-auto"},C={key:0,class:"p-2 space-y-2 w-full"},z={class:"border dark:border-zinc-700 rounded bg-white dark:bg-zinc-800 shadow"},T={class:"p-1 flex"},U={class:"my-auto"},A={class:"font-semibold text-gray-900 dark:text-gray-100"},S={class:"text-sm text-gray-700 dark:text-gray-300"},B={class:"ml-auto my-auto"},D=["onClick"],L={class:"bg-gray-50 dark:bg-zinc-900 p-1"},M={class:"text-gray-500 dark:text-gray-400 text-sm"},V={key:0},W=e("span",null,[_(" • "),e("span",{class:"text-red-500 dark:text-red-400"},"Disabled by Operator")],-1),O=[W],j={key:1},F=e("span",null,[_(" • "),e("span",{class:"text-green-500 dark:text-green-400"},"Preferred")],-1),H=[F],J={key:1,class:"flex h-full"},R={class:"mx-auto my-auto text-center leading-5 text-gray-900 dark:text-gray-100"},Z={key:0,class:"flex flex-col"},E=e("div",{class:"mx-auto mb-1"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"size-6"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M2.25 13.5h3.86a2.25 2.25 0 0 1 2.012 1.244l.256.512a2.25 2.25 0 0 0 2.013 1.244h3.218a2.25 2.25 0 0 0 2.013-1.244l.256-.512a2.25 2.25 0 0 1 2.013-1.244h3.859m-19.5.338V18a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18v-4.162c0-.224-.034-.447-.1-.661L19.24 5.338a2.25 2.25 0 0 0-2.15-1.588H6.911a2.25 2.25 0 0 0-2.15 1.588L2.35 13.177a2.25 2.25 0 0 0-.1.661Z"})])],-1),I=e("div",{class:"font-semibold"},"No Propagation Nodes",-1),Y=e("div",null,"Check back later, once someone has announced.",-1),q={class:"mt-2"},G={key:1,class:"flex flex-col"},K=e("div",{class:"mx-auto mb-1"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-6 h-6"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"})])],-1),Q=e("div",{class:"font-semibold"},"No Search Results",-1),X=e("div",null,"Your search didn't match any Propagation Nodes!",-1),$=[K,Q,X];function ee(o,s,c,g,t,i){return a(),n("div",k,[t.propagationNodes.length>0?(a(),n("div",w,[m(e("input",{"onUpdate:modelValue":s[0]||(s[0]=r=>t.searchTerm=r),type:"text",placeholder:`Search ${t.propagationNodes.length} Propagation Nodes...`,class:"w-full bg-gray-50 dark:bg-zinc-700 border border-gray-300 dark:border-zinc-600 text-gray-900 dark:text-gray-100 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 dark:focus:ring-blue-600 dark:focus:border-blue-600 block w-full p-2.5"},null,8,N),[[b,t.searchTerm]])])):d("",!0),e("div",P,[i.searchedPropagationNodes.length>0?(a(),n("div",C,[(a(!0),n(x,null,y(i.searchedPropagationNodes,r=>(a(),n("div",z,[e("div",T,[e("div",U,[e("div",A,l(r.operator_display_name??"Unknown Operator"),1),e("div",S,"<"+l(r.destination_hash)+">",1)]),e("div",B,[t.config.lxmf_preferred_propagation_node_destination_hash===r.destination_hash?(a(),n("button",{key:0,onClick:s[1]||(s[1]=(...h)=>i.stopUsingPropagationNode&&i.stopUsingPropagationNode(...h)),type:"button",class:"my-auto inline-flex items-center gap-x-1 rounded-md bg-red-500 dark:bg-red-600 px-2 py-1 text-sm font-semibold text-white shadow-sm hover:bg-red-400 dark:hover:bg-red-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-red-500 dark:focus-visible:outline-red-600"}," Stop Using Node ")):(a(),n("button",{key:1,onClick:h=>i.usePropagationNode(r.destination_hash),type:"button",class:"my-auto inline-flex items-center gap-x-1 rounded-md bg-gray-500 dark:bg-zinc-600 px-2 py-1 text-sm font-semibold text-white shadow-sm hover:bg-gray-400 dark:hover:bg-zinc-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-gray-500 dark:focus-visible:outline-zinc-600"}," Set as Preferred ",8,D))])]),e("div",L,[e("div",M,[e("span",null,"Announced "+l(i.formatTimeAgo(r.updated_at)),1),r.is_propagation_enabled===!1?(a(),n("span",V,O)):d("",!0),t.config.lxmf_preferred_propagation_node_destination_hash===r.destination_hash?(a(),n("span",j,H)):d("",!0)])])]))),256))])):(a(),n("div",J,[e("div",R,[t.propagationNodes.length===0?(a(),n("div",Z,[E,I,Y,e("div",q,[e("button",{onClick:s[2]||(s[2]=(...r)=>i.loadPropagationNodes&&i.loadPropagationNodes(...r)),type:"button",class:"my-auto inline-flex items-center gap-x-1 rounded-md bg-gray-500 dark:bg-zinc-600 px-2 py-1 text-sm font-semibold text-white shadow-sm hover:bg-gray-400 dark:hover:bg-zinc-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-gray-500 dark:focus-visible:outline-zinc-600"}," Reload ")])])):d("",!0),t.searchTerm!==""&&t.propagationNodes.length>0?(a(),n("div",G,$)):d("",!0)])]))])])}const te=f(v,[["render",ee]]);export{te as default};
