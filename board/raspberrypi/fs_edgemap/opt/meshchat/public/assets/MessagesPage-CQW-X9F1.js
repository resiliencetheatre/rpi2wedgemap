import{M as Ue,U as P,D as b,W as X,G as ne,N as We,h as qe,g as Qe}from"./app-DgFzPxLe.js";import{_ as $,e as B,o as d,q as c,k as o,m as D,y as U,z as ie,B as f,H as E,S as q,v as ae,t as k,A as _,l as Xe,j as S,U as le,f as $e,x as T,V as Ge,W as Be,E as Ye}from"./_plugin-vue_export-helper-oA2e8qpL.js";import{C as de,I as Fe,D as Ke}from"./DropDownMenu-ShzKecUs.js";import{D as Je}from"./DropDownMenuItem-DgRg_tCX.js";const et={name:"MessagesSidebar",components:{MaterialDesignIcon:Ue},props:{peers:Object,conversations:Array,selectedDestinationHash:String},data(){return{tab:"conversations",conversationsSearchTerm:"",peersSearchTerm:""}},methods:{onConversationClick(t){this.$emit("conversation-click",t)},onPeerClick(t){this.$emit("peer-click",t)},formatTimeAgo:function(t){return P.formatTimeAgo(t)}},computed:{searchedConversations(){return this.conversations.filter(t=>{var n,u;const e=this.conversationsSearchTerm.toLowerCase(),s=t.display_name.toLowerCase().includes(e),i=((u=(n=t.custom_display_name)==null?void 0:n.toLowerCase())==null?void 0:u.includes(e))===!0,a=t.destination_hash.toLowerCase().includes(e);return s||i||a})},peersCount(){return Object.keys(this.peers).length},peersOrderedByLatestAnnounce(){return Object.values(this.peers).sort(function(e,s){const i=new Date(e.updated_at).getTime();return new Date(s.updated_at).getTime()-i})},searchedPeers(){return this.peersOrderedByLatestAnnounce.filter(t=>{var n,u;const e=this.peersSearchTerm.toLowerCase(),s=t.display_name.toLowerCase().includes(e),i=((u=(n=t.custom_display_name)==null?void 0:n.toLowerCase())==null?void 0:u.includes(e))===!0,a=t.destination_hash.toLowerCase().includes(e);return s||i||a})}}},tt={class:"flex flex-col w-80 min-w-80"},st={class:"bg-white dark:bg-zinc-950 border-b border-r border-gray-200 dark:border-zinc-700"},ot={class:"-mb-px flex"},nt={key:0,class:"flex-1 flex flex-col bg-white dark:bg-zinc-950 border-r border-gray-200 dark:border-zinc-700 overflow-hidden"},it={key:0,class:"p-1 border-b border-gray-300 dark:border-zinc-700"},at=["placeholder"],rt={class:"flex h-full overflow-y-auto"},lt={key:0,class:"w-full"},dt=["onClick"],ct={class:"my-auto mr-2"},ut={key:1,class:"bg-gray-200 dark:bg-zinc-700 text-gray-500 dark:text-gray-400 p-2 rounded"},ht={class:"mr-auto"},mt={class:"text-gray-500 dark:text-gray-400 text-sm"},gt={key:0,class:"my-auto ml-2 mr-2"},ft=o("div",{class:"bg-blue-500 dark:bg-blue-400 rounded-full p-1"},null,-1),vt=[ft],pt={key:1,class:"my-auto ml-2 mr-2"},yt=o("div",{class:"bg-red-500 dark:bg-red-400 rounded-full p-1"},null,-1),_t=[yt],bt={key:1,class:"mx-auto my-auto text-center leading-5"},wt={key:0,class:"flex flex-col text-gray-900 dark:text-gray-100"},xt=o("div",{class:"mx-auto mb-1"},[o("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"size-6"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M2.25 13.5h3.86a2.25 2.25 0 0 1 2.012 1.244l.256.512a2.25 2.25 0 0 0 2.013 1.244h3.218a2.25 2.25 0 0 0 2.013-1.244l.256-.512a2.25 2.25 0 0 1 2.013-1.244h3.859m-19.5.338V18a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18v-4.162c0-.224-.034-.447-.1-.661L19.24 5.338a2.25 2.25 0 0 0-2.15-1.588H6.911a2.25 2.25 0 0 0-2.15 1.588L2.35 13.177a2.25 2.25 0 0 0-.1.661Z"})])],-1),kt=o("div",{class:"font-semibold"},"No Conversations",-1),Mt=o("div",null,"Discover peers on the Announces tab",-1),Ct=[xt,kt,Mt],At={key:1,class:"flex flex-col text-gray-900 dark:text-gray-100"},Pt=o("div",{class:"mx-auto mb-1"},[o("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-6 h-6"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"})])],-1),St=o("div",{class:"font-semibold"},"No Search Results",-1),Bt=o("div",null,"Your search didn't match any Conversations!",-1),Dt=[Pt,St,Bt],Rt={key:1,class:"flex-1 flex flex-col bg-white dark:bg-zinc-950 border-r border-gray-200 dark:border-zinc-700 overflow-hidden"},Lt={key:0,class:"p-1 border-b border-gray-300 dark:border-zinc-700"},Tt=["placeholder"],zt={class:"flex h-full overflow-y-auto"},It={key:0,class:"w-full"},Ut=["onClick"],$t={class:"my-auto mr-2"},Ft={key:1,class:"bg-gray-200 dark:bg-zinc-700 text-gray-500 dark:text-gray-400 p-2 rounded"},Ot={class:"text-gray-900 dark:text-gray-100"},jt={class:"flex space-x-1 text-gray-500 dark:text-gray-400 text-sm"},Et={class:"flex my-auto space-x-1"},Nt={key:0,class:"flex my-auto text-sm text-gray-500 space-x-1"},Ht=o("span",null,"•",-1),Vt={key:0},Zt={key:1},Wt={key:1,class:"flex my-auto space-x-1"},qt=o("span",null,"•",-1),Qt={key:1,class:"mx-auto my-auto text-center leading-5"},Xt={key:0,class:"flex flex-col text-gray-900 dark:text-gray-100"},Gt=o("div",{class:"mx-auto mb-1"},[o("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-6 h-6"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442-.745.361-1.45.999-1.45 1.827v.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 5.25h.008v.008H12v-.008Z"})])],-1),Yt=o("div",{class:"font-semibold"},"No Peers Discovered",-1),Kt=o("div",null,"Waiting for someone to announce!",-1),Jt=[Gt,Yt,Kt],es={key:1,class:"flex flex-col text-gray-900 dark:text-gray-100"},ts=o("div",{class:"mx-auto mb-1"},[o("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-6 h-6"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"})])],-1),ss=o("div",{class:"font-semibold"},"No Search Results",-1),os=o("div",null,"Your search didn't match any Peers!",-1),ns=[ts,ss,os];function is(t,e,s,i,a,n){const u=B("MaterialDesignIcon");return d(),c("div",tt,[o("div",st,[o("div",ot,[o("div",{onClick:e[0]||(e[0]=l=>a.tab="conversations"),class:D(["w-full border-b-2 py-3 px-1 text-center text-sm font-medium cursor-pointer",[a.tab==="conversations"?"border-blue-500 text-blue-600 dark:border-blue-400 dark:text-blue-400":"border-transparent text-gray-500 dark:text-gray-400 hover:border-gray-300 dark:hover:border-zinc-600 hover:text-gray-700 dark:hover:text-gray-300"]])},"Conversations",2),o("div",{onClick:e[1]||(e[1]=l=>a.tab="announces"),class:D(["w-full border-b-2 py-3 px-1 text-center text-sm font-medium cursor-pointer",[a.tab==="announces"?"border-blue-500 text-blue-600 dark:border-blue-400 dark:text-blue-400":"border-transparent text-gray-500 dark:text-gray-400 hover:border-gray-300 dark:hover:border-zinc-600 hover:text-gray-700 dark:hover:text-gray-300"]])},"Announces",2)])]),a.tab==="conversations"?(d(),c("div",nt,[s.conversations.length>0?(d(),c("div",it,[U(o("input",{"onUpdate:modelValue":e[2]||(e[2]=l=>a.conversationsSearchTerm=l),type:"text",placeholder:`Search ${s.conversations.length} Conversations...`,class:"bg-gray-50 dark:bg-zinc-700 border border-gray-300 dark:border-zinc-600 text-gray-900 dark:text-gray-100 text-sm rounded-lg focus:ring-blue-500 dark:focus:ring-blue-600 focus:border-blue-500 dark:focus:border-blue-600 block w-full p-2.5"},null,8,at),[[ie,a.conversationsSearchTerm]])])):f("",!0),o("div",rt,[n.searchedConversations.length>0?(d(),c("div",lt,[(d(!0),c(E,null,q(n.searchedConversations,l=>(d(),c("div",{onClick:h=>n.onConversationClick(l),class:D(["flex cursor-pointer p-2 border-l-2",[l.destination_hash===s.selectedDestinationHash?"bg-gray-100 dark:bg-zinc-700 border-blue-500 dark:border-blue-400":"bg-white dark:bg-zinc-950 border-transparent hover:bg-gray-50 dark:hover:bg-zinc-700 hover:border-gray-200 dark:hover:border-zinc-600"]])},[o("div",ct,[l.lxmf_user_icon?(d(),c("div",{key:0,class:"p-2 rounded",style:ae({color:l.lxmf_user_icon.foreground_colour,"background-color":l.lxmf_user_icon.background_colour})},[k(u,{"icon-name":l.lxmf_user_icon.icon_name,class:"w-6 h-6"},null,8,["icon-name"])],4)):(d(),c("div",ut,[k(u,{"icon-name":"account-outline",class:"w-6 h-6"})]))]),o("div",ht,[o("div",{class:D(["text-gray-900 dark:text-gray-100",{"font-semibold":l.is_unread||l.failed_messages_count>0}])},_(l.custom_display_name??l.display_name),3),o("div",mt,_(n.formatTimeAgo(l.updated_at)),1)]),l.is_unread?(d(),c("div",gt,vt)):l.failed_messages_count?(d(),c("div",pt,_t)):f("",!0)],10,dt))),256))])):(d(),c("div",bt,[s.conversations.length===0?(d(),c("div",wt,Ct)):f("",!0),a.conversationsSearchTerm!==""&&s.conversations.length>0?(d(),c("div",At,Dt)):f("",!0)]))])])):f("",!0),a.tab==="announces"?(d(),c("div",Rt,[n.peersCount>0?(d(),c("div",Lt,[U(o("input",{"onUpdate:modelValue":e[3]||(e[3]=l=>a.peersSearchTerm=l),type:"text",placeholder:`Search ${n.peersCount} recent announces...`,class:"bg-gray-50 dark:bg-zinc-700 border border-gray-300 dark:border-zinc-600 text-gray-900 dark:text-gray-100 text-sm rounded-lg focus:ring-blue-500 dark:focus:ring-blue-600 focus:border-blue-500 dark:focus:border-blue-600 block w-full p-2.5"},null,8,Tt),[[ie,a.peersSearchTerm]])])):f("",!0),o("div",zt,[n.searchedPeers.length>0?(d(),c("div",It,[(d(!0),c(E,null,q(n.searchedPeers,l=>(d(),c("div",{onClick:h=>n.onPeerClick(l),class:D(["flex cursor-pointer p-2 border-l-2",[l.destination_hash===s.selectedDestinationHash?"bg-gray-100 dark:bg-zinc-700 border-blue-500 dark:border-blue-400":"bg-white dark:bg-zinc-950 border-transparent hover:bg-gray-50 dark:hover:bg-zinc-700 hover:border-gray-200 dark:hover:border-zinc-600"]])},[o("div",$t,[l.lxmf_user_icon?(d(),c("div",{key:0,class:"p-2 rounded",style:ae({color:l.lxmf_user_icon.foreground_colour,"background-color":l.lxmf_user_icon.background_colour})},[k(u,{"icon-name":l.lxmf_user_icon.icon_name,class:"w-6 h-6"},null,8,["icon-name"])],4)):(d(),c("div",Ft,[k(u,{"icon-name":"account-outline",class:"w-6 h-6"})]))]),o("div",null,[o("div",Ot,_(l.custom_display_name??l.display_name),1),o("div",jt,[o("span",Et,_(n.formatTimeAgo(l.updated_at)),1),l.hops!=null&&l.hops!==128?(d(),c("span",Nt,[Ht,l.hops===0||l.hops===1?(d(),c("span",Vt,"Direct")):(d(),c("span",Zt,_(l.hops)+" hops",1))])):f("",!0),l.snr!=null?(d(),c("span",Wt,[qt,o("span",null,"SNR "+_(l.snr),1)])):f("",!0)])])],10,Ut))),256))])):(d(),c("div",Qt,[n.peersCount===0?(d(),c("div",Xt,Jt)):f("",!0),a.peersSearchTerm!==""&&n.peersCount>0?(d(),c("div",es,ns)):f("",!0)]))])])):f("",!0)])}const as=$(et,[["render",is]]);class rs{constructor(){this.audioChunks=[],this.microphoneMediaStream=null,this.mediaRecorder=null}async start(){try{return this.microphoneMediaStream=await navigator.mediaDevices.getUserMedia({audio:!0}),this.mediaRecorder=new MediaRecorder(this.microphoneMediaStream),this.mediaRecorder.ondataavailable=e=>{this.audioChunks.push(e.data)},this.mediaRecorder.start(),!0}catch{return!1}}async stop(){return new Promise((e,s)=>{try{this.mediaRecorder.onstop=()=>{this.microphoneMediaStream&&this.microphoneMediaStream.getTracks().forEach(a=>a.stop());const i=new Blob(this.audioChunks,{type:this.mediaRecorder.mimeType});e(i)},this.mediaRecorder.stop()}catch(i){s(i)}})}}const ls={name:"AddAudioButton",props:{isRecordingAudioAttachment:Boolean},data(){return{isShowingMenu:!1}},methods:{showMenu(){this.isShowingMenu=!0},hideMenu(){this.isShowingMenu=!1},startRecordingAudioAttachment(t){this.isShowingMenu=!1,this.$emit("start-recording",t)},startRecordingCodec2(t){this.startRecordingAudioAttachment({codec:"codec2",mode:t})},startRecordingOpus(){this.startRecordingAudioAttachment({codec:"opus"})},stopRecordingAudioAttachment(){this.isShowingMenu=!1,this.$emit("stop-recording")}}},ds={class:"inline-flex rounded-md shadow-sm"},cs=o("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",class:"size-5"},[o("path",{d:"M7 4a3 3 0 0 1 6 0v6a3 3 0 1 1-6 0V4Z"}),o("path",{d:"M5.5 9.643a.75.75 0 0 0-1.5 0V10c0 3.06 2.29 5.585 5.25 5.954V17.5h-1.5a.75.75 0 0 0 0 1.5h4.5a.75.75 0 0 0 0-1.5h-1.5v-1.546A6.001 6.001 0 0 0 16 10v-.357a.75.75 0 0 0-1.5 0V10a4.5 4.5 0 0 1-9 0v-.357Z"})],-1),us={class:"ml-1"},hs=o("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",class:"size-5"},[o("path",{d:"M7 4a3 3 0 0 1 6 0v6a3 3 0 1 1-6 0V4Z"}),o("path",{d:"M5.5 9.643a.75.75 0 0 0-1.5 0V10c0 3.06 2.29 5.585 5.25 5.954V17.5h-1.5a.75.75 0 0 0 0 1.5h4.5a.75.75 0 0 0 0-1.5h-1.5v-1.546A6.001 6.001 0 0 0 16 10v-.357a.75.75 0 0 0-1.5 0V10a4.5 4.5 0 0 1-9 0v-.357Z"})],-1),ms=o("span",{class:"ml-1 hidden xl:inline-block whitespace-nowrap"},"Add Voice",-1),gs=[hs,ms],fs={class:"relative block"},vs={key:0,class:"absolute bottom-0 -ml-11 sm:right-0 sm:ml-0 z-10 mb-10 rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},ps={class:"py-1"};function ys(t,e,s,i,a,n){return d(),c("div",ds,[s.isRecordingAudioAttachment?(d(),c("button",{key:0,onClick:e[0]||(e[0]=(...u)=>n.stopRecordingAudioAttachment&&n.stopRecordingAudioAttachment(...u)),type:"button",class:"my-auto mr-1 inline-flex items-center gap-x-1 rounded-md bg-red-500 px-2.5 py-1.5 text-sm font-semibold text-white shadow-sm hover:bg-red-400 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-red-500 dark:bg-zinc-800 dark:text-white dark:hover:bg-zinc-700 dark:focus-visible:outline-zinc-500"},[cs,o("span",us,[Xe(t.$slots,"default")])])):(d(),c("button",{key:1,onClick:e[1]||(e[1]=(...u)=>n.showMenu&&n.showMenu(...u)),type:"button",class:"my-auto mr-1 inline-flex items-center gap-x-1 rounded-md bg-gray-500 px-2.5 py-1.5 text-sm font-semibold text-white shadow-sm hover:bg-gray-400 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-gray-500 dark:bg-zinc-800 dark:text-white dark:hover:bg-zinc-700 dark:focus-visible:outline-zinc-500"},gs)),o("div",fs,[k(le,{"enter-active-class":"transition ease-out duration-100","enter-from-class":"transform opacity-0 scale-95","enter-to-class":"transform opacity-100 scale-100","leave-active-class":"transition ease-in duration-75","leave-from-class":"transform opacity-100 scale-100","leave-to-class":"transform opacity-0 scale-95"},{default:S(()=>[a.isShowingMenu?U((d(),c("div",vs,[o("div",ps,[o("button",{onClick:e[2]||(e[2]=u=>n.startRecordingCodec2("1200")),type:"button",class:"w-full block text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 whitespace-nowrap"},"Low Quality - Codec2 (1200)"),o("button",{onClick:e[3]||(e[3]=u=>n.startRecordingCodec2("3200")),type:"button",class:"w-full block text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 whitespace-nowrap"},"Medium Quality - Codec2 (3200)"),o("button",{onClick:e[4]||(e[4]=u=>n.startRecordingOpus()),type:"button",class:"w-full block text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 whitespace-nowrap"},"High Quality - OPUS")])])),[[de,n.hideMenu]]):f("",!0)]),_:1})])])}const _s=$(ls,[["render",ys]]),bs={name:"SendMessageButton",props:{deliveryMethod:String,canSendMessage:Boolean,isSendingMessage:Boolean},data(){return{isShowingMenu:!1}},methods:{showMenu(){this.isShowingMenu=!0},hideMenu(){this.isShowingMenu=!1},setDeliveryMethod(t){this.$emit("delivery-method-changed",t),this.hideMenu()},send(){this.$emit("send")}}},ws={class:"inline-flex rounded-md shadow-sm"},xs=["disabled"],ks={key:0},Ms={key:1,class:"space-x-1"},Cs=o("span",null,"Send",-1),As={key:0},Ps={key:1},Ss={key:2},Bs={class:"relative"},Ds=["disabled"],Rs=o("svg",{class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[o("path",{"fill-rule":"evenodd",d:"M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z","clip-rule":"evenodd"})],-1),Ls=[Rs],Ts={key:0,class:"absolute bottom-0 -ml-11 right-0 ml-0 z-10 mb-10 rounded-md bg-white dark:bg-zinc-800 shadow-lg ring-1 ring-black dark:ring-zinc-700 ring-opacity-5 focus:outline-none"},zs={class:"py-1"};function Is(t,e,s,i,a,n){return d(),c("div",ws,[o("button",{onClick:e[0]||(e[0]=(...u)=>n.send&&n.send(...u)),disabled:!s.canSendMessage,type:"button",class:D(["my-auto inline-flex items-center rounded-l-md px-2.5 py-1.5 text-sm font-semibold text-white focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2",[s.canSendMessage?"bg-blue-500 dark:bg-blue-600 hover:bg-blue-400 dark:hover:bg-blue-500 focus-visible:outline-blue-500 dark:focus-visible:outline-blue-600":"bg-gray-400 dark:bg-zinc-500 focus-visible:outline-gray-500 dark:focus-visible:outline-zinc-500 cursor-not-allowed"]])},[s.isSendingMessage?(d(),c("span",ks,"Sending...")):(d(),c("span",Ms,[Cs,s.deliveryMethod==="direct"?(d(),c("span",As,"(Direct Link)")):f("",!0),s.deliveryMethod==="opportunistic"?(d(),c("span",Ps,"(Opportunistic)")):f("",!0),s.deliveryMethod==="propagated"?(d(),c("span",Ss,"(Propagated)")):f("",!0)]))],10,xs),o("div",Bs,[o("button",{onClick:e[1]||(e[1]=(...u)=>n.showMenu&&n.showMenu(...u)),disabled:!s.canSendMessage,type:"button",class:D(["my-auto border-l relative inline-flex items-center rounded-r-md px-2 py-1.5 text-white focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2",[s.canSendMessage?"bg-blue-500 dark:bg-blue-600 hover:bg-blue-400 dark:hover:bg-blue-500 focus-visible:outline-blue-500 dark:focus-visible:outline-blue-600 border-blue-600 dark:border-blue-700":"bg-gray-400 dark:bg-zinc-500 focus-visible:outline-gray-500 dark:focus-visible:outline-zinc-500 border-gray-500 dark:border-zinc-600 cursor-not-allowed"]])},Ls,10,Ds),k(le,{"enter-active-class":"transition ease-out duration-100","enter-from-class":"transform opacity-0 scale-95","enter-to-class":"transform opacity-100 scale-100","leave-active-class":"transition ease-in duration-75","leave-from-class":"transform opacity-100 scale-100","leave-to-class":"transform opacity-0 scale-95"},{default:S(()=>[a.isShowingMenu?U((d(),c("div",Ts,[o("div",zs,[o("button",{onClick:e[2]||(e[2]=u=>n.setDeliveryMethod(null)),type:"button",class:"w-full block text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-zinc-700 whitespace-nowrap border-b border-gray-200 dark:border-zinc-700"},"Send Automatically"),o("button",{onClick:e[3]||(e[3]=u=>n.setDeliveryMethod("direct")),type:"button",class:"w-full block text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-zinc-700 whitespace-nowrap"},"Send over Direct Link"),o("button",{onClick:e[4]||(e[4]=u=>n.setDeliveryMethod("opportunistic")),type:"button",class:"w-full block text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-zinc-700 whitespace-nowrap"},"Send Opportunistically"),o("button",{onClick:e[5]||(e[5]=u=>n.setDeliveryMethod("propagated")),type:"button",class:"w-full block text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-zinc-700 whitespace-nowrap"},"Send to Propagation Node")])])),[[de,n.hideMenu]]):f("",!0)]),_:1})])])}const Us=$(bs,[["render",Is]]),$s={name:"ConversationDropDownMenu",components:{IconButton:Fe,DropDownMenuItem:Je,DropDownMenu:Ke},props:{peer:Object},emits:["conversation-deleted","set-custom-display-name"],methods:{async onDeleteMessageHistory(){if(confirm("Are you sure you want to delete all messages in this conversation? This can not be undone!")){try{await window.axios.delete(`/api/v1/lxmf-messages/conversation/${this.peer.destination_hash}`)}catch(t){b.alert("failed to delete conversation"),console.log(t)}this.$emit("conversation-deleted")}},async onSetCustomDisplayName(){this.$emit("set-custom-display-name")},async onPingDestination(){var t,e;try{const i=(await window.axios.get(`/api/v1/ping/${this.peer.destination_hash}/lxmf.delivery`,{params:{timeout:30}})).data.ping_result,n=`${(i.rtt*1e3).toFixed(3)} ms`,u=[`Valid reply from ${this.peer.destination_hash}`,`Duration: ${n}`,`Hops There: ${i.hops_there}`,`Hops Back: ${i.hops_back}`];i.quality!=null&&u.push(`Signal Quality: ${i.quality}%`),i.rssi!=null&&u.push(`RSSI: ${i.rssi}dBm`),i.snr!=null&&u.push(`SNR: ${i.snr}dB`),b.alert(u.join(`
`))}catch(s){console.log(s);const i=((e=(t=s.response)==null?void 0:t.data)==null?void 0:e.message)??"Ping failed. Try again later";b.alert(i)}}}},Fs=o("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"size-5"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 6.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5ZM12 12.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5ZM12 18.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5Z"})],-1),Os=["href"],js=o("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",class:"size-5"},[o("path",{"fill-rule":"evenodd",d:"M1.5 4.5a3 3 0 0 1 3-3h1.372c.86 0 1.61.586 1.819 1.42l1.105 4.423a1.875 1.875 0 0 1-.694 1.955l-1.293.97c-.135.101-.164.249-.126.352a11.285 11.285 0 0 0 6.697 6.697c.103.038.25.009.352-.126l.97-1.293a1.875 1.875 0 0 1 1.955-.694l4.423 1.105c.834.209 1.42.959 1.42 1.82V19.5a3 3 0 0 1-3 3h-2.25C8.552 22.5 1.5 15.448 1.5 6.75V4.5Z","clip-rule":"evenodd"})],-1),Es=o("span",null,"Start a Call",-1),Ns=o("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",class:"size-5"},[o("path",{"fill-rule":"evenodd",d:"M14.615 1.595a.75.75 0 0 1 .359.852L12.982 9.75h7.268a.75.75 0 0 1 .548 1.262l-10.5 11.25a.75.75 0 0 1-1.272-.71l1.992-7.302H3.75a.75.75 0 0 1-.548-1.262l10.5-11.25a.75.75 0 0 1 .913-.143Z","clip-rule":"evenodd"})],-1),Hs=o("span",null,"Ping Destination",-1),Vs=o("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",class:"size-5"},[o("path",{"fill-rule":"evenodd",d:"M5.25 2.25a3 3 0 0 0-3 3v4.318a3 3 0 0 0 .879 2.121l9.58 9.581c.92.92 2.39 1.186 3.548.428a18.849 18.849 0 0 0 5.441-5.44c.758-1.16.492-2.629-.428-3.548l-9.58-9.581a3 3 0 0 0-2.122-.879H5.25ZM6.375 7.5a1.125 1.125 0 1 0 0-2.25 1.125 1.125 0 0 0 0 2.25Z","clip-rule":"evenodd"})],-1),Zs=o("span",null,"Set Custom Display Name",-1),Ws={class:"border-t"},qs=o("svg",{class:"size-5 text-red-500",viewBox:"0 0 20 20",fill:"currentColor"},[o("path",{"fill-rule":"evenodd",d:"M8.75 1A2.75 2.75 0 0 0 6 3.75v.443c-.795.077-1.584.176-2.365.298a.75.75 0 1 0 .23 1.482l.149-.022.841 10.518A2.75 2.75 0 0 0 7.596 19h4.807a2.75 2.75 0 0 0 2.742-2.53l.841-10.52.149.023a.75.75 0 0 0 .23-1.482A41.03 41.03 0 0 0 14 4.193V3.75A2.75 2.75 0 0 0 11.25 1h-2.5ZM10 4c.84 0 1.673.025 2.5.075V3.75c0-.69-.56-1.25-1.25-1.25h-2.5c-.69 0-1.25.56-1.25 1.25v.325C8.327 4.025 9.16 4 10 4ZM8.58 7.72a.75.75 0 0 0-1.5.06l.3 7.5a.75.75 0 1 0 1.5-.06l-.3-7.5Zm4.34.06a.75.75 0 1 0-1.5-.06l-.3 7.5a.75.75 0 1 0 1.5.06l.3-7.5Z","clip-rule":"evenodd"})],-1),Qs=o("span",{class:"text-red-500"},"Delete Message History",-1);function Xs(t,e,s,i,a,n){const u=B("IconButton"),l=B("DropDownMenuItem"),h=B("DropDownMenu");return d(),$e(h,null,{button:S(()=>[k(u,null,{default:S(()=>[Fs]),_:1})]),items:S(()=>[o("a",{href:`call.html?destination_hash=${s.peer.destination_hash}`,target:"_blank"},[k(l,null,{default:S(()=>[js,Es]),_:1})],8,Os),k(l,{onClick:n.onPingDestination},{default:S(()=>[Ns,Hs]),_:1},8,["onClick"]),k(l,{onClick:n.onSetCustomDisplayName},{default:S(()=>[Vs,Zs]),_:1},8,["onClick"]),o("div",Ws,[k(l,{onClick:n.onDeleteMessageHistory},{default:S(()=>[qs,Qs]),_:1},8,["onClick"])])]),_:1})}const Gs=$($s,[["render",Xs]]);/*!
 * Compressor.js v1.2.1
 * https://fengyuanchen.github.io/compressorjs
 *
 * Copyright 2018-present Chen Fengyuan
 * Released under the MIT license
 *
 * Date: 2023-02-28T14:09:41.732Z
 */function De(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),s.push.apply(s,i)}return s}function Q(t){for(var e=1;e<arguments.length;e++){var s=arguments[e]!=null?arguments[e]:{};e%2?De(Object(s),!0).forEach(function(i){Js(t,i,s[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):De(Object(s)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(s,i))})}return t}function Ys(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Re(t,e){for(var s=0;s<e.length;s++){var i=e[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,Oe(i.key),i)}}function Ks(t,e,s){return Re(t.prototype,e),Re(t,s),Object.defineProperty(t,"prototype",{writable:!1}),t}function Js(t,e,s){return e=Oe(e),e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}function G(){return G=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var s=arguments[e];for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&(t[i]=s[i])}return t},G.apply(this,arguments)}function eo(t,e){if(typeof t!="object"||t===null)return t;var s=t[Symbol.toPrimitive];if(s!==void 0){var i=s.call(t,e||"default");if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Oe(t){var e=eo(t,"string");return typeof e=="symbol"?e:String(e)}var je={exports:{}};(function(t){typeof window>"u"||function(e){var s=e.HTMLCanvasElement&&e.HTMLCanvasElement.prototype,i=e.Blob&&function(){try{return!!new Blob}catch{return!1}}(),a=i&&e.Uint8Array&&function(){try{return new Blob([new Uint8Array(100)]).size===100}catch{return!1}}(),n=e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder||e.MSBlobBuilder,u=/^data:((.*?)(;charset=.*?)?)(;base64)?,/,l=(i||n)&&e.atob&&e.ArrayBuffer&&e.Uint8Array&&function(h){var m,v,y,w,p,g,r,x,R;if(m=h.match(u),!m)throw new Error("invalid data URI");for(v=m[2]?m[1]:"text/plain"+(m[3]||";charset=US-ASCII"),y=!!m[4],w=h.slice(m[0].length),y?p=atob(w):p=decodeURIComponent(w),g=new ArrayBuffer(p.length),r=new Uint8Array(g),x=0;x<p.length;x+=1)r[x]=p.charCodeAt(x);return i?new Blob([a?r:g],{type:v}):(R=new n,R.append(g),R.getBlob(v))};e.HTMLCanvasElement&&!s.toBlob&&(s.mozGetAsFile?s.toBlob=function(h,m,v){var y=this;setTimeout(function(){v&&s.toDataURL&&l?h(l(y.toDataURL(m,v))):h(y.mozGetAsFile("blob",m))})}:s.toDataURL&&l&&(s.msToBlob?s.toBlob=function(h,m,v){var y=this;setTimeout(function(){(m&&m!=="image/png"||v)&&s.toDataURL&&l?h(l(y.toDataURL(m,v))):h(y.msToBlob(m))})}:s.toBlob=function(h,m,v){var y=this;setTimeout(function(){h(l(y.toDataURL(m,v)))})})),t.exports?t.exports=l:e.dataURLtoBlob=l}(window)})(je);var Le=je.exports,to=function(e){return typeof Blob>"u"?!1:e instanceof Blob||Object.prototype.toString.call(e)==="[object Blob]"},Te={strict:!0,checkOrientation:!0,retainExif:!1,maxWidth:1/0,maxHeight:1/0,minWidth:0,minHeight:0,width:void 0,height:void 0,resize:"none",quality:.8,mimeType:"auto",convertTypes:["image/png"],convertSize:5e6,beforeDraw:null,drew:null,success:null,error:null},so=typeof window<"u"&&typeof window.document<"u",z=so?window:{},Y=function(e){return e>0&&e<1/0},oo=Array.prototype.slice;function ce(t){return Array.from?Array.from(t):oo.call(t)}var no=/^image\/.+$/;function re(t){return no.test(t)}function io(t){var e=re(t)?t.substr(6):"";return e==="jpeg"&&(e="jpg"),".".concat(e)}var Ee=String.fromCharCode;function ao(t,e,s){var i="",a;for(s+=e,a=e;a<s;a+=1)i+=Ee(t.getUint8(a));return i}var ro=z.btoa;function ze(t,e){for(var s=[],i=8192,a=new Uint8Array(t);a.length>0;)s.push(Ee.apply(null,ce(a.subarray(0,i)))),a=a.subarray(i);return"data:".concat(e,";base64,").concat(ro(s.join("")))}function lo(t){var e=new DataView(t),s;try{var i,a,n;if(e.getUint8(0)===255&&e.getUint8(1)===216)for(var u=e.byteLength,l=2;l+1<u;){if(e.getUint8(l)===255&&e.getUint8(l+1)===225){a=l;break}l+=1}if(a){var h=a+4,m=a+10;if(ao(e,h,4)==="Exif"){var v=e.getUint16(m);if(i=v===18761,(i||v===19789)&&e.getUint16(m+2,i)===42){var y=e.getUint32(m+4,i);y>=8&&(n=m+y)}}}if(n){var w=e.getUint16(n,i),p,g;for(g=0;g<w;g+=1)if(p=n+g*12+2,e.getUint16(p,i)===274){p+=8,s=e.getUint16(p,i),e.setUint16(p,1,i);break}}}catch{s=1}return s}function co(t){var e=0,s=1,i=1;switch(t){case 2:s=-1;break;case 3:e=-180;break;case 4:i=-1;break;case 5:e=90,i=-1;break;case 6:e=90;break;case 7:e=90,s=-1;break;case 8:e=-90;break}return{rotate:e,scaleX:s,scaleY:i}}var uo=/\.\d*(?:0|9){12}\d*$/;function Ie(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e11;return uo.test(t)?Math.round(t*e)/e:t}function W(t){var e=t.aspectRatio,s=t.height,i=t.width,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"none",n=Y(i),u=Y(s);if(n&&u){var l=s*e;(a==="contain"||a==="none")&&l>i||a==="cover"&&l<i?s=i/e:i=s*e}else n?s=i/e:u&&(i=s*e);return{width:i,height:s}}function ho(t){for(var e=ce(new Uint8Array(t)),s=e.length,i=[],a=0;a+3<s;){var n=e[a],u=e[a+1];if(n===255&&u===218)break;if(n===255&&u===216)a+=2;else{var l=e[a+2]*256+e[a+3],h=a+l+2,m=e.slice(a,h);i.push(m),a=h}}return i.reduce(function(v,y){return y[0]===255&&y[1]===225?v.concat(y):v},[])}function mo(t,e){var s=ce(new Uint8Array(t));if(s[2]!==255||s[3]!==224)return t;var i=s[4]*256+s[5],a=[255,216].concat(e,s.slice(4+i));return new Uint8Array(a)}var go=z.ArrayBuffer,se=z.FileReader,I=z.URL||z.webkitURL,fo=/\.\w+$/,vo=z.Compressor,oe=function(){function t(e,s){Ys(this,t),this.file=e,this.exif=[],this.image=new Image,this.options=Q(Q({},Te),s),this.aborted=!1,this.result=null,this.init()}return Ks(t,[{key:"init",value:function(){var s=this,i=this.file,a=this.options;if(!to(i)){this.fail(new Error("The first argument must be a File or Blob object."));return}var n=i.type;if(!re(n)){this.fail(new Error("The first argument must be an image File or Blob object."));return}if(!I||!se){this.fail(new Error("The current browser does not support image compression."));return}go||(a.checkOrientation=!1,a.retainExif=!1);var u=n==="image/jpeg",l=u&&a.checkOrientation,h=u&&a.retainExif;if(I&&!l&&!h)this.load({url:I.createObjectURL(i)});else{var m=new se;this.reader=m,m.onload=function(v){var y=v.target,w=y.result,p={},g=1;l&&(g=lo(w),g>1&&G(p,co(g))),h&&(s.exif=ho(w)),l||h?!I||g>1?p.url=ze(w,n):p.url=I.createObjectURL(i):p.url=w,s.load(p)},m.onabort=function(){s.fail(new Error("Aborted to read the image with FileReader."))},m.onerror=function(){s.fail(new Error("Failed to read the image with FileReader."))},m.onloadend=function(){s.reader=null},l||h?m.readAsArrayBuffer(i):m.readAsDataURL(i)}}},{key:"load",value:function(s){var i=this,a=this.file,n=this.image;n.onload=function(){i.draw(Q(Q({},s),{},{naturalWidth:n.naturalWidth,naturalHeight:n.naturalHeight}))},n.onabort=function(){i.fail(new Error("Aborted to load the image."))},n.onerror=function(){i.fail(new Error("Failed to load the image."))},z.navigator&&/(?:iPad|iPhone|iPod).*?AppleWebKit/i.test(z.navigator.userAgent)&&(n.crossOrigin="anonymous"),n.alt=a.name,n.src=s.url}},{key:"draw",value:function(s){var i=this,a=s.naturalWidth,n=s.naturalHeight,u=s.rotate,l=u===void 0?0:u,h=s.scaleX,m=h===void 0?1:h,v=s.scaleY,y=v===void 0?1:v,w=this.file,p=this.image,g=this.options,r=document.createElement("canvas"),x=r.getContext("2d"),R=Math.abs(l)%180===90,F=(g.resize==="contain"||g.resize==="cover")&&Y(g.width)&&Y(g.height),L=Math.max(g.maxWidth,0)||1/0,M=Math.max(g.maxHeight,0)||1/0,N=Math.max(g.minWidth,0)||0,H=Math.max(g.minHeight,0)||0,O=a/n,C=g.width,A=g.height;if(R){var ue=[M,L];L=ue[0],M=ue[1];var he=[H,N];N=he[0],H=he[1];var me=[A,C];C=me[0],A=me[1]}F&&(O=C/A);var ge=W({aspectRatio:O,width:L,height:M},"contain");L=ge.width,M=ge.height;var fe=W({aspectRatio:O,width:N,height:H},"cover");if(N=fe.width,H=fe.height,F){var ve=W({aspectRatio:O,width:C,height:A},g.resize);C=ve.width,A=ve.height}else{var pe=W({aspectRatio:O,width:C,height:A}),ye=pe.width;C=ye===void 0?a:ye;var _e=pe.height;A=_e===void 0?n:_e}C=Math.floor(Ie(Math.min(Math.max(C,N),L))),A=Math.floor(Ie(Math.min(Math.max(A,H),M)));var Ne=-C/2,He=-A/2,Ve=C,Ze=A,K=[];if(F){var be=0,we=0,J=a,ee=n,xe=W({aspectRatio:O,width:a,height:n},{contain:"cover",cover:"contain"}[g.resize]);J=xe.width,ee=xe.height,be=(a-J)/2,we=(n-ee)/2,K.push(be,we,J,ee)}if(K.push(Ne,He,Ve,Ze),R){var ke=[A,C];C=ke[0],A=ke[1]}r.width=C,r.height=A,re(g.mimeType)||(g.mimeType=w.type);var Me="transparent";w.size>g.convertSize&&g.convertTypes.indexOf(g.mimeType)>=0&&(g.mimeType="image/jpeg");var Ce=g.mimeType==="image/jpeg";if(Ce&&(Me="#fff"),x.fillStyle=Me,x.fillRect(0,0,C,A),g.beforeDraw&&g.beforeDraw.call(this,x,r),!this.aborted&&(x.save(),x.translate(C/2,A/2),x.rotate(l*Math.PI/180),x.scale(m,y),x.drawImage.apply(x,[p].concat(K)),x.restore(),g.drew&&g.drew.call(this,x,r),!this.aborted)){var Ae=function(V){if(!i.aborted){var Pe=function(Z){return i.done({naturalWidth:a,naturalHeight:n,result:Z})};if(V&&Ce&&g.retainExif&&i.exif&&i.exif.length>0){var Se=function(Z){return Pe(Le(ze(mo(Z,i.exif),g.mimeType)))};if(V.arrayBuffer)V.arrayBuffer().then(Se).catch(function(){i.fail(new Error("Failed to read the compressed image with Blob.arrayBuffer()."))});else{var j=new se;i.reader=j,j.onload=function(te){var Z=te.target;Se(Z.result)},j.onabort=function(){i.fail(new Error("Aborted to read the compressed image with FileReader."))},j.onerror=function(){i.fail(new Error("Failed to read the compressed image with FileReader."))},j.onloadend=function(){i.reader=null},j.readAsArrayBuffer(V)}}else Pe(V)}};r.toBlob?r.toBlob(Ae,g.mimeType,g.quality):Ae(Le(r.toDataURL(g.mimeType,g.quality)))}}},{key:"done",value:function(s){var i=s.naturalWidth,a=s.naturalHeight,n=s.result,u=this.file,l=this.image,h=this.options;if(I&&l.src.indexOf("blob:")===0&&I.revokeObjectURL(l.src),n)if(h.strict&&!h.retainExif&&n.size>u.size&&h.mimeType===u.type&&!(h.width>i||h.height>a||h.minWidth>i||h.minHeight>a||h.maxWidth<i||h.maxHeight<a))n=u;else{var m=new Date;n.lastModified=m.getTime(),n.lastModifiedDate=m,n.name=u.name,n.name&&n.type!==u.type&&(n.name=n.name.replace(fo,io(n.type)))}else n=u;this.result=n,h.success&&h.success.call(this,n)}},{key:"fail",value:function(s){var i=this.options;if(i.error)i.error.call(this,s);else throw s}},{key:"abort",value:function(){this.aborted||(this.aborted=!0,this.reader?this.reader.abort():this.image.complete?this.fail(new Error("The compression process has been aborted.")):(this.image.onload=null,this.image.onabort()))}}],[{key:"noConflict",value:function(){return window.Compressor=vo,t}},{key:"setDefaults",value:function(s){G(Te,s)}}]),t}();const po={name:"AddImageButton",emits:["add-image"],data(){return{isShowingMenu:!1,selectedImageQuality:null}},methods:{showMenu(){this.isShowingMenu=!0},hideMenu(){this.isShowingMenu=!1},addImage(t){this.isShowingMenu=!1,this.selectedImageQuality=t,this.$refs["image-input"].click()},clearImageInput:function(){this.$refs["image-input"].value=null},onImageInputChange:async function(t){if(t.target.files.length>0){const e=t.target.files[0];switch(this.selectedImageQuality){case"low":{new oe(e,{maxWidth:320,maxHeight:320,quality:.2,mimeType:"image/webp",success:s=>{this.$emit("add-image",s)},error:s=>{b.alert(s.message)}});break}case"medium":{new oe(e,{maxWidth:640,maxHeight:640,quality:.6,mimeType:"image/webp",success:s=>{this.$emit("add-image",s)},error:s=>{b.alert(s.message)}});break}case"high":{new oe(e,{maxWidth:1280,maxHeight:1280,quality:.75,mimeType:"image/webp",success:s=>{this.$emit("add-image",s)},error:s=>{b.alert(s.message)}});break}case"original":{this.$emit("add-image",e);break}default:{b.alert(`Unsupported image quality: ${this.selectedImageQuality}`);break}}this.clearImageInput()}}}},yo={class:"inline-flex rounded-md shadow-sm"},_o=o("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",class:"size-5"},[o("path",{"fill-rule":"evenodd",d:"M1.5 6a2.25 2.25 0 0 1 2.25-2.25h16.5A2.25 2.25 0 0 1 22.5 6v12a2.25 2.25 0 0 1-2.25 2.25H3.75A2.25 2.25 0 0 1 1.5 18V6ZM3 16.06V18c0 .414.336.75.75.75h16.5A.75.75 0 0 0 21 18v-1.94l-2.69-2.689a1.5 1.5 0 0 0-2.12 0l-.88.879.97.97a.75.75 0 1 1-1.06 1.06l-5.16-5.159a1.5 1.5 0 0 0-2.12 0L3 16.061Zm10.125-7.81a1.125 1.125 0 1 1 2.25 0 1.125 1.125 0 0 1-2.25 0Z","clip-rule":"evenodd"})],-1),bo=o("span",{class:"ml-1 hidden xl:inline-block whitespace-nowrap"},"Add Image",-1),wo=[_o,bo],xo={class:"relative block"},ko={key:0,class:"absolute bottom-0 -ml-11 sm:right-0 sm:ml-0 z-10 mb-10 rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},Mo={class:"py-1"};function Co(t,e,s,i,a,n){return d(),c("div",yo,[o("button",{onClick:e[0]||(e[0]=(...u)=>n.showMenu&&n.showMenu(...u)),type:"button",class:"my-auto mr-1 inline-flex items-center gap-x-1 rounded-md bg-gray-500 px-2.5 py-1.5 text-sm font-semibold text-white shadow-sm hover:bg-gray-400 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-gray-500 dark:bg-zinc-800 dark:text-white dark:hover:bg-zinc-700 dark:focus-visible:outline-zinc-500"},wo),o("div",xo,[k(le,{"enter-active-class":"transition ease-out duration-100","enter-from-class":"transform opacity-0 scale-95","enter-to-class":"transform opacity-100 scale-100","leave-active-class":"transition ease-in duration-75","leave-from-class":"transform opacity-100 scale-100","leave-to-class":"transform opacity-0 scale-95"},{default:S(()=>[a.isShowingMenu?U((d(),c("div",ko,[o("div",Mo,[o("button",{onClick:e[1]||(e[1]=u=>n.addImage("low")),type:"button",class:"w-full block text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 whitespace-nowrap"},"Low Quality (320x320)"),o("button",{onClick:e[2]||(e[2]=u=>n.addImage("medium")),type:"button",class:"w-full block text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 whitespace-nowrap"},"Medium Quality (640x640)"),o("button",{onClick:e[3]||(e[3]=u=>n.addImage("high")),type:"button",class:"w-full block text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 whitespace-nowrap"},"High Quality (1280x1280)"),o("button",{onClick:e[4]||(e[4]=u=>n.addImage("original")),type:"button",class:"w-full block text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 whitespace-nowrap"},"Original Quality")])])),[[de,n.hideMenu]]):f("",!0)]),_:1})]),o("input",{ref:"image-input",onChange:e[5]||(e[5]=(...u)=>n.onImageInputChange&&n.onImageInputChange(...u)),type:"file",accept:"image/*",style:{display:"none"}},null,544)])}const Ao=$(po,[["render",Co]]),Po={name:"ConversationViewer",components:{IconButton:Fe,AddImageButton:Ao,ConversationDropDownMenu:Gs,MaterialDesignIcon:Ue,SendMessageButton:Us,AddAudioButton:_s},props:{myLxmfAddressHash:String,selectedPeer:Object,conversations:Array},data(){return{selectedPeerPath:null,selectedPeerLxmfStampInfo:null,selectedPeerSignalMetrics:null,lxmfMessagesRequestSequence:0,chatItems:[],isLoadingPrevious:!1,hasMorePrevious:!0,newMessageDeliveryMethod:null,newMessageText:"",newMessageImage:null,newMessageImageUrl:null,newMessageAudio:null,newMessageFiles:[],isSendingMessage:!1,autoScrollOnNewMessage:!0,isRecordingAudioAttachment:!1,audioAttachmentMicrophoneRecorder:null,audioAttachmentMicrophoneRecorderCodec:null,audioAttachmentRecordingStartedAt:null,audioAttachmentRecordingDuration:null,audioAttachmentRecordingTimer:null,lxmfMessageAudioAttachmentCache:{},lxmfAudioModeToCodec2ModeMap:{1:"450PWB",2:"450",3:"700C",4:"1200",5:"1300",6:"1400",7:"1600",8:"2400",9:"3200"}}},beforeUnmount(){X.off("message",this.onWebsocketMessage)},mounted(){X.on("message",this.onWebsocketMessage)},methods:{close(){this.$emit("close")},onMessagesScroll(t){const e=t.target,s=e.scrollTop===e.scrollHeight-e.offsetHeight;this.autoScrollOnNewMessage=s,e.scrollTop<=500&&this.loadPrevious()},async initialLoad(){this.chatItems=[],this.hasMorePrevious=!0,this.selectedPeerPath=null,this.selectedPeerLxmfStampInfo=null,this.selectedPeerSignalMetrics=null,this.selectedPeer&&(this.getPeerPath(),this.getPeerLxmfStampInfo(),this.getPeerSignalMetrics(),await this.loadPrevious(),this.scrollMessagesToBottom())},async loadPrevious(){if(!this.isLoadingPrevious){this.isLoadingPrevious=!0;try{const t=++this.lxmfMessagesRequestSequence,e=30,s=await window.axios.get(`/api/v1/lxmf-messages/conversation/${this.selectedPeer.destination_hash}`,{params:{count:e,order:"desc",after_id:this.oldestMessageId}});if(t!==this.lxmfMessagesRequestSequence){console.log("ignoring response for previous lxmf messages request");return}const i=[],a=s.data.lxmf_messages;for(const n of a)i.push({type:"lxmf_message",is_outbound:this.myLxmfAddressHash===n.source_hash,lxmf_message:n});for(const n of i)this.chatItems.unshift(n);i.length<e&&(this.hasMorePrevious=!1)}catch{}finally{this.isLoadingPrevious=!1}}},async onWebsocketMessage(t){var s;const e=JSON.parse(t.data);switch(e.type){case"announce":{e.announce.destination_hash===((s=this.selectedPeer)==null?void 0:s.destination_hash)&&(await this.getPeerPath(),await this.getPeerLxmfStampInfo(),await this.getPeerSignalMetrics());break}case"lxmf.delivery":{this.onLxmfMessageReceived(e.lxmf_message),await this.getPeerPath(),await this.getPeerSignalMetrics();break}case"lxmf_message_created":{this.onLxmfMessageCreated(e.lxmf_message),await this.getPeerPath();break}case"lxmf_message_state_updated":{this.onLxmfMessageUpdated(e.lxmf_message);break}case"lxmf_message_deleted":{this.onLxmfMessageDeleted(e.hash);break}}},openLXMFAddress(){ne.emit("compose-new-message")},onLxmfMessageReceived(t){var e;if(this.chatItems.push({type:"lxmf_message",lxmf_message:t}),t.source_hash===((e=this.selectedPeer)==null?void 0:e.destination_hash)){const s=this.findConversation(this.selectedPeer.destination_hash);s&&this.markConversationAsRead(s)}document.hasFocus()||We.showNewMessageNotification(),this.autoScrollOnNewMessage&&this.scrollMessagesToBottom()},onLxmfMessageCreated(t){this.isLxmfMessageInUi(t.hash)||this.chatItems.push({type:"lxmf_message",lxmf_message:t,is_outbound:!0})},onLxmfMessageUpdated(t){const e=t.hash,s=this.chatItems.findIndex(i=>{var a;return((a=i.lxmf_message)==null?void 0:a.hash)===e});if(s===-1){console.log("did not find existing chat item index for lxmf message hash: "+t.hash);return}this.chatItems[s].lxmf_message=t},onLxmfMessageDeleted(t){t&&(this.chatItems=this.chatItems.filter(e=>{var s;return((s=e.lxmf_message)==null?void 0:s.hash)!==t}))},async getPeerPath(){if(this.selectedPeer)try{const t=await window.axios.get(`/api/v1/destination/${this.selectedPeer.destination_hash}/path`);this.selectedPeerPath=t.data.path}catch(t){console.log(t),this.selectedPeerPath=null}},async getPeerLxmfStampInfo(){if(this.selectedPeer)try{const t=await window.axios.get(`/api/v1/destination/${this.selectedPeer.destination_hash}/lxmf-stamp-info`);this.selectedPeerLxmfStampInfo=t.data.lxmf_stamp_info}catch(t){console.log(t),this.selectedPeerLxmfStampInfo=null}},async getPeerSignalMetrics(){if(this.selectedPeer)try{const t=await window.axios.get(`/api/v1/destination/${this.selectedPeer.destination_hash}/signal-metrics`);this.selectedPeerSignalMetrics=t.data.signal_metrics}catch(t){console.log(t),this.selectedPeerSignalMetrics=null}},onDestinationPathClick(t){b.alert(`${t.hops} ${t.hops===1?"hop":"hops"} away via ${t.next_hop_interface}`)},onStampInfoClick(t){const e=t.stamp_cost,s=t.outbound_ticket_expiry;var i="";e>=24?i="several hours":e>=20?i="more than an hour":e>=18?i="~5 minutes":e>=17?i="a few minutes":e>=16?i="~1 minute":e>=13?i="~30 seconds":e>=9?i="~10 seconds":e>=1?i="a few seconds":i="0 seconds",s!=null&&(i=`instant (ticket expires ${qe(s*1e3).fromNow()})`),b.alert(`This peer has enabled stamp security.

Your device must have a ticket, or solve an automated proof of work task each time you send them a message.

Time per message: ${i}`)},onSignalMetricsClick(t){b.alert([`Signal Quality: ${t.quality??"???"}%`,`RSSI: ${t.rssi??"???"}dBm`,`SNR: ${t.snr??"???"}dB`].join(`
`))},scrollMessagesToBottom:function(){this.$nextTick(()=>{setTimeout(()=>{const t=document.getElementById("messages");t&&(t.scrollTop=t.scrollHeight)},0)})},isLxmfMessageInUi:function(t){return this.chatItems.findIndex(e=>{var s;return((s=e.lxmf_message)==null?void 0:s.hash)===t})!==-1},async getCustomDisplayName(){if(this.selectedPeer)try{const t=await window.axios.get(`/api/v1/destination/${this.selectedPeer.destination_hash}/custom-display-name`);this.selectedPeer.custom_display_name=t.data.custom_display_name}catch(t){console.log(t)}},async updateCustomDisplayName(){if(!this.selectedPeer)return;const t=await b.prompt("Enter a custom display name");if(t!=null)try{await axios.post(`/api/v1/destination/${this.selectedPeer.destination_hash}/custom-display-name/update`,{display_name:t}),await this.getCustomDisplayName(),this.$emit("reload-conversations")}catch(e){console.log(e),b.alert("Failed to update display name")}},async onConversationDeleted(){await this.initialLoad(),this.$emit("reload-conversations")},onChatItemClick:function(t){t.is_actions_expanded?t.is_actions_expanded=!1:t.is_actions_expanded=!0},openImage:async function(t){const e=await(await fetch(t)).blob(),s=window.URL.createObjectURL(e);window.open(s)},downloadFileFromBase64:async function(t,e){const s=atob(e),i=new Array(s.length);for(let h=0;h<s.length;h++)i[h]=s.charCodeAt(h);const a=new Uint8Array(i),n=new Blob([a]),u=URL.createObjectURL(n),l=document.createElement("a");l.href=u,l.download=t,l.style.display="none",document.body.append(l),l.click(),l.remove(),setTimeout(()=>URL.revokeObjectURL(u),1e4)},async processAudioForSelectedPeerChatItems(){var t,e;for(const s of this.selectedPeerChatItems){if(!((e=(t=s.lxmf_message)==null?void 0:t.fields)!=null&&e.audio)||this.lxmfMessageAudioAttachmentCache[s.lxmf_message.hash])continue;const i=await this.decodeLxmfAudioFieldToBlobUrl(s.lxmf_message.fields.audio);i&&(this.lxmfMessageAudioAttachmentCache[s.lxmf_message.hash]=i)}},async decodeLxmfAudioFieldToBlobUrl(t){try{const e=t.audio_mode,s=t.audio_bytes;if(e===16)return this.decodeOpusAudioToBlobUrl(t.audio_bytes);const i=this.lxmfAudioModeToCodec2ModeMap[e];if(!i)return console.log("unsupported audio mode: "+e),null;const a=this.base64ToArrayBuffer(s),n=await Codec2Lib.runDecode(i,new Uint8Array(a)),u=await Codec2Lib.rawToWav(n),l=new Blob([u],{type:"audio/wav"});return URL.createObjectURL(l)}catch(e){return console.log(e),null}},async decodeOpusAudioToBlobUrl(t){try{const e=this.base64ToArrayBuffer(t),s=new Blob([e],{type:"audio/opus"});return URL.createObjectURL(s)}catch(e){return console.log(e),null}},base64ToArrayBuffer:function(t){return Uint8Array.from(atob(t),e=>e.charCodeAt(0))},async deleteChatItem(t,e=!0){try{if(e&&!confirm("Are you sure you want to delete this message? This can not be undone!")||t.type!=="lxmf_message")return;await window.axios.delete(`/api/v1/lxmf-messages/${t.lxmf_message.hash}`),this.chatItems=this.chatItems.filter(s=>{var i;return((i=s.lxmf_message)==null?void 0:i.hash)!==t.lxmf_message.hash})}catch{}},async sendMessage(){var i,a;if(this.canSendMessage&&this.selectedPeer){this.isSendingMessage=!0;try{const n={};var t=0;if(this.newMessageFiles.length>0){const m=[];for(const v of this.newMessageFiles)t+=v.size,m.push({file_name:v.name,file_bytes:P.arrayBufferToBase64(await v.arrayBuffer())});n.file_attachments=m}var e=0;this.newMessageImage&&(e=this.newMessageImage.size,n.image={image_type:this.newMessageImage.type.replace("image/",""),image_bytes:P.arrayBufferToBase64(await this.newMessageImage.arrayBuffer())});var s=0;this.newMessageAudio&&(s=this.newMessageAudio.size,n.audio={audio_mode:this.newMessageAudio.audio_mode,audio_bytes:P.arrayBufferToBase64(await this.newMessageAudio.audio_blob.arrayBuffer())});const l=this.newMessageText.length+t+e+s;if(l>1e3*900&&!confirm(`Your message exceeds 900KB (It's ${this.formatBytes(l)}). It may be rejected by the recipient unless they have increased their delivery limit. Do you want to try sending anyway?`))return;const h=await window.axios.post("/api/v1/lxmf-messages/send",{delivery_method:this.newMessageDeliveryMethod,lxmf_message:{destination_hash:this.selectedPeer.destination_hash,content:this.newMessageText,fields:n}});this.isLxmfMessageInUi(h.data.lxmf_message.hash)||this.chatItems.push({type:"lxmf_message",lxmf_message:h.data.lxmf_message,is_outbound:!0}),this.scrollMessagesToBottom(),this.newMessageText="",this.newMessageImage=null,this.newMessageImageUrl=null,this.newMessageAudio=null,this.newMessageFiles=[],this.clearFileInput()}catch(n){const u=((a=(i=n.response)==null?void 0:i.data)==null?void 0:a.message)??"failed to send message";b.alert(u),console.log(n)}finally{this.isSendingMessage=!1}}},async cancelSendingMessage(t){var s,i;const e=t.lxmf_message.hash;if(e)try{const n=(await window.axios.post(`/api/v1/lxmf-messages/${e}/cancel`)).data.lxmf_message;if(!n)return;this.onLxmfMessageUpdated(n)}catch(a){const n=((i=(s=a.response)==null?void 0:s.data)==null?void 0:i.message)??"failed to cancel message";b.alert(n),console.log(a)}},async retrySendingMessage(t){var e,s;await this.deleteChatItem(t,!1);try{const i=await window.axios.post("/api/v1/lxmf-messages/send",{lxmf_message:{destination_hash:t.lxmf_message.destination_hash,content:t.lxmf_message.content,fields:t.lxmf_message.fields}});this.isLxmfMessageInUi(i.data.lxmf_message.hash)||this.chatItems.push({type:"lxmf_message",lxmf_message:i.data.lxmf_message,is_outbound:!0}),this.scrollMessagesToBottom()}catch(i){const a=((s=(e=i.response)==null?void 0:e.data)==null?void 0:s.message)??"failed to send message";b.alert(a),console.log(i)}},formatTimeAgo:function(t){return P.formatTimeAgo(t)},formatBytes:function(t){return P.formatBytes(t)},onFileInputChange:function(t){for(const e of t.target.files)this.newMessageFiles.push(e)},clearFileInput:function(){this.$refs["file-input"].value=null},removeImageAttachment:function(){confirm("Are you sure you want to remove this image attachment?")&&(this.newMessageImage=null,this.newMessageImageUrl=null)},onImageSelected:function(t){this.newMessageImage=t;const e=new FileReader;e.onload=s=>{this.newMessageImageUrl=s.target.result},e.readAsDataURL(this.newMessageImage)},async startRecordingAudioAttachment(t){if(!this.isRecordingAudioAttachment&&!(this.newMessageAudio&&!confirm("An audio recording is already attached. A new recording will replace it. Do you want to continue?")))switch(t.codec){case"codec2":{this.audioAttachmentMicrophoneRecorderCodec="codec2",this.audioAttachmentMicrophoneRecorder=new Codec2MicrophoneRecorder,this.audioAttachmentMicrophoneRecorder.codec2Mode=t.mode,this.audioAttachmentRecordingStartedAt=Date.now(),this.isRecordingAudioAttachment=await this.audioAttachmentMicrophoneRecorder.start(),this.audioAttachmentRecordingDuration=P.formatMinutesSeconds(0),this.audioAttachmentRecordingTimer=setInterval(()=>{const s=(Date.now()-this.audioAttachmentRecordingStartedAt)/1e3;this.audioAttachmentRecordingDuration=P.formatMinutesSeconds(s)},1e3),this.isRecordingAudioAttachment||b.alert("failed to start recording");break}case"opus":{this.audioAttachmentMicrophoneRecorderCodec="opus",this.audioAttachmentMicrophoneRecorder=new rs,this.audioAttachmentRecordingStartedAt=Date.now(),this.isRecordingAudioAttachment=await this.audioAttachmentMicrophoneRecorder.start(),this.audioAttachmentRecordingDuration=P.formatMinutesSeconds(0),this.audioAttachmentRecordingTimer=setInterval(()=>{const s=(Date.now()-this.audioAttachmentRecordingStartedAt)/1e3;this.audioAttachmentRecordingDuration=P.formatMinutesSeconds(s)},1e3),this.isRecordingAudioAttachment||b.alert("failed to start recording");break}default:{b.alert(`Unhandled microphone recorder codec: ${t.codec}`);break}}},async stopRecordingAudioAttachment(){if(clearInterval(this.audioAttachmentRecordingTimer),!this.isRecordingAudioAttachment)return;this.isRecordingAudioAttachment=!1;const t=await this.audioAttachmentMicrophoneRecorder.stop();switch(this.audioAttachmentMicrophoneRecorderCodec){case"codec2":{if(t.length===0)return;const s=this.audioAttachmentMicrophoneRecorder.codec2Mode,i=await Codec2Lib.runDecode(s,new Uint8Array(t)),a=await Codec2Lib.rawToWav(i),n=new Blob([a],{type:"audio/wav"});var e=null;switch(s){case"1200":{e=4;break}case"3200":{e=9;break}default:{b.alert(`Unhandled microphone recorder codec2Mode: ${s}`);return}}this.newMessageAudio={audio_mode:e,audio_blob:new Blob([t]),audio_preview_url:URL.createObjectURL(n)};break}case"opus":{if(t.size===0)return;this.newMessageAudio={audio_mode:16,audio_blob:t,audio_preview_url:URL.createObjectURL(t)};break}}},removeAudioAttachment:function(){confirm("Are you sure you want to remove this audio attachment?")&&(this.newMessageAudio=null)},removeFileAttachment:function(t){this.newMessageFiles=this.newMessageFiles.filter(e=>e!==t)},addNewLine:function(){this.newMessageText+=`
`},onEnterPressed:function(){if(this.isMobile){this.addNewLine();return}this.sendMessage()},onShiftEnterPressed:function(){this.addNewLine()},addFilesToMessage:function(){this.$refs["file-input"].click()},findConversation:function(t){return this.conversations.find(e=>e.destination_hash===t)},async markConversationAsRead(t){t.is_unread=!1;try{await window.axios.get(`/api/v1/lxmf/conversations/${t.destination_hash}/mark-as-read`)}catch(e){console.log(e)}this.$emit("reload-conversations")},showSentMessageInfo:function(t){var i,a,n,u,l,h,m,v,y,w;const e=[`Created: ${P.convertUnixMillisToLocalDateTimeString(t.timestamp*1e3)}`,`Method: ${t.method??"unknown"}`];if((a=(i=t.fields)==null?void 0:i.audio)!=null&&a.audio_bytes){const p=atob((u=(n=t.fields)==null?void 0:n.audio)==null?void 0:u.audio_bytes).length;e.push(`Audio Attachment: ${this.formatBytes(p)}`)}if((h=(l=t.fields)==null?void 0:l.image)!=null&&h.image_bytes){const p=atob((v=(m=t.fields)==null?void 0:m.image)==null?void 0:v.image_bytes).length;e.push(`Image Attachment: ${this.formatBytes(p)}`)}if((y=t.fields)!=null&&y.file_attachments){var s=0;for(const p of(w=t.fields)==null?void 0:w.file_attachments){const g=atob(p.file_bytes).length;s+=g}e.push(`File Attachments: ${this.formatBytes(s)}`)}b.alert(e.join(`
`))},showReceivedMessageInfo:function(t){var i,a,n,u,l,h,m,v,y,w;const e=[`Sent: ${P.convertUnixMillisToLocalDateTimeString(t.timestamp*1e3)}`,`Received: ${P.convertDateTimeToLocalDateTimeString(new Date(t.created_at))}`,`Method: ${t.method??"unknown"}`];if((a=(i=t.fields)==null?void 0:i.audio)!=null&&a.audio_bytes){const p=atob((u=(n=t.fields)==null?void 0:n.audio)==null?void 0:u.audio_bytes).length;e.push(`Audio Attachment: ${this.formatBytes(p)}`)}if((h=(l=t.fields)==null?void 0:l.image)!=null&&h.image_bytes){const p=atob((v=(m=t.fields)==null?void 0:m.image)==null?void 0:v.image_bytes).length;e.push(`Image Attachment: ${this.formatBytes(p)}`)}if((y=t.fields)!=null&&y.file_attachments){var s=0;for(const p of(w=t.fields)==null?void 0:w.file_attachments){const g=atob(p.file_bytes).length;s+=g}e.push(`File Attachments: ${this.formatBytes(s)}`)}t.quality!=null&&e.push(`Signal Quality: ${t.quality}%`),t.rssi!=null&&e.push(`RSSI: ${t.rssi}dBm`),t.snr!=null&&e.push(`SNR: ${t.snr}dB`),b.alert(e.join(`
`))}},computed:{isMobile(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)},canSendMessage(){const t=this.newMessageText.trim();return!(t==null||t===""||this.isSendingMessage)},selectedPeerChatItems(){return this.selectedPeer?this.chatItems.filter(t=>{if(t.type==="lxmf_message"){const e=t.lxmf_message.source_hash===this.selectedPeer.destination_hash,s=t.lxmf_message.destination_hash===this.selectedPeer.destination_hash;return e||s}return!1}):[]},selectedPeerChatItemsReversed(){return this.selectedPeerChatItems.map(t=>t).reverse()},oldestMessageId(){return this.selectedPeerChatItems.length>0?this.selectedPeerChatItems[0].lxmf_message.id:null}},watch:{selectedPeer(){this.initialLoad()},async selectedPeerChatItems(){await this.processAudioForSelectedPeerChatItems()}}},So={key:0,class:"flex flex-col h-full bg-white overflow-hidden sm:m-2 sm:border sm:rounded-xl sm:shadow dark:bg-zinc-950 dark:border-zinc-800"},Bo={class:"flex p-2 border-b border-gray-300 dark:border-zinc-800"},Do={class:"my-auto mr-2"},Ro={key:1,class:"bg-gray-200 dark:bg-zinc-700 text-gray-500 dark:text-gray-400 p-2 rounded"},Lo={key:0,class:"my-auto mr-1 dark:text-white",title:"Custom Display Name"},To=o("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"size-4"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9.568 3H5.25A2.25 2.25 0 0 0 3 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 0 0 5.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 0 0 9.568 3Z"}),o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 6h.008v.008H6V6Z"})],-1),zo=[To],Io=["title"],Uo={class:"text-sm dark:text-zinc-300"},$o={class:"inline-block mr-1"},Fo={class:"inline-block"},Oo={class:"flex space-x-1"},jo={key:0},Eo={key:1},No={key:1,class:"flex my-auto space-x-1"},Ho={key:0},Vo={key:2,class:"flex my-auto space-x-1"},Zo={key:0},Wo={class:"ml-auto my-auto mx-2"},qo={class:"my-auto mr-2"},Qo=o("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",class:"w-5 h-5"},[o("path",{d:"M6.28 5.22a.75.75 0 0 0-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 1 0 1.06 1.06L10 11.06l3.72 3.72a.75.75 0 1 0 1.06-1.06L11.06 10l3.72-3.72a.75.75 0 0 0-1.06-1.06L10 8.94 6.28 5.22Z"})],-1),Xo={key:0,class:"flex flex-col flex-col-reverse p-3"},Go=["onClick"],Yo={class:"w-full space-y-0.5 px-2.5 py-1"},Ko={key:0,style:{"white-space":"pre-wrap","word-break":"break-word","font-family":"inherit"}},Jo={key:1},en=["onClick","src"],tn={key:2,class:"pb-1"},sn={key:0,controls:"",class:"shadow rounded-full",style:{height:"54px"}},on=["src"],nn={key:1,style:{"min-height":"54px"},class:"flex"},an=["onClick"],rn=o("span",{class:"my-auto"},[o("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"size-6"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m9 9 10.5-3m0 6.553v3.75a2.25 2.25 0 0 1-1.632 2.163l-1.32.377a1.803 1.803 0 1 1-.99-3.467l2.31-.66a2.25 2.25 0 0 0 1.632-2.163Zm0 0V2.25L9 5.25v10.303m0 0v3.75a2.25 2.25 0 0 1-1.632 2.163l-1.32.377a1.803 1.803 0 0 1-.99-3.467l2.31-.66A2.25 2.25 0 0 0 9 15.553Z"})])],-1),ln={class:"my-auto w-full"},dn=o("span",{class:"my-auto"},[o("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-6 h-6"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"})])],-1),cn={key:3,class:"space-y-1"},un=["download","href"],hn=o("div",{class:"my-auto"},[o("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-6 h-6"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m18.375 12.739-7.693 7.693a4.5 4.5 0 0 1-6.364-6.364l10.94-10.94A3 3 0 1 1 19.5 7.372L8.552 18.32m.009-.01-.01.01m5.699-9.941-7.81 7.81a1.5 1.5 0 0 0 2.112 2.13"})])],-1),mn={class:"my-auto w-full"},gn=o("div",{class:"my-auto"},[o("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-6 h-6"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"})])],-1),fn={key:0,class:"border-t p-1 bg-[#efefef] text-white"},vn=["onClick"],pn={class:"flex ml-auto space-x-1"},yn={class:"my-auto"},_n=["onClick"],bn={key:0},wn={key:1},xn={key:2},kn={key:3},Mn=["onClick"],Cn=["onClick"],An={key:0,class:"my-auto"},Pn=o("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",class:"w-5 h-5"},[o("path",{"fill-rule":"evenodd",d:"M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12Zm13.36-1.814a.75.75 0 1 0-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 0 0-1.06 1.06l2.25 2.25a.75.75 0 0 0 1.14-.094l3.75-5.25Z","clip-rule":"evenodd"})],-1),Sn=[Pn],Bn={key:1,class:"my-auto"},Dn=o("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",class:"size-5"},[o("path",{"fill-rule":"evenodd",d:"M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25Zm-1.72 6.97a.75.75 0 1 0-1.06 1.06L10.94 12l-1.72 1.72a.75.75 0 1 0 1.06 1.06L12 13.06l1.72 1.72a.75.75 0 1 0 1.06-1.06L13.06 12l1.72-1.72a.75.75 0 1 0-1.06-1.06L12 10.94l-1.72-1.72Z","clip-rule":"evenodd"})],-1),Rn=[Dn],Ln={key:2,class:"my-auto"},Tn=o("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",class:"w-5 h-5"},[o("path",{"fill-rule":"evenodd",d:"M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12ZM12 8.25a.75.75 0 0 1 .75.75v3.75a.75.75 0 0 1-1.5 0V9a.75.75 0 0 1 .75-.75Zm0 8.25a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z","clip-rule":"evenodd"})],-1),zn=[Tn],In={key:3,class:"my-auto"},Un=o("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-5 h-5"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M8.625 12a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0H8.25m4.125 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0H12m4.125 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0h-.375M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})],-1),$n=[Un],Fn={key:1,class:"text-xs text-gray-500 mt-0.5 flex flex-col"},On=["onClick"],jn=o("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"size-6"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m15 11.25-3-3m0 0-3 3m3-3v7.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})],-1),En=o("span",null,"Load Previous",-1),Nn=[jn,En],Hn={class:"w-full border-gray-300 dark:border-zinc-800 border-t p-2"},Vn={class:"mx-auto"},Zn={key:0,class:"mb-2"},Wn=["src"],qn={class:"absolute top-0 right-0 p-1"},Qn=o("div",{class:"flex text-gray-700 bg-gray-100 hover:bg-gray-200 p-1 rounded-full"},[o("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",class:"w-4 h-4"},[o("path",{d:"M6.28 5.22a.75.75 0 0 0-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 1 0 1.06 1.06L10 11.06l3.72 3.72a.75.75 0 1 0 1.06-1.06L11.06 10l3.72-3.72a.75.75 0 0 0-1.06-1.06L10 8.94 6.28 5.22Z"})])],-1),Xn=[Qn],Gn={class:"absolute bottom-0 left-0 p-1"},Yn={class:"bg-gray-100 rounded border text-sm px-1"},Kn={key:1,class:"mb-2"},Jn={class:"flex flex-wrap gap-1"},ei={class:"flex border border-gray-300 dark:border-zinc-800 rounded text-gray-700 divide-x divide-gray-300 overflow-hidden"},ti={class:"flex p-1"},si={controls:"",class:"h-10"},oi=["src"],ni={class:"my-auto px-1 text-sm text-gray-500"},ii=o("svg",{class:"w-5 h-5 my-auto",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18 18 6M6 6l12 12"})],-1),ai=[ii],ri={key:2,class:"mb-2"},li={class:"flex flex-wrap gap-1"},di={class:"flex border border-gray-300 dark:border-zinc-800 rounded text-gray-700 divide-x divide-gray-300 overflow-hidden dark:border-zinc-800"},ci={class:"my-auto px-1"},ui={class:"mr-1"},hi={class:"my-auto text-sm text-gray-500"},mi=["onClick"],gi=o("svg",{class:"w-5 h-5 my-auto",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18 18 6M6 6l12 12"})],-1),fi=[gi],vi=["readonly"],pi={class:"flex mt-2"},yi=o("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",class:"w-5 h-5"},[o("path",{"fill-rule":"evenodd",d:"M5.625 1.5H9a3.75 3.75 0 0 1 3.75 3.75v1.875c0 1.036.84 1.875 1.875 1.875H16.5a3.75 3.75 0 0 1 3.75 3.75v7.875c0 1.035-.84 1.875-1.875 1.875H5.625a1.875 1.875 0 0 1-1.875-1.875V3.375c0-1.036.84-1.875 1.875-1.875ZM12.75 12a.75.75 0 0 0-1.5 0v2.25H9a.75.75 0 0 0 0 1.5h2.25V18a.75.75 0 0 0 1.5 0v-2.25H15a.75.75 0 0 0 0-1.5h-2.25V12Z","clip-rule":"evenodd"}),o("path",{d:"M14.25 5.25a5.23 5.23 0 0 0-1.279-3.434 9.768 9.768 0 0 1 6.963 6.963A5.23 5.23 0 0 0 16.5 7.5h-1.875a.375.375 0 0 1-.375-.375V5.25Z"})],-1),_i=o("span",{class:"ml-1 hidden xl:inline-block whitespace-nowrap"},"Add Files",-1),bi=[yi,_i],wi={class:"ml-auto my-auto"},xi={key:1,class:"flex flex-col mx-auto my-auto text-center leading-5"},ki=Ye('<div class="mx-auto mb-1"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 dark:text-white"><path stroke-linecap="round" stroke-linejoin="round" d="M20.25 8.511c.884.284 1.5 1.128 1.5 2.097v4.286c0 1.136-.847 2.1-1.98 2.193-.34.027-.68.052-1.02.072v3.091l-3-3c-1.354 0-2.694-.055-4.02-.163a2.115 2.115 0 0 1-.825-.242m9.345-8.334a2.126 2.126 0 0 0-.476-.095 48.64 48.64 0 0 0-8.048 0c-1.131.094-1.976 1.057-1.976 2.192v4.286c0 .837.46 1.58 1.155 1.951m9.345-8.334V6.637c0-1.621-1.152-3.026-2.76-3.235A48.455 48.455 0 0 0 11.25 3c-2.115 0-4.198.137-6.24.402-1.608.209-2.76 1.614-2.76 3.235v6.226c0 1.621 1.152 3.026 2.76 3.235.577.075 1.157.14 1.74.194V21l4.155-4.155"></path></svg></div><div class="font-semibold dark:text-white">No Active Chat</div><div class="dark:text-zinc-300">Select a Peer to start chatting!</div>',3),Mi={class:"mx-auto mt-2"};function Ci(t,e,s,i,a,n){var w,p,g;const u=B("MaterialDesignIcon"),l=B("ConversationDropDownMenu"),h=B("IconButton"),m=B("AddImageButton"),v=B("AddAudioButton"),y=B("SendMessageButton");return s.selectedPeer?(d(),c("div",So,[o("div",Bo,[o("div",Do,[s.selectedPeer.lxmf_user_icon?(d(),c("div",{key:0,class:"p-2 rounded",style:ae({color:s.selectedPeer.lxmf_user_icon.foreground_colour,"background-color":s.selectedPeer.lxmf_user_icon.background_colour})},[k(u,{"icon-name":s.selectedPeer.lxmf_user_icon.icon_name,class:"w-6 h-6"},null,8,["icon-name"])],4)):(d(),c("div",Ro,[k(u,{"icon-name":"account-outline",class:"w-6 h-6"})]))]),o("div",null,[o("div",{onClick:e[0]||(e[0]=(...r)=>n.updateCustomDisplayName&&n.updateCustomDisplayName(...r)),class:"flex cursor-pointer"},[s.selectedPeer.custom_display_name!=null?(d(),c("div",Lo,zo)):f("",!0),o("div",{class:"my-auto font-semibold dark:text-white",title:s.selectedPeer.display_name},_(s.selectedPeer.custom_display_name??s.selectedPeer.display_name),9,Io)]),o("div",Uo,[o("div",$o,[o("div",null,"<"+_(s.selectedPeer.destination_hash)+">",1)]),o("div",Fo,[o("div",Oo,[a.selectedPeerPath?(d(),c("span",{key:0,onClick:e[1]||(e[1]=r=>n.onDestinationPathClick(a.selectedPeerPath)),class:"flex my-auto cursor-pointer"},[a.selectedPeerPath.hops===0||a.selectedPeerPath.hops===1?(d(),c("span",jo,"Direct")):(d(),c("span",Eo,_(a.selectedPeerPath.hops)+" hops away",1))])):f("",!0),((w=a.selectedPeerSignalMetrics)==null?void 0:w.snr)!=null?(d(),c("span",No,[a.selectedPeerPath?(d(),c("span",Ho,"•")):f("",!0),o("span",{onClick:e[2]||(e[2]=r=>n.onSignalMetricsClick(a.selectedPeerSignalMetrics)),class:"cursor-pointer"},"SNR "+_(a.selectedPeerSignalMetrics.snr),1)])):f("",!0),(p=a.selectedPeerLxmfStampInfo)!=null&&p.stamp_cost?(d(),c("span",Vo,[a.selectedPeerPath||((g=a.selectedPeerSignalMetrics)==null?void 0:g.snr)!=null?(d(),c("span",Zo,"•")):f("",!0),o("span",{onClick:e[3]||(e[3]=r=>n.onStampInfoClick(a.selectedPeerLxmfStampInfo)),class:"cursor-pointer"},"Stamp Cost "+_(a.selectedPeerLxmfStampInfo.stamp_cost),1)])):f("",!0)])])])]),o("div",Wo,[s.selectedPeer?(d(),$e(l,{key:0,peer:s.selectedPeer,onConversationDeleted:n.onConversationDeleted,onSetCustomDisplayName:n.updateCustomDisplayName},null,8,["peer","onConversationDeleted","onSetCustomDisplayName"])):f("",!0)]),o("div",qo,[k(h,{onClick:n.close},{default:S(()=>[Qo]),_:1},8,["onClick"])])]),o("div",{onScroll:e[6]||(e[6]=(...r)=>n.onMessagesScroll&&n.onMessagesScroll(...r)),id:"messages",class:"h-full overflow-y-scroll"},[n.selectedPeerChatItems.length>0?(d(),c("div",Xo,[(d(!0),c(E,null,q(n.selectedPeerChatItemsReversed,r=>{var x,R,F,L;return d(),c("div",{key:r.lxmf_message.hash,class:D(["flex flex-col max-w-xl mt-3",{"ml-auto pl-4 md:pl-16 items-end":r.is_outbound,"mr-auto pr-4 md:pr-16 items-start":!r.is_outbound}])},[o("div",{onClick:M=>n.onChatItemClick(r),class:D(["border border-gray-300 dark:border-zinc-800 rounded-xl shadow overflow-hidden",[["cancelled","failed"].includes(r.lxmf_message.state)?"bg-red-500 text-white":r.is_outbound?"bg-[#3b82f6] text-white":"bg-[#efefef]"]])},[o("div",Yo,[r.lxmf_message.content?(d(),c("div",Ko,_(r.lxmf_message.content),1)):f("",!0),(x=r.lxmf_message.fields)!=null&&x.image?(d(),c("div",Jo,[o("img",{onClick:T(M=>{n.openImage(`data:image/${r.lxmf_message.fields.image.image_type};base64,${r.lxmf_message.fields.image.image_bytes}`)},["stop"]),src:`data:image/${r.lxmf_message.fields.image.image_type};base64,${r.lxmf_message.fields.image.image_bytes}`,class:"w-full rounded-md cursor-pointer"},null,8,en)])):f("",!0),(R=r.lxmf_message.fields)!=null&&R.audio?(d(),c("div",tn,[a.lxmfMessageAudioAttachmentCache[r.lxmf_message.hash]?(d(),c("audio",sn,[o("source",{src:a.lxmfMessageAudioAttachmentCache[r.lxmf_message.hash],type:"audio/wav"},null,8,on)])):(d(),c("div",nn,[o("button",{onClick:M=>n.downloadFileFromBase64("audio.bin",r.lxmf_message.fields.audio.audio_bytes),type:"button",class:"my-auto flex border border-gray-300 dark:border-zinc-800 hover:bg-gray-100 rounded px-2 py-1 text-sm text-gray-700 font-semibold cursor-pointer space-x-2 bg-[#efefef]"},[rn,o("span",ln," Unsupported Audio (mode "+_(r.lxmf_message.fields.audio.audio_mode)+") ",1),dn],8,an)]))])):f("",!0),(F=r.lxmf_message.fields)!=null&&F.file_attachments?(d(),c("div",cn,[(d(!0),c(E,null,q(((L=r.lxmf_message.fields)==null?void 0:L.file_attachments)??[],M=>(d(),c("a",{onClick:e[4]||(e[4]=T(()=>{},["stop"])),target:"_blank",download:M.file_name,href:`data:application/octet-stream;base64,${M.file_bytes}`,class:"flex border border-gray-300 dark:border-zinc-800 hover:bg-gray-100 rounded px-2 py-1 text-sm text-gray-700 font-semibold cursor-pointer space-x-2 bg-[#efefef]"},[hn,o("div",mn,_(M.file_name),1),gn],8,un))),256))])):f("",!0)]),r.is_actions_expanded?(d(),c("div",fn,[o("button",{onClick:T(M=>n.deleteChatItem(r),["stop"]),type:"button",class:"inline-flex items-center gap-x-1 rounded-md bg-red-500 px-2 py-1 text-xs font-semibold text-white shadow-sm hover:bg-red-400 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-red-500"}," Delete ",8,vn)])):f("",!0)],10,Go),r.is_outbound?(d(),c("div",{key:0,class:D(["flex text-right",[["cancelled","failed"].includes(r.lxmf_message.state)?"text-red-500":"text-gray-500"]])},[o("div",pn,[o("div",yn,[o("span",{onClick:M=>n.showSentMessageInfo(r.lxmf_message),class:"space-x-1 cursor-pointer"},[o("span",null,_(r.lxmf_message.state),1),r.lxmf_message.state==="outbound"&&r.lxmf_message.delivery_attempts>=1?(d(),c("span",bn,"(attempt "+_(r.lxmf_message.delivery_attempts+1)+")",1)):f("",!0),r.lxmf_message.state==="sent"&&r.lxmf_message.method==="opportunistic"&&r.lxmf_message.delivery_attempts>=1?(d(),c("span",wn,"(attempt "+_(r.lxmf_message.delivery_attempts)+")",1)):f("",!0),r.lxmf_message.state==="sent"&&r.lxmf_message.method==="propagated"?(d(),c("span",xn,"to propagation node")):f("",!0),r.lxmf_message.state==="sending"?(d(),c("span",kn,_(r.lxmf_message.progress.toFixed(0))+"%",1)):f("",!0)],8,_n),r.lxmf_message.state==="outbound"||r.lxmf_message.state==="sending"||r.lxmf_message.state==="sent"?(d(),c("a",{key:0,onClick:M=>n.cancelSendingMessage(r),class:"ml-1 cursor-pointer underline text-blue-500"},"cancel?",8,Mn)):f("",!0),r.lxmf_message.state==="failed"?(d(),c("a",{key:1,onClick:M=>n.retrySendingMessage(r),class:"ml-1 cursor-pointer underline text-blue-500"},"retry?",8,Cn)):f("",!0)]),r.lxmf_message.state==="delivered"?(d(),c("div",An,Sn)):r.lxmf_message.state==="cancelled"?(d(),c("div",Bn,Rn)):r.lxmf_message.state==="failed"?(d(),c("div",Ln,zn)):(d(),c("div",In,$n))])],2)):f("",!0),r.is_outbound?f("",!0):(d(),c("div",Fn,[o("span",{onClick:M=>n.showReceivedMessageInfo(r.lxmf_message),class:"cursor-pointer"},_(n.formatTimeAgo(r.lxmf_message.created_at)),9,On)]))],2)}),128)),U(o("button",{id:"load-previous",onClick:e[5]||(e[5]=(...r)=>n.loadPrevious&&n.loadPrevious(...r)),type:"button",class:"flex space-x-2 mx-auto bg-gray-200 px-3 py-1 hover:bg-gray-300 rounded-full shadow"},Nn,512),[[Ge,!a.isLoadingPrevious&&a.hasMorePrevious]])])):f("",!0)],32),o("div",Hn,[o("div",Vn,[o("div",null,[a.newMessageImage?(d(),c("div",Zn,[o("div",{onClick:e[8]||(e[8]=T(r=>n.openImage(a.newMessageImageUrl),["stop"])),class:"cursor-pointer w-32 h-32 rounded shadow border relative overflow-hidden"},[a.newMessageImageUrl?(d(),c("img",{key:0,src:a.newMessageImageUrl,class:"w-full h-full object-cover"},null,8,Wn)):f("",!0),o("div",qn,[o("div",{onClick:e[7]||(e[7]=T((...r)=>n.removeImageAttachment&&n.removeImageAttachment(...r),["stop"])),class:"cursor-pointer"},Xn)]),o("div",Gn,[o("div",Yn,_(n.formatBytes(a.newMessageImage.size)),1)])])])):f("",!0),a.newMessageAudio?(d(),c("div",Kn,[o("div",Jn,[o("div",ei,[o("div",ti,[o("div",null,[o("audio",si,[o("source",{src:a.newMessageAudio.audio_preview_url,type:"audio/wav"},null,8,oi)])]),o("div",ni,_(n.formatBytes(a.newMessageAudio.audio_blob.size)),1)]),o("div",{onClick:e[9]||(e[9]=(...r)=>n.removeAudioAttachment&&n.removeAudioAttachment(...r)),class:"flex my-auto text-sm text-gray-500 h-full px-1 hover:bg-gray-200 cursor-pointer"},ai)])])])):f("",!0),a.newMessageFiles.length>0?(d(),c("div",ri,[o("div",li,[(d(!0),c(E,null,q(a.newMessageFiles,r=>(d(),c("div",di,[o("div",ci,[o("span",ui,_(r.name),1),o("span",hi,_(n.formatBytes(r.size)),1)]),o("div",{onClick:x=>n.removeFileAttachment(r),class:"flex my-auto text-sm text-gray-500 h-full px-1 hover:bg-gray-200 cursor-pointer"},fi,8,mi)]))),256))])])):f("",!0),U(o("textarea",{id:"message-input",readonly:a.isSendingMessage,"onUpdate:modelValue":e[10]||(e[10]=r=>a.newMessageText=r),onKeydown:[e[11]||(e[11]=Be(T((...r)=>n.onEnterPressed&&n.onEnterPressed(...r),["exact","prevent"]),["enter","native"])),e[12]||(e[12]=Be(T((...r)=>n.onShiftEnterPressed&&n.onShiftEnterPressed(...r),["shift","exact","prevent"]),["enter","native"]))],class:"bg-gray-50 border border-gray-300 dark:border-zinc-800 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-zinc-800 dark:text-zinc-100 dark:border-zinc-900",rows:"3",placeholder:"Send a message..."},null,40,vi),[[ie,a.newMessageText]]),o("div",pi,[o("button",{onClick:e[13]||(e[13]=(...r)=>n.addFilesToMessage&&n.addFilesToMessage(...r)),type:"button",class:"my-auto mr-1 inline-flex items-center gap-x-1 rounded-md bg-gray-500 px-2.5 py-1.5 text-sm font-semibold text-white shadow-sm hover:bg-gray-400 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-gray-500 dark:bg-zinc-800 dark:text-white dark:hover:bg-zinc-700 dark:focus-visible:outline-zinc-500"},bi),o("div",null,[k(m,{onAddImage:n.onImageSelected},null,8,["onAddImage"])]),o("div",null,[k(v,{"is-recording-audio-attachment":a.isRecordingAudioAttachment,onStartRecording:e[14]||(e[14]=r=>n.startRecordingAudioAttachment(r)),onStopRecording:n.stopRecordingAudioAttachment},{default:S(()=>[o("span",null,"Recording: "+_(a.audioAttachmentRecordingDuration),1)]),_:1},8,["is-recording-audio-attachment","onStopRecording"])]),o("div",wi,[k(y,{onSend:n.sendMessage,onDeliveryMethodChanged:e[15]||(e[15]=r=>this.newMessageDeliveryMethod=r),"is-sending-message":a.isSendingMessage,"can-send-message":n.canSendMessage,"delivery-method":a.newMessageDeliveryMethod},null,8,["onSend","is-sending-message","can-send-message","delivery-method"])])])])])]),o("input",{ref:"file-input",onChange:e[16]||(e[16]=(...r)=>n.onFileInputChange&&n.onFileInputChange(...r)),type:"file",multiple:"",style:{display:"none"}},null,544)])):(d(),c("div",xi,[ki,o("div",Mi,[o("button",{onClick:e[17]||(e[17]=T((...r)=>n.openLXMFAddress&&n.openLXMFAddress(...r),["stop"])),type:"button",class:"my-auto inline-flex items-center gap-x-1 rounded-md bg-gray-500 px-2 py-1 text-sm font-semibold text-white shadow-sm hover:bg-gray-400 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-gray-500 dark:bg-zinc-800 dark:text-white dark:hover:bg-zinc-700 dark:focus-visible:outline-zinc-500"}," Enter an LXMF Address ")])]))}const Ai=$(Po,[["render",Ci]]),Pi={name:"MessagesPage",components:{ConversationViewer:Ai,MessagesSidebar:as},data(){return{reloadInterval:null,config:null,peers:{},selectedPeer:null,conversations:[],lxmfDeliveryAnnounces:[]}},beforeUnmount(){clearInterval(this.reloadInterval),X.off("message",this.onWebsocketMessage),ne.off("compose-new-message",this.onComposeNewMessage)},mounted(){X.on("message",this.onWebsocketMessage),ne.on("compose-new-message",this.onComposeNewMessage),this.getConfig(),this.getConversations(),this.getLxmfDeliveryAnnounces(),this.reloadInterval=setInterval(()=>{this.getConversations()},5e3)},methods:{async onComposeNewMessage(t){if(t==null&&(t=await b.prompt("Enter LXMF Address"),!t))return;t.startsWith("lxmf@")&&(t=t.replace("lxmf@",""));const e=this.peers[t];if(e){this.onPeerClick(e);return}if(t.length!==32){b.alert("Invalid Address");return}this.onPeerClick({display_name:"Unknown Peer",destination_hash:t})},async getConfig(){try{const t=await window.axios.get("/api/v1/config");this.config=t.data.config}catch(t){console.log(t)}},async onWebsocketMessage(t){const e=JSON.parse(t.data);switch(e.type){case"config":{this.config=e.config;break}case"announce":{e.announce.aspect==="lxmf.delivery"&&this.updatePeerFromAnnounce(e.announce);break}case"lxmf.delivery":{await this.getConversations();break}}},async getLxmfDeliveryAnnounces(){try{const e=(await window.axios.get("/api/v1/announces",{params:{aspect:"lxmf.delivery",limit:500}})).data.announces;for(const s of e)this.updatePeerFromAnnounce(s)}catch(t){console.log(t)}},async getConversations(){try{const t=await window.axios.get("/api/v1/lxmf/conversations");this.conversations=t.data.conversations}catch(t){console.log(t)}},updatePeerFromAnnounce:function(t){this.peers[t.destination_hash]=t},onPeerClick:function(t){this.selectedPeer=t},onConversationClick:function(t){this.onPeerClick(t),this.$refs["conversation-viewer"].markConversationAsRead(t)}},watch:{conversations(){Qe.unreadConversationsCount=this.conversations.filter(t=>t.is_unread).length}}},Si={class:"flex flex-col flex-1 overflow-hidden min-w-full sm:min-w-[500px] dark:bg-zinc-950"};function Bi(t,e,s,i,a,n){var h,m;const u=B("MessagesSidebar"),l=B("ConversationViewer");return d(),c(E,null,[k(u,{conversations:a.conversations,peers:a.peers,"selected-destination-hash":(h=a.selectedPeer)==null?void 0:h.destination_hash,onConversationClick:n.onConversationClick,onPeerClick:n.onPeerClick},null,8,["conversations","peers","selected-destination-hash","onConversationClick","onPeerClick"]),o("div",Si,[k(l,{ref:"conversation-viewer","my-lxmf-address-hash":(m=a.config)==null?void 0:m.lxmf_address_hash,"selected-peer":a.selectedPeer,conversations:a.conversations,onClose:e[0]||(e[0]=v=>a.selectedPeer=null),onReloadConversations:n.getConversations},null,8,["my-lxmf-address-hash","selected-peer","conversations","onReloadConversations"])])],64)}const Ii=$(Pi,[["render",Bi]]);export{Ii as default};
