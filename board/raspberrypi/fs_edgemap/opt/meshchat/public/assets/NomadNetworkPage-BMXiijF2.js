import{_ as p,U as y,o as c,c as h,a as t,h as f,v as _,b as u,F as b,f as k,n as v,t as g,W as m,D as w,r as P,e as N,q as C}from"./app-CqTJZnNE.js";const x={name:"NomadNetworkSidebar",props:{nodes:Object,selectedDestinationHash:String},data(){return{nodesSearchTerm:""}},methods:{onNodeClick(e){this.$emit("node-click",e)},formatTimeAgo:function(e){return y.formatTimeAgo(e)}},computed:{nodesCount(){return Object.keys(this.nodes).length},nodesOrderedByLatestAnnounce(){return Object.values(this.nodes).sort(function(s,n){const l=new Date(s.updated_at).getTime();return new Date(n.updated_at).getTime()-l})},searchedNodes(){return this.nodesOrderedByLatestAnnounce.filter(e=>{const s=this.nodesSearchTerm.toLowerCase(),n=e.display_name.toLowerCase().includes(s),l=e.destination_hash.toLowerCase().includes(s);return n||l})}}},F={class:"flex flex-col w-80 min-w-80"},D={class:"flex-1 flex flex-col bg-white border-r overflow-hidden"},A={key:0,class:"p-1 border-b border-gray-300"},U=["placeholder"],S={class:"flex h-full overflow-y-auto"},L={key:0,class:"w-full"},M=["onClick"],B=t("div",{class:"my-auto mr-2"},[t("div",{class:"bg-gray-200 text-gray-500 p-2 rounded"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-6 h-6"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M5.25 14.25h13.5m-13.5 0a3 3 0 0 1-3-3m3 3a3 3 0 1 0 0 6h13.5a3 3 0 1 0 0-6m-16.5-3a3 3 0 0 1 3-3h13.5a3 3 0 0 1 3 3m-19.5 0a4.5 4.5 0 0 1 .9-2.7L5.737 5.1a3.375 3.375 0 0 1 2.7-1.35h7.126c1.062 0 2.062.5 2.7 1.35l2.587 3.45a4.5 4.5 0 0 1 .9 2.7m0 0a3 3 0 0 1-3 3m0 3h.008v.008h-.008v-.008Zm0-6h.008v.008h-.008v-.008Zm-3 6h.008v.008h-.008v-.008Zm0-6h.008v.008h-.008v-.008Z"})])])],-1),H={class:"text-gray-900"},q={class:"text-gray-500 text-sm"},T={key:1,class:"mx-auto my-auto text-center leading-5"},Z={key:0,class:"flex flex-col"},K=t("div",{class:"mx-auto mb-1"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-6 h-6"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442-.745.361-1.45.999-1.45 1.827v.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 5.25h.008v.008H12v-.008Z"})])],-1),W=t("div",{class:"font-semibold"},"No Nodes Discovered",-1),$=t("div",null,"Waiting for a node to announce!",-1),j=[K,W,$],R={key:1,class:"flex flex-col"},O=t("div",{class:"mx-auto mb-1"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-6 h-6"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"})])],-1),V=t("div",{class:"font-semibold"},"No Search Results",-1),I=t("div",null,"Your search didn't match any Nodes!",-1),z=[O,V,I];function E(e,s,n,l,o,a){return c(),h("div",F,[t("div",D,[a.nodesCount>0?(c(),h("div",A,[f(t("input",{"onUpdate:modelValue":s[0]||(s[0]=d=>o.nodesSearchTerm=d),type:"text",placeholder:`Search ${a.nodesCount} Nodes...`,class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"},null,8,U),[[_,o.nodesSearchTerm]])])):u("",!0),t("div",S,[a.searchedNodes.length>0?(c(),h("div",L,[(c(!0),h(b,null,k(a.searchedNodes,d=>(c(),h("div",{onClick:r=>a.onNodeClick(d),class:v(["flex cursor-pointer p-2 border-l-2",[d.destination_hash===n.selectedDestinationHash?"bg-gray-100 border-blue-500":"bg-white border-transparent hover:bg-gray-50 hover:border-gray-200"]])},[B,t("div",null,[t("div",H,g(d.display_name),1),t("div",q,g(a.formatTimeAgo(d.updated_at)),1)])],10,M))),256))])):(c(),h("div",T,[a.nodesCount===0?(c(),h("div",Z,j)):u("",!0),o.nodesSearchTerm!==""&&a.nodesCount>0?(c(),h("div",R,z)):u("",!0)]))])])])}const J=p(x,[["render",E]]),X={name:"NomadNetworkPage",components:{NomadNetworkSidebar:J},data(){return{nodes:{},selectedNode:null,selectedNodePath:null,isLoadingNodePage:!1,nodePageRequestSequence:0,nodePagePath:null,nodePagePathUrlInput:null,nodePageContent:null,nodePageProgress:0,nodePagePathHistory:[],nodePageCache:{},isDownloadingNodeFile:!1,nodeFilePath:null,nodeFileProgress:0,nomadnetPageDownloadCallbacks:{},nomadnetFileDownloadCallbacks:{}}},beforeUnmount(){m.off("message",this.onWebsocketMessage)},mounted(){m.on("message",this.onWebsocketMessage),window.onNodePageUrlClick=e=>{this.onNodePageUrlClick(e)},this.getNomadnetworkNodeAnnounces()},methods:{async onWebsocketMessage(e){const s=JSON.parse(e.data);switch(s.type){case"announce":{s.announce.aspect==="nomadnetwork.node"&&this.updateNodeFromAnnounce(s.announce);break}case"nomadnet.page.download":{const n=s.nomadnet_page_download,l=this.getNomadnetPageDownloadCallbackKey(n.destination_hash,n.page_path),o=this.nomadnetPageDownloadCallbacks[l];if(!o){console.log("did not find nomadnet page download callback for key: "+l);return}if(n.status==="success"&&o.onSuccessCallback){o.onSuccessCallback(n.page_content),delete this.nomadnetPageDownloadCallbacks[l];return}if(n.status==="failure"&&o.onFailureCallback){o.onFailureCallback(n.failure_reason),delete this.nomadnetPageDownloadCallbacks[l];return}if(n.status==="progress"&&o.onProgressCallback){o.onProgressCallback(n.progress);return}break}case"nomadnet.file.download":{const n=s.nomadnet_file_download,l=this.getNomadnetFileDownloadCallbackKey(n.destination_hash,n.file_path),o=this.nomadnetFileDownloadCallbacks[l];if(!o){console.log("did not find nomadnet file download callback for key: "+l);return}if(n.status==="success"&&o.onSuccessCallback){o.onSuccessCallback(n.file_name,n.file_bytes),delete this.nomadnetFileDownloadCallbacks[l];return}if(n.status==="failure"&&o.onFailureCallback){o.onFailureCallback(n.failure_reason),delete this.nomadnetFileDownloadCallbacks[l];return}if(n.status==="progress"&&o.onProgressCallback){o.onProgressCallback(n.progress);return}break}}},onDestinationPathClick:function(e){w.alert(`${e.hops} ${e.hops===1?"hop":"hops"} away via ${e.next_hop_interface}`)},async getNomadnetworkNodeAnnounces(){try{const s=(await window.axios.get("/api/v1/announces",{params:{aspect:"nomadnetwork.node"}})).data.announces;for(const n of s)this.updateNodeFromAnnounce(n)}catch(e){console.log(e)}},updateNodeFromAnnounce:function(e){this.nodes[e.destination_hash]=e},async loadNodePage(e,s,n=!0,l=!0){const o=++this.nodePageRequestSequence,a=this.nodePagePath;if(this.isLoadingNodePage=!0,this.nodePagePath=`${e}:${s}`,this.nodePageContent=null,this.nodePageProgress=0,this.nodePagePathUrlInput=this.nodePagePath,this.getNodePath(e),n&&a!=null&&a!==this.nodePagePath&&this.nodePagePathHistory.push(a),l){const d=`${e}:${s}`,r=this.nodePageCache[d];if(r!=null){this.nodePageContent=r,this.isLoadingNodePage=!1;return}}this.downloadNomadNetPage(e,s,d=>{if(o!==this.nodePageRequestSequence){console.log("ignoring page content callback for previous page request");return}s.endsWith(".mu")?this.nodePageContent=MicronParser.convertMicronToHtml(d):this.nodePageContent=d;const r=`${e}:${s}`;this.nodePageCache[r]=this.nodePageContent,this.isLoadingNodePage=!1,this.getNodePath(e)},d=>{if(o!==this.nodePageRequestSequence){console.log("ignoring failure callback for previous page request");return}this.nodePageContent=`Failed loading page: ${d}`,this.isLoadingNodePage=!1,this.getNodePath(e)},d=>{if(o!==this.nodePageRequestSequence){console.log("ignoring progress callback for previous page request");return}this.nodePageProgress=Math.round(d*100)})},async reloadNodePage(){this.onNodePageUrlClick(this.nodePagePath,!1,!1)},async loadPreviousNodePage(){const e=this.nodePagePathHistory.pop();e&&this.onNodePageUrlClick(e,!1)},parseNomadnetworkUrl:function(e){if(e.startsWith(":"))return{destination_hash:null,path:e.substring(1)};if(e.includes(":")){const[s,n]=e.split(":");if(s.length===32)return{destination_hash:s,path:n}}return e.length===32?{destination_hash:e,path:"/page/index.mu"}:null},onNodePageUrlClick:function(e,s=!0,n=!0){if(e.startsWith("http://")||e.startsWith("https://")){window.open(e,"_blank");return}if(e.startsWith("lxmf@")){const o=e.replace("lxmf@","");if(o.length===32){this.openLXMFConversation(o);return}}const l=this.parseNomadnetworkUrl(e);if(l!=null){const o=l.destination_hash||this.selectedNode.destination_hash;if(l.path.startsWith("/file/")){if(this.isDownloadingNodeFile){w.alert("An existing download is in progress. Please wait for it to finish beforing starting another download.");return}this.isDownloadingNodeFile=!0,this.nodeFilePath=l.path.split("/").pop(),this.nodeFileProgress=0,this.downloadNomadNetFile(o,l.path,(a,d)=>{this.isDownloadingNodeFile=!1,this.downloadFileFromBase64(a,d)},a=>{this.isDownloadingNodeFile=!1,w.alert(`Failed to download file: ${a}`)},a=>{this.nodeFileProgress=Math.round(a*100)});return}this.selectedNode=this.nodes[o]||{display_name:"Unknown Node",destination_hash:o},this.loadNodePage(o,l.path,s,n);return}w.alert("unsupported url: "+e)},downloadFileFromBase64:async function(e,s){const n=atob(s),l=new Array(n.length);for(let i=0;i<n.length;i++)l[i]=n.charCodeAt(i);const o=new Uint8Array(l),a=new Blob([o]),d=URL.createObjectURL(a),r=document.createElement("a");r.href=d,r.download=e,r.style.display="none",document.body.append(r),r.click(),r.remove(),setTimeout(()=>URL.revokeObjectURL(d),1e4)},onNodeClick:function(e){this.selectedNode=e,this.loadNodePage(e.destination_hash,"/page/index.mu")},getNomadnetPageDownloadCallbackKey:function(e,s){return`${e}:${s}`},getNomadnetFileDownloadCallbackKey:function(e,s){return`${e}:${s}`},async getNodePath(e){this.selectedNodePath=null;try{const s=await window.axios.get(`/api/v1/destination/${e}/path`);this.selectedNodePath=s.data.path}catch(s){console.log(s)}},downloadNomadNetFile(e,s,n,l,o){try{this.nomadnetFileDownloadCallbacks[this.getNomadnetFileDownloadCallbackKey(e,s)]={onSuccessCallback:n,onFailureCallback:l,onProgressCallback:o},m.send(JSON.stringify({type:"nomadnet.file.download",nomadnet_file_download:{destination_hash:e,file_path:s}}))}catch(a){console.error(a)}},downloadNomadNetPage(e,s,n,l,o){try{this.nomadnetPageDownloadCallbacks[this.getNomadnetPageDownloadCallbackKey(e,s)]={onSuccessCallback:n,onFailureCallback:l,onProgressCallback:o},m.send(JSON.stringify({type:"nomadnet.page.download",nomadnet_page_download:{destination_hash:e,page_path:s}}))}catch(a){console.error(a)}}}},Y={class:"flex flex-col flex-1 overflow-hidden min-w-full sm:min-w-[500px]"},G={key:0,class:"m-2 flex flex-col h-full border rounded-xl bg-white shadow overflow-hidden"},Q={class:"flex p-2 border-b border-gray-300"},ee={class:"my-auto"},oe={class:"font-semibold"},te={class:"my-auto ml-auto mr-2"},se=t("div",{class:"flex text-gray-700 bg-gray-100 hover:bg-gray-200 p-1 rounded-full"},[t("div",null,[t("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",class:"w-5 h-5"},[t("path",{d:"M6.28 5.22a.75.75 0 0 0-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 1 0 1.06 1.06L10 11.06l3.72 3.72a.75.75 0 1 0 1.06-1.06L11.06 10l3.72-3.72a.75.75 0 0 0-1.06-1.06L10 8.94 6.28 5.22Z"})])])],-1),ne=[se],ae={class:"flex w-full border-gray-300 border-b p-2"},le=t("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",class:"w-5 h-5"},[t("path",{"fill-rule":"evenodd",d:"M9.293 2.293a1 1 0 0 1 1.414 0l7 7A1 1 0 0 1 17 11h-1v6a1 1 0 0 1-1 1h-2a1 1 0 0 1-1-1v-3a1 1 0 0 0-1-1H9a1 1 0 0 0-1 1v3a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-6H3a1 1 0 0 1-.707-1.707l7-7Z","clip-rule":"evenodd"})],-1),de=[le],re=t("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",class:"w-5 h-5"},[t("path",{"fill-rule":"evenodd",d:"M15.312 11.424a5.5 5.5 0 0 1-9.201 2.466l-.312-.311h2.433a.75.75 0 0 0 0-1.5H3.989a.75.75 0 0 0-.75.75v4.242a.75.75 0 0 0 1.5 0v-2.43l.31.31a7 7 0 0 0 11.712-3.138.75.75 0 0 0-1.449-.39Zm1.23-3.723a.75.75 0 0 0 .219-.53V2.929a.75.75 0 0 0-1.5 0V5.36l-.31-.31A7 7 0 0 0 3.239 8.188a.75.75 0 1 0 1.448.389A5.5 5.5 0 0 1 13.89 6.11l.311.31h-2.432a.75.75 0 0 0 0 1.5h4.243a.75.75 0 0 0 .53-.219Z","clip-rule":"evenodd"})],-1),ie=[re],ce=["disabled"],he=t("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",class:"w-5 h-5"},[t("path",{"fill-rule":"evenodd",d:"M17 10a.75.75 0 0 1-.75.75H5.612l4.158 3.96a.75.75 0 1 1-1.04 1.08l-5.5-5.25a.75.75 0 0 1 0-1.08l5.5-5.25a.75.75 0 1 1 1.04 1.08L5.612 9.25H16.25A.75.75 0 0 1 17 10Z","clip-rule":"evenodd"})],-1),ge=[he],ue={class:"my-auto mx-2 w-full"},me=t("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",class:"w-5 h-5"},[t("path",{"fill-rule":"evenodd",d:"M3 10a.75.75 0 0 1 .75-.75h10.638L10.23 5.29a.75.75 0 1 1 1.04-1.08l5.5 5.25a.75.75 0 0 1 0 1.08l-5.5 5.25a.75.75 0 1 1-1.04-1.08l4.158-3.96H3.75A.75.75 0 0 1 3 10Z","clip-rule":"evenodd"})],-1),we=[me],pe={class:"h-full overflow-y-scroll p-3 bg-black text-white"},fe={key:0,class:"flex"},_e=t("div",{class:"my-auto"},[t("svg",{class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})])],-1),be={class:"my-auto"},ve=["innerHTML"],ye={key:0,class:"flex w-full border-gray-300 border-t p-2"},ke=t("div",{class:"my-auto mr-2"},[t("svg",{class:"animate-spin h-5 w-5",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})])],-1),Pe={class:"my-auto"},Ne={key:1,class:"flex flex-col mx-auto my-auto text-center leading-5"},Ce=t("div",{class:"mx-auto mb-1"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-6 h-6"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 21a9.004 9.004 0 0 0 8.716-6.747M12 21a9.004 9.004 0 0 1-8.716-6.747M12 21c2.485 0 4.5-4.03 4.5-9S14.485 3 12 3m0 18c-2.485 0-4.5-4.03-4.5-9S9.515 3 12 3m0 0a8.997 8.997 0 0 1 7.843 4.582M12 3a8.997 8.997 0 0 0-7.843 4.582m15.686 0A11.953 11.953 0 0 1 12 10.5c-2.998 0-5.74-1.1-7.843-2.918m15.686 0A8.959 8.959 0 0 1 21 12c0 .778-.099 1.533-.284 2.253m0 0A17.919 17.919 0 0 1 12 16.5c-3.162 0-6.133-.815-8.716-2.247m0 0A9.015 9.015 0 0 1 3 12c0-1.605.42-3.113 1.157-4.418"})])],-1),xe=t("div",{class:"font-semibold"},"No Active Node",-1),Fe=t("div",null,"Select a Node to start browsing!",-1),De=[Ce,xe,Fe];function Ae(e,s,n,l,o,a){var r;const d=P("NomadNetworkSidebar");return c(),h(b,null,[N(d,{nodes:o.nodes,"selected-destination-hash":(r=o.selectedNode)==null?void 0:r.destination_hash,onNodeClick:a.onNodeClick},null,8,["nodes","selected-destination-hash","onNodeClick"]),t("div",Y,[o.selectedNode?(c(),h("div",G,[t("div",Q,[t("div",ee,[t("span",oe,g(o.selectedNode.display_name),1),o.selectedNodePath?(c(),h("span",{key:0,onClick:s[0]||(s[0]=i=>a.onDestinationPathClick(o.selectedNodePath)),class:"text-sm cursor-pointer"}," - "+g(o.selectedNodePath.hops)+" "+g(o.selectedNodePath.hops===1?"hop":"hops")+" away",1)):u("",!0)]),t("div",te,[t("div",{onClick:s[1]||(s[1]=i=>o.selectedNode=null),class:"cursor-pointer"},ne)])]),t("div",ae,[t("button",{onClick:s[2]||(s[2]=i=>a.loadNodePage(o.selectedNode.destination_hash,"/page/index.mu")),type:"button",class:"my-auto text-gray-500 bg-gray-200 hover:bg-gray-300 rounded p-1 cursor-pointer"},de),t("button",{onClick:s[3]||(s[3]=(...i)=>a.reloadNodePage&&a.reloadNodePage(...i)),type:"button",class:"ml-1 my-auto text-gray-500 bg-gray-200 hover:bg-gray-300 rounded p-1 cursor-pointer"},ie),t("button",{onClick:s[4]||(s[4]=(...i)=>a.loadPreviousNodePage&&a.loadPreviousNodePage(...i)),type:"button",disabled:o.nodePagePathHistory.length===0,class:v([[o.nodePagePathHistory.length>0?"text-gray-500 bg-gray-200 hover:bg-gray-300":"text-gray-400 bg-gray-100"],"ml-1 my-auto rounded p-1 cursor-pointer"])},ge,10,ce),t("div",ue,[f(t("input",{"onUpdate:modelValue":s[5]||(s[5]=i=>o.nodePagePathUrlInput=i),onKeyup:s[6]||(s[6]=C(i=>a.onNodePageUrlClick(o.nodePagePathUrlInput),["enter"])),type:"text",placeholder:"Enter Destination URL",class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full px-2.5 py-1.5"},null,544),[[_,o.nodePagePathUrlInput]])]),t("button",{onClick:s[7]||(s[7]=i=>a.onNodePageUrlClick(o.nodePagePathUrlInput)),type:"button",class:"my-auto text-gray-500 bg-gray-200 hover:bg-gray-300 rounded p-1 cursor-pointer"},we)]),t("div",pe,[o.isLoadingNodePage?(c(),h("div",fe,[_e,t("div",be,"Loading "+g(o.nodePageProgress)+"%",1)])):(c(),h("pre",{key:1,innerHTML:o.nodePageContent,class:"h-full text-wrap"},null,8,ve))]),o.isDownloadingNodeFile?(c(),h("div",ye,[ke,t("div",Pe,"Downloading: "+g(o.nodeFilePath)+" ("+g(o.nodeFileProgress)+"%)",1)])):u("",!0)])):(c(),h("div",Ne,De))])],64)}const Se=p(X,[["render",Ae]]);export{Se as default};
