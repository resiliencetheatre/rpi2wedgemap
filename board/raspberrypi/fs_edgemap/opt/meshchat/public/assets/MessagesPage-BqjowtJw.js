import{_ as S,U as p,o as r,c as l,a as t,n as w,h as k,v as R,b as h,F as b,f as A,t as g,k as F,l as j,e as M,w as T,T as N,W as P,N as Z,D as v,m as V,r as L,d as D,p as C,q as $,s as I,G as U,u as O}from"./app-fuN8N8Gp.js";const H={name:"MessagesSidebar",props:{peers:Object,conversations:Array,selectedDestinationHash:String},data(){return{tab:"conversations",conversationsSearchTerm:"",peersSearchTerm:""}},methods:{onConversationClick(e){this.$emit("conversation-click",e)},onPeerClick(e){this.$emit("peer-click",e)},formatTimeAgo:function(e){return p.formatTimeAgo(e)}},computed:{searchedConversations(){return this.conversations.filter(e=>{var o,c;const s=this.conversationsSearchTerm.toLowerCase(),n=e.display_name.toLowerCase().includes(s),d=((c=(o=e.custom_display_name)==null?void 0:o.toLowerCase())==null?void 0:c.includes(s))===!0,a=e.destination_hash.toLowerCase().includes(s);return n||d||a})},peersCount(){return Object.keys(this.peers).length},peersOrderedByLatestAnnounce(){return Object.values(this.peers).sort(function(s,n){const d=new Date(s.updated_at).getTime();return new Date(n.updated_at).getTime()-d})},searchedPeers(){return this.peersOrderedByLatestAnnounce.filter(e=>{var o,c;const s=this.peersSearchTerm.toLowerCase(),n=e.display_name.toLowerCase().includes(s),d=((c=(o=e.custom_display_name)==null?void 0:o.toLowerCase())==null?void 0:c.includes(s))===!0,a=e.destination_hash.toLowerCase().includes(s);return n||d||a})}}},z={class:"flex flex-col w-80 min-w-80"},E={class:"bg-white border-b border-r border-gray-200"},W={class:"-mb-px flex"},q={key:0,class:"flex-1 flex flex-col bg-white border-r overflow-hidden"},Q={key:0,class:"p-1 border-b border-gray-300"},Y=["placeholder"],K={class:"flex h-full overflow-y-auto"},G={key:0,class:"w-full"},J=["onClick"],X=t("div",{class:"my-auto mr-2"},[t("div",{class:"bg-gray-200 text-gray-500 p-2 rounded"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-6 h-6"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z"})])])],-1),ee={class:"mr-auto"},se={class:"text-gray-500 text-sm"},te={key:0,class:"my-auto ml-2 mr-2"},oe=t("div",{class:"bg-blue-500 rounded-full p-1"},null,-1),ne=[oe],ie={key:1,class:"my-auto ml-2 mr-2"},ae=t("div",{class:"bg-red-500 rounded-full p-1"},null,-1),re=[ae],le={key:1,class:"mx-auto my-auto text-center leading-5"},de={key:0,class:"flex flex-col"},ce=t("div",{class:"mx-auto mb-1"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"size-6"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M2.25 13.5h3.86a2.25 2.25 0 0 1 2.012 1.244l.256.512a2.25 2.25 0 0 0 2.013 1.244h3.218a2.25 2.25 0 0 0 2.013-1.244l.256-.512a2.25 2.25 0 0 1 2.013-1.244h3.859m-19.5.338V18a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18v-4.162c0-.224-.034-.447-.1-.661L19.24 5.338a2.25 2.25 0 0 0-2.15-1.588H6.911a2.25 2.25 0 0 0-2.15 1.588L2.35 13.177a2.25 2.25 0 0 0-.1.661Z"})])],-1),ue=t("div",{class:"font-semibold"},"No Conversations",-1),he=t("div",null,"Discover peers on the Announces tab",-1),me=[ce,ue,he],ge={key:1,class:"flex flex-col"},fe=t("div",{class:"mx-auto mb-1"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-6 h-6"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"})])],-1),ve=t("div",{class:"font-semibold"},"No Search Results",-1),_e=t("div",null,"Your search didn't match any Conversations!",-1),pe=[fe,ve,_e],we={key:1,class:"flex-1 flex flex-col bg-white border-r overflow-hidden"},ye={key:0,class:"p-1 border-b border-gray-300"},xe=["placeholder"],be={class:"flex h-full overflow-y-auto"},ke={key:0,class:"w-full"},Me=["onClick"],Ce=t("div",{class:"my-auto mr-2"},[t("div",{class:"bg-gray-200 text-gray-500 p-2 rounded"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-6 h-6"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z"})])])],-1),Ae={class:"text-gray-900"},Se={class:"text-gray-500 text-sm"},Pe={key:1,class:"mx-auto my-auto text-center leading-5"},Le={key:0,class:"flex flex-col"},Be=t("div",{class:"mx-auto mb-1"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-6 h-6"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442-.745.361-1.45.999-1.45 1.827v.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 5.25h.008v.008H12v-.008Z"})])],-1),Re=t("div",{class:"font-semibold"},"No Peers Discovered",-1),Te=t("div",null,"Waiting for someone to announce!",-1),De=[Be,Re,Te],Ie={key:1,class:"flex flex-col"},Ue=t("div",{class:"mx-auto mb-1"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-6 h-6"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"})])],-1),Fe=t("div",{class:"font-semibold"},"No Search Results",-1),Ne=t("div",null,"Your search didn't match any Peers!",-1),je=[Ue,Fe,Ne];function Ze(e,s,n,d,a,o){return r(),l("div",z,[t("div",E,[t("div",W,[t("div",{onClick:s[0]||(s[0]=c=>a.tab="conversations"),class:w(["w-full border-b-2 py-3 px-1 text-center text-sm font-medium cursor-pointer",[a.tab==="conversations"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700"]])},"Conversations",2),t("div",{onClick:s[1]||(s[1]=c=>a.tab="announces"),class:w(["w-full border-b-2 py-3 px-1 text-center text-sm font-medium cursor-pointer",[a.tab==="announces"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700"]])},"Announces",2)])]),a.tab==="conversations"?(r(),l("div",q,[n.conversations.length>0?(r(),l("div",Q,[k(t("input",{"onUpdate:modelValue":s[2]||(s[2]=c=>a.conversationsSearchTerm=c),type:"text",placeholder:`Search ${n.conversations.length} Conversations...`,class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"},null,8,Y),[[R,a.conversationsSearchTerm]])])):h("",!0),t("div",K,[o.searchedConversations.length>0?(r(),l("div",G,[(r(!0),l(b,null,A(o.searchedConversations,c=>(r(),l("div",{onClick:u=>o.onConversationClick(c),class:w(["flex cursor-pointer p-2 border-l-2",[c.destination_hash===n.selectedDestinationHash?"bg-gray-100 border-blue-500":"bg-white border-transparent hover:bg-gray-50 hover:border-gray-200"]])},[X,t("div",ee,[t("div",{class:w(["text-gray-900",{"font-semibold":c.is_unread||c.failed_messages_count>0}])},g(c.custom_display_name??c.display_name),3),t("div",se,g(o.formatTimeAgo(c.updated_at)),1)]),c.is_unread?(r(),l("div",te,ne)):c.failed_messages_count?(r(),l("div",ie,re)):h("",!0)],10,J))),256))])):(r(),l("div",le,[n.conversations.length===0?(r(),l("div",de,me)):h("",!0),a.conversationsSearchTerm!==""&&n.conversations.length>0?(r(),l("div",ge,pe)):h("",!0)]))])])):h("",!0),a.tab==="announces"?(r(),l("div",we,[o.peersCount>0?(r(),l("div",ye,[k(t("input",{"onUpdate:modelValue":s[3]||(s[3]=c=>a.peersSearchTerm=c),type:"text",placeholder:`Search ${o.peersCount} recent announces...`,class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"},null,8,xe),[[R,a.peersSearchTerm]])])):h("",!0),t("div",be,[o.searchedPeers.length>0?(r(),l("div",ke,[(r(!0),l(b,null,A(o.searchedPeers,c=>(r(),l("div",{onClick:u=>o.onPeerClick(c),class:w(["flex cursor-pointer p-2 border-l-2",[c.destination_hash===n.selectedDestinationHash?"bg-gray-100 border-blue-500":"bg-white border-transparent hover:bg-gray-50 hover:border-gray-200"]])},[Ce,t("div",null,[t("div",Ae,g(c.custom_display_name??c.display_name),1),t("div",Se,g(o.formatTimeAgo(c.updated_at)),1)])],10,Me))),256))])):(r(),l("div",Pe,[o.peersCount===0?(r(),l("div",Le,De)):h("",!0),a.peersSearchTerm!==""&&o.peersCount>0?(r(),l("div",Ie,je)):h("",!0)]))])])):h("",!0)])}const Ve=S(H,[["render",Ze]]);class $e{constructor(){this.audioChunks=[],this.microphoneMediaStream=null,this.mediaRecorder=null}async start(){try{return this.microphoneMediaStream=await navigator.mediaDevices.getUserMedia({audio:!0}),this.mediaRecorder=new MediaRecorder(this.microphoneMediaStream),this.mediaRecorder.ondataavailable=s=>{this.audioChunks.push(s.data)},this.mediaRecorder.start(),!0}catch{return!1}}async stop(){return new Promise((s,n)=>{try{this.mediaRecorder.onstop=()=>{this.microphoneMediaStream&&this.microphoneMediaStream.getTracks().forEach(a=>a.stop());const d=new Blob(this.audioChunks,{type:this.mediaRecorder.mimeType});s(d)},this.mediaRecorder.stop()}catch(d){n(d)}})}}const Oe={name:"AddAudioButton",props:{isRecordingAudioAttachment:Boolean},data(){return{isShowingMenu:!1}},methods:{showMenu(){this.isShowingMenu=!0},hideMenu(){this.isShowingMenu=!1},startRecordingAudioAttachment(e){this.isShowingMenu=!1,this.$emit("start-recording",e)},startRecordingCodec2(e){this.startRecordingAudioAttachment({codec:"codec2",mode:e})},startRecordingOpus(){this.startRecordingAudioAttachment({codec:"opus"})},stopRecordingAudioAttachment(){this.isShowingMenu=!1,this.$emit("stop-recording")}}},He={class:"inline-flex rounded-md shadow-sm"},ze=t("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",class:"size-5"},[t("path",{d:"M7 4a3 3 0 0 1 6 0v6a3 3 0 1 1-6 0V4Z"}),t("path",{d:"M5.5 9.643a.75.75 0 0 0-1.5 0V10c0 3.06 2.29 5.585 5.25 5.954V17.5h-1.5a.75.75 0 0 0 0 1.5h4.5a.75.75 0 0 0 0-1.5h-1.5v-1.546A6.001 6.001 0 0 0 16 10v-.357a.75.75 0 0 0-1.5 0V10a4.5 4.5 0 0 1-9 0v-.357Z"})],-1),Ee={class:"ml-1"},We=t("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",class:"size-5"},[t("path",{d:"M7 4a3 3 0 0 1 6 0v6a3 3 0 1 1-6 0V4Z"}),t("path",{d:"M5.5 9.643a.75.75 0 0 0-1.5 0V10c0 3.06 2.29 5.585 5.25 5.954V17.5h-1.5a.75.75 0 0 0 0 1.5h4.5a.75.75 0 0 0 0-1.5h-1.5v-1.546A6.001 6.001 0 0 0 16 10v-.357a.75.75 0 0 0-1.5 0V10a4.5 4.5 0 0 1-9 0v-.357Z"})],-1),qe=t("span",{class:"ml-1 hidden xl:inline-block whitespace-nowrap"},"Add Voice",-1),Qe=[We,qe],Ye={class:"relative block"},Ke={key:0,class:"absolute bottom-0 -ml-11 sm:right-0 sm:ml-0 z-10 mb-10 rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},Ge={class:"py-1"};function Je(e,s,n,d,a,o){const c=F("click-outside");return r(),l("div",He,[n.isRecordingAudioAttachment?(r(),l("button",{key:0,onClick:s[0]||(s[0]=(...u)=>o.stopRecordingAudioAttachment&&o.stopRecordingAudioAttachment(...u)),type:"button",class:"my-auto mr-1 inline-flex items-center gap-x-1 rounded-md bg-red-500 px-2.5 py-1.5 text-sm font-semibold text-white shadow-sm hover:bg-red-400 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-red-500"},[ze,t("span",Ee,[j(e.$slots,"default")])])):(r(),l("button",{key:1,onClick:s[1]||(s[1]=(...u)=>o.showMenu&&o.showMenu(...u)),type:"button",class:"my-auto mr-1 inline-flex items-center gap-x-1 rounded-md bg-gray-500 px-2.5 py-1.5 text-sm font-semibold text-white shadow-sm hover:bg-gray-400 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-gray-500"},Qe)),t("div",Ye,[M(N,{"enter-active-class":"transition ease-out duration-100","enter-from-class":"transform opacity-0 scale-95","enter-to-class":"transform opacity-100 scale-100","leave-active-class":"transition ease-in duration-75","leave-from-class":"transform opacity-100 scale-100","leave-to-class":"transform opacity-0 scale-95"},{default:T(()=>[a.isShowingMenu?k((r(),l("div",Ke,[t("div",Ge,[t("button",{onClick:s[2]||(s[2]=u=>o.startRecordingCodec2("1200")),type:"button",class:"w-full block text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 whitespace-nowrap"},"Low Quality - Codec2 (1200)"),t("button",{onClick:s[3]||(s[3]=u=>o.startRecordingCodec2("3200")),type:"button",class:"w-full block text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 whitespace-nowrap"},"Medium Quality - Codec2 (3200)"),t("button",{onClick:s[4]||(s[4]=u=>o.startRecordingOpus()),type:"button",class:"w-full block text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 whitespace-nowrap"},"High Quality - OPUS")])])),[[c,o.hideMenu]]):h("",!0)]),_:1})])])}const Xe=S(Oe,[["render",Je]]),es={name:"SendMessageButton",props:{deliveryMethod:String,canSendMessage:Boolean,isSendingMessage:Boolean},data(){return{isShowingMenu:!1}},methods:{showMenu(){this.isShowingMenu=!0},hideMenu(){this.isShowingMenu=!1},setDeliveryMethod(e){this.$emit("delivery-method-changed",e),this.hideMenu()},send(){this.$emit("send")}}},ss={class:"inline-flex rounded-md shadow-sm"},ts=["disabled"],os={key:0},ns={key:1,class:"space-x-1"},is=t("span",null,"Send",-1),as={key:0},rs={key:1},ls={key:2},ds={class:"relative"},cs=["disabled"],us=t("svg",{class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"fill-rule":"evenodd",d:"M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z","clip-rule":"evenodd"})],-1),hs=[us],ms={key:0,class:"absolute bottom-0 -ml-11 right-0 ml-0 z-10 mb-10 rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},gs={class:"py-1"};function fs(e,s,n,d,a,o){const c=F("click-outside");return r(),l("div",ss,[t("button",{onClick:s[0]||(s[0]=(...u)=>o.send&&o.send(...u)),disabled:!n.canSendMessage,type:"button",class:w(["my-auto inline-flex items-center rounded-l-md px-2.5 py-1.5 text-sm font-semibold text-white focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2",[n.canSendMessage?"bg-blue-500 hover:bg-blue-400 focus-visible:outline-blue-500":"bg-gray-400 focus-visible:outline-gray-500 cursor-not-allowed"]])},[n.isSendingMessage?(r(),l("span",os,"Sending...")):(r(),l("span",ns,[is,n.deliveryMethod==="direct"?(r(),l("span",as,"(Direct Link)")):h("",!0),n.deliveryMethod==="opportunistic"?(r(),l("span",rs,"(Opportunistic)")):h("",!0),n.deliveryMethod==="propagated"?(r(),l("span",ls,"(Propagated)")):h("",!0)]))],10,ts),t("div",ds,[t("button",{onClick:s[1]||(s[1]=(...u)=>o.showMenu&&o.showMenu(...u)),disabled:!n.canSendMessage,type:"button",class:w(["my-auto border-l relative inline-flex items-center rounded-r-md bg-gray-500 focus-visible:outline-gray-400 px-2 py-1.5 text-white focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2",[n.canSendMessage?"bg-blue-500 hover:bg-blue-400 focus-visible:outline-blue-500":"bg-gray-400 focus-visible:outline-gray-500 cursor-not-allowed"]])},hs,10,cs),M(N,{"enter-active-class":"transition ease-out duration-100","enter-from-class":"transform opacity-0 scale-95","enter-to-class":"transform opacity-100 scale-100","leave-active-class":"transition ease-in duration-75","leave-from-class":"transform opacity-100 scale-100","leave-to-class":"transform opacity-0 scale-95"},{default:T(()=>[a.isShowingMenu?k((r(),l("div",ms,[t("div",gs,[t("button",{onClick:s[2]||(s[2]=u=>o.setDeliveryMethod(null)),type:"button",class:"w-full block text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 whitespace-nowrap border-b"},"Send Automatically"),t("button",{onClick:s[3]||(s[3]=u=>o.setDeliveryMethod("direct")),type:"button",class:"w-full block text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 whitespace-nowrap"},"Send over Direct Link"),t("button",{onClick:s[4]||(s[4]=u=>o.setDeliveryMethod("opportunistic")),type:"button",class:"w-full block text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 whitespace-nowrap"},"Send Opportunistically"),t("button",{onClick:s[5]||(s[5]=u=>o.setDeliveryMethod("propagated")),type:"button",class:"w-full block text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 whitespace-nowrap"},"Send to Propagation Node")])])),[[c,o.hideMenu]]):h("",!0)]),_:1})])])}const vs=S(es,[["render",fs]]),_s={name:"ConversationViewer",components:{SendMessageButton:vs,AddAudioButton:Xe},props:{myLxmfAddressHash:String,selectedPeer:Object,conversations:Array},data(){return{selectedPeerPath:null,selectedPeerLxmfStampInfo:null,lxmfMessagesRequestSequence:0,chatItems:[],isLoadingPrevious:!1,hasMorePrevious:!0,newMessageDeliveryMethod:null,newMessageText:"",newMessageImage:null,newMessageImageUrl:null,newMessageAudio:null,newMessageFiles:[],isSendingMessage:!1,autoScrollOnNewMessage:!0,isRecordingAudioAttachment:!1,audioAttachmentMicrophoneRecorder:null,audioAttachmentMicrophoneRecorderCodec:null,audioAttachmentRecordingStartedAt:null,audioAttachmentRecordingDuration:null,audioAttachmentRecordingTimer:null,lxmfMessageAudioAttachmentCache:{},lxmfAudioModeToCodec2ModeMap:{1:"450PWB",2:"450",3:"700C",4:"1200",5:"1300",6:"1400",7:"1600",8:"2400",9:"3200"}}},beforeUnmount(){P.off("message",this.onWebsocketMessage)},mounted(){P.on("message",this.onWebsocketMessage)},methods:{close(){this.$emit("close")},onMessagesScroll(e){const s=e.target,n=s.scrollTop===s.scrollHeight-s.offsetHeight;this.autoScrollOnNewMessage=n,s.scrollTop<=500&&this.loadPrevious()},async initialLoad(){this.chatItems=[],this.hasMorePrevious=!0,this.selectedPeer&&(this.getPeerPath(),this.getPeerLxmfStampInfo(),await this.loadPrevious(),this.scrollMessagesToBottom())},async loadPrevious(){if(!this.isLoadingPrevious){this.isLoadingPrevious=!0;try{const e=++this.lxmfMessagesRequestSequence,s=30,n=await window.axios.get(`/api/v1/lxmf-messages/conversation/${this.selectedPeer.destination_hash}`,{params:{count:s,order:"desc",after_id:this.oldestMessageId}});if(e!==this.lxmfMessagesRequestSequence){console.log("ignoring response for previous lxmf messages request");return}const d=[],a=n.data.lxmf_messages;for(const o of a)d.push({type:"lxmf_message",is_outbound:this.myLxmfAddressHash===o.source_hash,lxmf_message:o});for(const o of d)this.chatItems.unshift(o);d.length<s&&(this.hasMorePrevious=!1)}catch{}finally{this.isLoadingPrevious=!1}}},async onWebsocketMessage(e){var n;const s=JSON.parse(e.data);switch(s.type){case"announce":{s.announce.destination_hash===((n=this.selectedPeer)==null?void 0:n.destination_hash)&&await this.getPeerLxmfStampInfo();break}case"lxmf.delivery":{this.onLxmfMessageReceived(s.lxmf_message),await this.getPeerPath();break}case"lxmf_message_created":{this.onLxmfMessageCreated(s.lxmf_message),await this.getPeerPath();break}case"lxmf_message_state_updated":{this.onLxmfMessageUpdated(s.lxmf_message);break}case"lxmf_message_deleted":{this.onLxmfMessageDeleted(s.hash);break}}},onLxmfMessageReceived(e){var s;if(this.chatItems.push({type:"lxmf_message",lxmf_message:e}),e.source_hash===((s=this.selectedPeer)==null?void 0:s.destination_hash)){const n=this.findConversation(this.selectedPeer.destination_hash);n&&this.markConversationAsRead(n)}document.hasFocus()||Z.showNewMessageNotification(),this.autoScrollOnNewMessage&&this.scrollMessagesToBottom()},onLxmfMessageCreated(e){this.isLxmfMessageInUi(e.hash)||this.chatItems.push({type:"lxmf_message",lxmf_message:e,is_outbound:!0})},onLxmfMessageUpdated(e){const s=e.hash,n=this.chatItems.findIndex(d=>{var a;return((a=d.lxmf_message)==null?void 0:a.hash)===s});if(n===-1){console.log("did not find existing chat item index for lxmf message hash: "+e.hash);return}this.chatItems[n].lxmf_message=e},onLxmfMessageDeleted(e){e&&(this.chatItems=this.chatItems.filter(s=>{var n;return((n=s.lxmf_message)==null?void 0:n.hash)!==e}))},async getPeerPath(){if(this.selectedPeerPath=null,this.selectedPeer)try{const e=await window.axios.get(`/api/v1/destination/${this.selectedPeer.destination_hash}/path`);this.selectedPeerPath=e.data.path}catch(e){console.log(e)}},async getPeerLxmfStampInfo(){if(this.selectedPeerLxmfStampInfo=null,this.selectedPeer)try{const e=await window.axios.get(`/api/v1/destination/${this.selectedPeer.destination_hash}/lxmf-stamp-info`);this.selectedPeerLxmfStampInfo=e.data.lxmf_stamp_info}catch(e){console.log(e)}},onDestinationPathClick(e){v.alert(`${e.hops} ${e.hops===1?"hop":"hops"} away via ${e.next_hop_interface}`)},onStampInfoClick(e){const s=e.stamp_cost,n=e.outbound_ticket_expiry;var d="";s>=24?d="several hours":s>=20?d="more than an hour":s>=18?d="~5 minutes":s>=17?d="a few minutes":s>=16?d="~1 minute":s>=13?d="~30 seconds":s>=9?d="~10 seconds":s>=1?d="a few seconds":d="0 seconds",n!=null&&(d=`instant (ticket expires ${V(n*1e3).fromNow()})`),v.alert(`This peer has enabled stamp security.

Your device must have a ticket, or solve an automated proof of work task each time you send them a message.

Time per message: ${d}`)},scrollMessagesToBottom:function(){this.$nextTick(()=>{setTimeout(()=>{const e=document.getElementById("messages");e&&(e.scrollTop=e.scrollHeight)},0)})},isLxmfMessageInUi:function(e){return this.chatItems.findIndex(s=>{var n;return((n=s.lxmf_message)==null?void 0:n.hash)===e})!==-1},async getCustomDisplayName(){if(this.selectedPeer)try{const e=await window.axios.get(`/api/v1/destination/${this.selectedPeer.destination_hash}/custom-display-name`);this.selectedPeer.custom_display_name=e.data.custom_display_name}catch(e){console.log(e)}},async updateCustomDisplayName(){if(!this.selectedPeer)return;const e=await v.prompt("Enter a custom display name");if(e!=null)try{await axios.post(`/api/v1/destination/${this.selectedPeer.destination_hash}/custom-display-name/update`,{display_name:e}),await this.getCustomDisplayName(),this.$emit("reload-conversations")}catch(s){console.log(s),v.alert("Failed to update display name")}},async deleteConversation(){if(this.selectedPeer&&confirm("Are you sure you want to delete all messages from this conversation? This can not be undone!")){try{await window.axios.delete(`/api/v1/lxmf-messages/conversation/${this.selectedPeer.destination_hash}`)}catch(e){v.alert("failed to delete conversation"),console.log(e)}await this.initialLoad(),this.$emit("reload-conversations")}},onChatItemClick:function(e){e.is_actions_expanded?e.is_actions_expanded=!1:e.is_actions_expanded=!0},openImage:async function(e){const s=await(await fetch(e)).blob(),n=window.URL.createObjectURL(s);window.open(n)},downloadFileFromBase64:async function(e,s){const n=atob(s),d=new Array(n.length);for(let i=0;i<n.length;i++)d[i]=n.charCodeAt(i);const a=new Uint8Array(d),o=new Blob([a]),c=URL.createObjectURL(o),u=document.createElement("a");u.href=c,u.download=e,u.style.display="none",document.body.append(u),u.click(),u.remove(),setTimeout(()=>URL.revokeObjectURL(c),1e4)},async processAudioForSelectedPeerChatItems(){var e,s;for(const n of this.selectedPeerChatItems){if(!((s=(e=n.lxmf_message)==null?void 0:e.fields)!=null&&s.audio)||this.lxmfMessageAudioAttachmentCache[n.lxmf_message.hash])continue;const d=await this.decodeLxmfAudioFieldToBlobUrl(n.lxmf_message.fields.audio);d&&(this.lxmfMessageAudioAttachmentCache[n.lxmf_message.hash]=d)}},async decodeLxmfAudioFieldToBlobUrl(e){try{const s=e.audio_mode,n=e.audio_bytes;if(s===16)return this.decodeOpusAudioToBlobUrl(e.audio_bytes);const d=this.lxmfAudioModeToCodec2ModeMap[s];if(!d)return console.log("unsupported audio mode: "+s),null;const a=this.base64ToArrayBuffer(n),o=await Codec2Lib.runDecode(d,new Uint8Array(a)),c=await Codec2Lib.rawToWav(o),u=new Blob([c],{type:"audio/wav"});return URL.createObjectURL(u)}catch(s){return console.log(s),null}},async decodeOpusAudioToBlobUrl(e){try{const s=this.base64ToArrayBuffer(e),n=new Blob([s],{type:"audio/opus"});return URL.createObjectURL(n)}catch(s){return console.log(s),null}},base64ToArrayBuffer:function(e){return Uint8Array.from(atob(e),s=>s.charCodeAt(0))},async deleteChatItem(e,s=!0){try{if(s&&!confirm("Are you sure you want to delete this message? This can not be undone!")||e.type!=="lxmf_message")return;await window.axios.delete(`/api/v1/lxmf-messages/${e.lxmf_message.hash}`),this.chatItems=this.chatItems.filter(n=>{var d;return((d=n.lxmf_message)==null?void 0:d.hash)!==e.lxmf_message.hash})}catch{}},async sendMessage(){var d,a;if(this.canSendMessage&&this.selectedPeer){this.isSendingMessage=!0;try{const o={};var e=0;if(this.newMessageFiles.length>0){const f=[];for(const _ of this.newMessageFiles)e+=_.size,f.push({file_name:_.name,file_bytes:p.arrayBufferToBase64(await _.arrayBuffer())});o.file_attachments=f}var s=0;this.newMessageImage&&(s=this.newMessageImage.size,o.image={image_type:this.newMessageImage.type.replace("image/",""),image_bytes:p.arrayBufferToBase64(await this.newMessageImage.arrayBuffer())});var n=0;this.newMessageAudio&&(n=this.newMessageAudio.size,o.audio={audio_mode:this.newMessageAudio.audio_mode,audio_bytes:p.arrayBufferToBase64(await this.newMessageAudio.audio_blob.arrayBuffer())});const u=this.newMessageText.length+e+s+n;if(u>1e3*900&&!confirm(`Your message exceeds 900KB (It's ${this.formatBytes(u)}). It may be rejected by the recipient unless they have increased their delivery limit. Do you want to try sending anyway?`))return;const i=await window.axios.post("/api/v1/lxmf-messages/send",{delivery_method:this.newMessageDeliveryMethod,lxmf_message:{destination_hash:this.selectedPeer.destination_hash,content:this.newMessageText,fields:o}});this.isLxmfMessageInUi(i.data.lxmf_message.hash)||this.chatItems.push({type:"lxmf_message",lxmf_message:i.data.lxmf_message,is_outbound:!0}),this.scrollMessagesToBottom(),this.newMessageText="",this.newMessageImage=null,this.newMessageImageUrl=null,this.newMessageAudio=null,this.newMessageFiles=[],this.clearImageInput(),this.clearFileInput()}catch(o){const c=((a=(d=o.response)==null?void 0:d.data)==null?void 0:a.message)??"failed to send message";v.alert(c),console.log(o)}finally{this.isSendingMessage=!1}}},async retrySendingMessage(e){var s,n;await this.deleteChatItem(e,!1);try{const d=await window.axios.post("/api/v1/lxmf-messages/send",{lxmf_message:{destination_hash:e.lxmf_message.destination_hash,content:e.lxmf_message.content,fields:e.lxmf_message.fields}});this.isLxmfMessageInUi(d.data.lxmf_message.hash)||this.chatItems.push({type:"lxmf_message",lxmf_message:d.data.lxmf_message,is_outbound:!0}),this.scrollMessagesToBottom()}catch(d){const a=((n=(s=d.response)==null?void 0:s.data)==null?void 0:n.message)??"failed to send message";v.alert(a),console.log(d)}},formatTimeAgo:function(e){return p.formatTimeAgo(e)},formatBytes:function(e){return p.formatBytes(e)},onFileInputChange:function(e){for(const s of e.target.files)this.newMessageFiles.push(s)},clearFileInput:function(){this.$refs["file-input"].value=null},removeImageAttachment:function(){this.newMessageImage=null,this.newMessageImageUrl=null},onImageInputChange:function(e){if(e.target.files.length>0){this.newMessageImage=e.target.files[0];const s=new FileReader;s.onload=n=>{this.newMessageImageUrl=n.target.result},s.readAsDataURL(this.newMessageImage),this.clearImageInput()}},clearImageInput:function(){this.$refs["image-input"].value=null},async startRecordingAudioAttachment(e){if(!this.isRecordingAudioAttachment&&!(this.newMessageAudio&&!confirm("An audio recording is already attached. A new recording will replace it. Do you want to continue?")))switch(e.codec){case"codec2":{this.audioAttachmentMicrophoneRecorderCodec="codec2",this.audioAttachmentMicrophoneRecorder=new Codec2MicrophoneRecorder,this.audioAttachmentMicrophoneRecorder.codec2Mode=e.mode,this.audioAttachmentRecordingStartedAt=Date.now(),this.isRecordingAudioAttachment=await this.audioAttachmentMicrophoneRecorder.start(),this.audioAttachmentRecordingDuration=p.formatMinutesSeconds(0),this.audioAttachmentRecordingTimer=setInterval(()=>{const n=(Date.now()-this.audioAttachmentRecordingStartedAt)/1e3;this.audioAttachmentRecordingDuration=p.formatMinutesSeconds(n)},1e3),this.isRecordingAudioAttachment||v.alert("failed to start recording");break}case"opus":{this.audioAttachmentMicrophoneRecorderCodec="opus",this.audioAttachmentMicrophoneRecorder=new $e,this.audioAttachmentRecordingStartedAt=Date.now(),this.isRecordingAudioAttachment=await this.audioAttachmentMicrophoneRecorder.start(),this.audioAttachmentRecordingDuration=p.formatMinutesSeconds(0),this.audioAttachmentRecordingTimer=setInterval(()=>{const n=(Date.now()-this.audioAttachmentRecordingStartedAt)/1e3;this.audioAttachmentRecordingDuration=p.formatMinutesSeconds(n)},1e3),this.isRecordingAudioAttachment||v.alert("failed to start recording");break}default:{v.alert(`Unhandled microphone recorder codec: ${e.codec}`);break}}},async stopRecordingAudioAttachment(){if(clearInterval(this.audioAttachmentRecordingTimer),!this.isRecordingAudioAttachment)return;this.isRecordingAudioAttachment=!1;const e=await this.audioAttachmentMicrophoneRecorder.stop();switch(this.audioAttachmentMicrophoneRecorderCodec){case"codec2":{if(e.length===0)return;const n=this.audioAttachmentMicrophoneRecorder.codec2Mode,d=await Codec2Lib.runDecode(n,new Uint8Array(e)),a=await Codec2Lib.rawToWav(d),o=new Blob([a],{type:"audio/wav"});var s=null;switch(n){case"1200":{s=4;break}case"3200":{s=9;break}default:{v.alert(`Unhandled microphone recorder codec2Mode: ${n}`);return}}this.newMessageAudio={audio_mode:s,audio_blob:new Blob([e]),audio_preview_url:URL.createObjectURL(o)};break}case"opus":{if(e.size===0)return;this.newMessageAudio={audio_mode:16,audio_blob:e,audio_preview_url:URL.createObjectURL(e)};break}}},removeAudioAttachment:function(){confirm("Are you sure you want to remove this audio attachment?")&&(this.newMessageAudio=null)},removeFileAttachment:function(e){this.newMessageFiles=this.newMessageFiles.filter(s=>s!==e)},addNewLine:function(){this.newMessageText+=`
`},onEnterPressed:function(){if(this.isMobile){this.addNewLine();return}this.sendMessage()},onShiftEnterPressed:function(){this.addNewLine()},addFilesToMessage:function(){this.$refs["file-input"].click()},addImageToMessage:function(){this.$refs["image-input"].click()},findConversation:function(e){return this.conversations.find(s=>s.destination_hash===e)},async markConversationAsRead(e){e.is_unread=!1;try{await window.axios.get(`/api/v1/lxmf/conversations/${e.destination_hash}/mark-as-read`)}catch(s){console.log(s)}this.$emit("reload-conversations")},showSentMessageInfo:function(e){var d,a,o,c,u,i,f,_,y,x;const s=[`Created: ${p.convertUnixMillisToLocalDateTimeString(e.timestamp*1e3)}`,`Method: ${e.method??"unknown"}`];if((a=(d=e.fields)==null?void 0:d.audio)!=null&&a.audio_bytes){const m=atob((c=(o=e.fields)==null?void 0:o.audio)==null?void 0:c.audio_bytes).length;s.push(`Audio Attachment: ${this.formatBytes(m)}`)}if((i=(u=e.fields)==null?void 0:u.image)!=null&&i.image_bytes){const m=atob((_=(f=e.fields)==null?void 0:f.image)==null?void 0:_.image_bytes).length;s.push(`Image Attachment: ${this.formatBytes(m)}`)}if((y=e.fields)!=null&&y.file_attachments){var n=0;for(const m of(x=e.fields)==null?void 0:x.file_attachments){const B=atob(m.file_bytes).length;n+=B}s.push(`File Attachments: ${this.formatBytes(n)}`)}v.alert(s.join(`
`))},showReceivedMessageInfo:function(e){var d,a,o,c,u,i,f,_,y,x;const s=[`Sent: ${p.convertUnixMillisToLocalDateTimeString(e.timestamp*1e3)}`,`Received: ${p.convertDateTimeToLocalDateTimeString(new Date(e.created_at))}`,`Method: ${e.method??"unknown"}`];if((a=(d=e.fields)==null?void 0:d.audio)!=null&&a.audio_bytes){const m=atob((c=(o=e.fields)==null?void 0:o.audio)==null?void 0:c.audio_bytes).length;s.push(`Audio Attachment: ${this.formatBytes(m)}`)}if((i=(u=e.fields)==null?void 0:u.image)!=null&&i.image_bytes){const m=atob((_=(f=e.fields)==null?void 0:f.image)==null?void 0:_.image_bytes).length;s.push(`Image Attachment: ${this.formatBytes(m)}`)}if((y=e.fields)!=null&&y.file_attachments){var n=0;for(const m of(x=e.fields)==null?void 0:x.file_attachments){const B=atob(m.file_bytes).length;n+=B}s.push(`File Attachments: ${this.formatBytes(n)}`)}e.quality!=null&&s.push(`Signal Quality: ${e.quality}%`),e.rssi!=null&&s.push(`RSSI: ${e.rssi}dBm`),e.snr!=null&&s.push(`SNR: ${e.snr}dB`),v.alert(s.join(`
`))}},computed:{isMobile(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)},canSendMessage(){const e=this.newMessageText.trim();return!(e==null||e===""||this.isSendingMessage)},selectedPeerChatItems(){return this.selectedPeer?this.chatItems.filter(e=>{if(e.type==="lxmf_message"){const s=e.lxmf_message.source_hash===this.selectedPeer.destination_hash,n=e.lxmf_message.destination_hash===this.selectedPeer.destination_hash;return s||n}return!1}):[]},selectedPeerChatItemsReversed(){return this.selectedPeerChatItems.map(e=>e).reverse()},oldestMessageId(){return this.selectedPeerChatItems.length>0?this.selectedPeerChatItems[0].lxmf_message.id:null}},watch:{selectedPeer(){this.initialLoad()},async selectedPeerChatItems(){await this.processAudioForSelectedPeerChatItems()}}},ps={key:0,class:"flex flex-col h-full bg-white overflow-hidden sm:m-2 sm:border sm:rounded-xl sm:shadow"},ws={class:"flex p-2 border-b border-gray-300"},ys={key:0,class:"my-auto mr-1",title:"Custom Display Name"},xs=t("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"size-4"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9.568 3H5.25A2.25 2.25 0 0 0 3 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 0 0 5.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 0 0 9.568 3Z"}),t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 6h.008v.008H6V6Z"})],-1),bs=[xs],ks=["title"],Ms={class:"text-sm"},Cs={key:1},As={class:"ml-auto my-auto mr-2"},Ss=["href"],Ps=t("div",{class:"flex text-gray-700 bg-gray-100 hover:bg-gray-200 p-2 rounded-full"},[t("div",null,[t("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-5 h-5"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 0 0 2.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 0 1-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 0 0-1.091-.852H4.5A2.25 2.25 0 0 0 2.25 4.5v2.25Z"})])])],-1),Ls=[Ps],Bs={class:"my-auto mr-2"},Rs=t("div",{class:"flex text-gray-700 bg-gray-100 hover:bg-gray-200 p-2 rounded-full"},[t("div",null,[t("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-5 h-5"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"})])])],-1),Ts=[Rs],Ds={class:"my-auto mr-2"},Is=t("div",{class:"flex text-gray-700 bg-gray-100 hover:bg-gray-200 p-2 rounded-full"},[t("div",null,[t("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",class:"w-5 h-5"},[t("path",{d:"M6.28 5.22a.75.75 0 0 0-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 1 0 1.06 1.06L10 11.06l3.72 3.72a.75.75 0 1 0 1.06-1.06L11.06 10l3.72-3.72a.75.75 0 0 0-1.06-1.06L10 8.94 6.28 5.22Z"})])])],-1),Us=[Is],Fs={key:0,class:"flex flex-col flex-col-reverse p-3"},Ns=["onClick"],js={class:"w-full space-y-0.5 px-2.5 py-1"},Zs={key:0,style:{"white-space":"pre-wrap","word-break":"break-word","font-family":"inherit"}},Vs={key:1},$s=["onClick","src"],Os={key:2,class:"pb-1"},Hs={key:0,controls:"",class:"shadow rounded-full",style:{height:"54px"}},zs=["src"],Es={key:1,style:{"min-height":"54px"},class:"flex"},Ws=["onClick"],qs=t("span",{class:"my-auto"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"size-6"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m9 9 10.5-3m0 6.553v3.75a2.25 2.25 0 0 1-1.632 2.163l-1.32.377a1.803 1.803 0 1 1-.99-3.467l2.31-.66a2.25 2.25 0 0 0 1.632-2.163Zm0 0V2.25L9 5.25v10.303m0 0v3.75a2.25 2.25 0 0 1-1.632 2.163l-1.32.377a1.803 1.803 0 0 1-.99-3.467l2.31-.66A2.25 2.25 0 0 0 9 15.553Z"})])],-1),Qs={class:"my-auto w-full"},Ys=t("span",{class:"my-auto"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-6 h-6"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"})])],-1),Ks={key:3,class:"space-y-1"},Gs=["download","href"],Js=t("div",{class:"my-auto"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-6 h-6"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m18.375 12.739-7.693 7.693a4.5 4.5 0 0 1-6.364-6.364l10.94-10.94A3 3 0 1 1 19.5 7.372L8.552 18.32m.009-.01-.01.01m5.699-9.941-7.81 7.81a1.5 1.5 0 0 0 2.112 2.13"})])],-1),Xs={class:"my-auto w-full"},et=t("div",{class:"my-auto"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-6 h-6"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"})])],-1),st={key:0,class:"border-t p-1 bg-[#efefef] text-white"},tt=["onClick"],ot={class:"flex ml-auto space-x-1"},nt={class:"my-auto"},it=["onClick"],at={key:0},rt={key:1},lt={key:2},dt={key:3},ct=["onClick"],ut={key:0,class:"my-auto"},ht=t("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",class:"w-5 h-5"},[t("path",{"fill-rule":"evenodd",d:"M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12Zm13.36-1.814a.75.75 0 1 0-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 0 0-1.06 1.06l2.25 2.25a.75.75 0 0 0 1.14-.094l3.75-5.25Z","clip-rule":"evenodd"})],-1),mt=[ht],gt={key:1,class:"my-auto"},ft=t("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",class:"w-5 h-5"},[t("path",{"fill-rule":"evenodd",d:"M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12ZM12 8.25a.75.75 0 0 1 .75.75v3.75a.75.75 0 0 1-1.5 0V9a.75.75 0 0 1 .75-.75Zm0 8.25a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z","clip-rule":"evenodd"})],-1),vt=[ft],_t={key:2,class:"my-auto"},pt=t("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-5 h-5"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M8.625 12a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0H8.25m4.125 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0H12m4.125 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0h-.375M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})],-1),wt=[pt],yt={key:1,class:"text-xs text-gray-500 mt-0.5 flex flex-col"},xt=["onClick"],bt=t("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"size-6"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m15 11.25-3-3m0 0-3 3m3-3v7.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})],-1),kt=t("span",null,"Load Previous",-1),Mt=[bt,kt],Ct={class:"w-full border-gray-300 border-t p-2"},At={class:"mx-auto"},St={key:0,class:"mb-2"},Pt={class:"w-32 h-32 rounded shadow border relative overflow-hidden"},Lt=["src"],Bt={class:"absolute top-0 right-0 p-1"},Rt=t("div",{class:"flex text-gray-700 bg-gray-100 hover:bg-gray-200 p-1 rounded-full"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",class:"w-4 h-4"},[t("path",{d:"M6.28 5.22a.75.75 0 0 0-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 1 0 1.06 1.06L10 11.06l3.72 3.72a.75.75 0 1 0 1.06-1.06L11.06 10l3.72-3.72a.75.75 0 0 0-1.06-1.06L10 8.94 6.28 5.22Z"})])],-1),Tt=[Rt],Dt={class:"absolute bottom-0 left-0 p-1"},It={class:"bg-gray-100 rounded border text-sm px-1"},Ut={key:1,class:"mb-2"},Ft={class:"flex flex-wrap gap-1"},Nt={class:"flex border border-gray-300 rounded text-gray-700 divide-x divide-gray-300 overflow-hidden"},jt={class:"flex p-1"},Zt={controls:"",class:"h-10"},Vt=["src"],$t={class:"my-auto px-1 text-sm text-gray-500"},Ot=t("svg",{class:"w-5 h-5 my-auto",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18 18 6M6 6l12 12"})],-1),Ht=[Ot],zt={key:2,class:"mb-2"},Et={class:"flex flex-wrap gap-1"},Wt={class:"flex border border-gray-300 rounded text-gray-700 divide-x divide-gray-300 overflow-hidden"},qt={class:"my-auto px-1"},Qt={class:"mr-1"},Yt={class:"my-auto text-sm text-gray-500"},Kt=["onClick"],Gt=t("svg",{class:"w-5 h-5 my-auto",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18 18 6M6 6l12 12"})],-1),Jt=[Gt],Xt=["readonly"],eo={class:"flex mt-2"},so=t("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",class:"w-5 h-5"},[t("path",{"fill-rule":"evenodd",d:"M5.625 1.5H9a3.75 3.75 0 0 1 3.75 3.75v1.875c0 1.036.84 1.875 1.875 1.875H16.5a3.75 3.75 0 0 1 3.75 3.75v7.875c0 1.035-.84 1.875-1.875 1.875H5.625a1.875 1.875 0 0 1-1.875-1.875V3.375c0-1.036.84-1.875 1.875-1.875ZM12.75 12a.75.75 0 0 0-1.5 0v2.25H9a.75.75 0 0 0 0 1.5h2.25V18a.75.75 0 0 0 1.5 0v-2.25H15a.75.75 0 0 0 0-1.5h-2.25V12Z","clip-rule":"evenodd"}),t("path",{d:"M14.25 5.25a5.23 5.23 0 0 0-1.279-3.434 9.768 9.768 0 0 1 6.963 6.963A5.23 5.23 0 0 0 16.5 7.5h-1.875a.375.375 0 0 1-.375-.375V5.25Z"})],-1),to=t("span",{class:"ml-1 hidden xl:inline-block whitespace-nowrap"},"Add Files",-1),oo=[so,to],no=t("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",class:"w-5 h-5"},[t("path",{"fill-rule":"evenodd",d:"M1.5 6a2.25 2.25 0 0 1 2.25-2.25h16.5A2.25 2.25 0 0 1 22.5 6v12a2.25 2.25 0 0 1-2.25 2.25H3.75A2.25 2.25 0 0 1 1.5 18V6ZM3 16.06V18c0 .414.336.75.75.75h16.5A.75.75 0 0 0 21 18v-1.94l-2.69-2.689a1.5 1.5 0 0 0-2.12 0l-.88.879.97.97a.75.75 0 1 1-1.06 1.06l-5.16-5.159a1.5 1.5 0 0 0-2.12 0L3 16.061Zm10.125-7.81a1.125 1.125 0 1 1 2.25 0 1.125 1.125 0 0 1-2.25 0Z","clip-rule":"evenodd"})],-1),io=t("span",{class:"ml-1 hidden xl:inline-block whitespace-nowrap"},"Add Image",-1),ao=[no,io],ro={class:"ml-auto my-auto"},lo={key:1,class:"flex flex-col mx-auto my-auto text-center leading-5"},co=t("div",{class:"mx-auto mb-1"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-6 h-6"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M20.25 8.511c.884.284 1.5 1.128 1.5 2.097v4.286c0 1.136-.847 2.1-1.98 2.193-.34.027-.68.052-1.02.072v3.091l-3-3c-1.354 0-2.694-.055-4.02-.163a2.115 2.115 0 0 1-.825-.242m9.345-8.334a2.126 2.126 0 0 0-.476-.095 48.64 48.64 0 0 0-8.048 0c-1.131.094-1.976 1.057-1.976 2.192v4.286c0 .837.46 1.58 1.155 1.951m9.345-8.334V6.637c0-1.621-1.152-3.026-2.76-3.235A48.455 48.455 0 0 0 11.25 3c-2.115 0-4.198.137-6.24.402-1.608.209-2.76 1.614-2.76 3.235v6.226c0 1.621 1.152 3.026 2.76 3.235.577.075 1.157.14 1.74.194V21l4.155-4.155"})])],-1),uo=t("div",{class:"font-semibold"},"No Active Chat",-1),ho=t("div",null,"Select a Peer to start chatting!",-1),mo=[co,uo,ho];function go(e,s,n,d,a,o){const c=L("AddAudioButton"),u=L("SendMessageButton");return n.selectedPeer?(r(),l("div",ps,[t("div",ws,[t("div",null,[t("div",{onClick:s[0]||(s[0]=(...i)=>o.updateCustomDisplayName&&o.updateCustomDisplayName(...i)),class:"flex cursor-pointer"},[n.selectedPeer.custom_display_name!=null?(r(),l("div",ys,bs)):h("",!0),t("div",{class:"my-auto font-semibold",title:n.selectedPeer.display_name},g(n.selectedPeer.custom_display_name??n.selectedPeer.display_name),9,ks)]),t("div",Ms,[D(" <"+g(n.selectedPeer.destination_hash)+"> ",1),a.selectedPeerPath?(r(),l("span",{key:0,onClick:s[1]||(s[1]=i=>o.onDestinationPathClick(a.selectedPeerPath)),class:"cursor-pointer"},g(a.selectedPeerPath.hops)+" "+g(a.selectedPeerPath.hops===1?"hop":"hops")+" away",1)):h("",!0),a.selectedPeerLxmfStampInfo&&a.selectedPeerLxmfStampInfo.stamp_cost?(r(),l("span",Cs,[D(" • "),t("span",{onClick:s[2]||(s[2]=i=>o.onStampInfoClick(a.selectedPeerLxmfStampInfo)),class:"cursor-pointer"},"Stamp Cost "+g(a.selectedPeerLxmfStampInfo.stamp_cost),1)])):h("",!0)])]),t("div",As,[t("a",{href:`call.html?destination_hash=${n.selectedPeer.destination_hash}`,target:"_blank",class:"cursor-pointer"},Ls,8,Ss)]),t("div",Bs,[t("div",{onClick:s[3]||(s[3]=(...i)=>o.deleteConversation&&o.deleteConversation(...i)),class:"cursor-pointer"},Ts)]),t("div",Ds,[t("div",{onClick:s[4]||(s[4]=(...i)=>o.close&&o.close(...i)),class:"cursor-pointer"},Us)])]),t("div",{onScroll:s[7]||(s[7]=(...i)=>o.onMessagesScroll&&o.onMessagesScroll(...i)),id:"messages",class:"h-full overflow-y-scroll"},[o.selectedPeerChatItems.length>0?(r(),l("div",Fs,[(r(!0),l(b,null,A(o.selectedPeerChatItemsReversed,i=>{var f,_,y,x;return r(),l("div",{key:i.lxmf_message.hash,class:w(["flex flex-col max-w-xl mt-3",{"ml-auto pl-4 md:pl-16 items-end":i.is_outbound,"mr-auto pr-4 md:pr-16 items-start":!i.is_outbound}])},[t("div",{onClick:m=>o.onChatItemClick(i),class:w(["border border-gray-300 rounded-xl shadow overflow-hidden",[i.lxmf_message.state==="failed"?"bg-red-500 text-white":i.is_outbound?"bg-[#3b82f6] text-white":"bg-[#efefef]"]])},[t("div",js,[i.lxmf_message.content?(r(),l("div",Zs,g(i.lxmf_message.content),1)):h("",!0),(f=i.lxmf_message.fields)!=null&&f.image?(r(),l("div",Vs,[t("img",{onClick:C(m=>{o.openImage(`data:image/${i.lxmf_message.fields.image.image_type};base64,${i.lxmf_message.fields.image.image_bytes}`)},["stop"]),src:`data:image/${i.lxmf_message.fields.image.image_type};base64,${i.lxmf_message.fields.image.image_bytes}`,class:"w-full rounded-md cursor-pointer"},null,8,$s)])):h("",!0),(_=i.lxmf_message.fields)!=null&&_.audio?(r(),l("div",Os,[a.lxmfMessageAudioAttachmentCache[i.lxmf_message.hash]?(r(),l("audio",Hs,[t("source",{src:a.lxmfMessageAudioAttachmentCache[i.lxmf_message.hash],type:"audio/wav"},null,8,zs)])):(r(),l("div",Es,[t("button",{onClick:m=>o.downloadFileFromBase64("audio.bin",i.lxmf_message.fields.audio.audio_bytes),type:"button",class:"my-auto flex border border-gray-300 hover:bg-gray-100 rounded px-2 py-1 text-sm text-gray-700 font-semibold cursor-pointer space-x-2 bg-[#efefef]"},[qs,t("span",Qs," Unsupported Audio (mode "+g(i.lxmf_message.fields.audio.audio_mode)+") ",1),Ys],8,Ws)]))])):h("",!0),(y=i.lxmf_message.fields)!=null&&y.file_attachments?(r(),l("div",Ks,[(r(!0),l(b,null,A(((x=i.lxmf_message.fields)==null?void 0:x.file_attachments)??[],m=>(r(),l("a",{onClick:s[5]||(s[5]=C(()=>{},["stop"])),target:"_blank",download:m.file_name,href:`data:application/octet-stream;base64,${m.file_bytes}`,class:"flex border border-gray-300 hover:bg-gray-100 rounded px-2 py-1 text-sm text-gray-700 font-semibold cursor-pointer space-x-2 bg-[#efefef]"},[Js,t("div",Xs,g(m.file_name),1),et],8,Gs))),256))])):h("",!0)]),i.is_actions_expanded?(r(),l("div",st,[t("button",{onClick:C(m=>o.deleteChatItem(i),["stop"]),type:"button",class:"inline-flex items-center gap-x-1 rounded-md bg-red-500 px-2 py-1 text-xs font-semibold text-white shadow-sm hover:bg-red-400 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-red-500"}," Delete ",8,tt)])):h("",!0)],10,Ns),i.is_outbound?(r(),l("div",{key:0,class:w(["flex text-right",[i.lxmf_message.state==="failed"?"text-red-500":"text-gray-500"]])},[t("div",ot,[t("div",nt,[t("span",{onClick:m=>o.showSentMessageInfo(i.lxmf_message),class:"space-x-1 cursor-pointer"},[t("span",null,g(i.lxmf_message.state),1),i.lxmf_message.state==="outbound"&&i.lxmf_message.delivery_attempts>=1?(r(),l("span",at,"(attempt "+g(i.lxmf_message.delivery_attempts+1)+")",1)):h("",!0),i.lxmf_message.state==="sent"&&i.lxmf_message.method==="opportunistic"&&i.lxmf_message.delivery_attempts>=1?(r(),l("span",rt,"(attempt "+g(i.lxmf_message.delivery_attempts)+")",1)):h("",!0),i.lxmf_message.state==="sent"&&i.lxmf_message.method==="propagated"?(r(),l("span",lt,"to propagation node")):h("",!0),i.lxmf_message.state==="sending"?(r(),l("span",dt,g(i.lxmf_message.progress.toFixed(0))+"%",1)):h("",!0)],8,it),i.lxmf_message.state==="failed"?(r(),l("a",{key:0,onClick:m=>o.retrySendingMessage(i),class:"ml-1 cursor-pointer underline text-blue-500"},"retry?",8,ct)):h("",!0)]),i.lxmf_message.state==="delivered"?(r(),l("div",ut,mt)):i.lxmf_message.state==="failed"?(r(),l("div",gt,vt)):(r(),l("div",_t,wt))])],2)):h("",!0),i.is_outbound?h("",!0):(r(),l("div",yt,[t("span",{onClick:m=>o.showReceivedMessageInfo(i.lxmf_message),class:"cursor-pointer"},g(o.formatTimeAgo(i.lxmf_message.created_at)),9,xt)]))],2)}),128)),k(t("button",{id:"load-previous",onClick:s[6]||(s[6]=(...i)=>o.loadPrevious&&o.loadPrevious(...i)),type:"button",class:"flex space-x-2 mx-auto bg-gray-200 px-3 py-1 hover:bg-gray-300 rounded-full shadow"},Mt,512),[[$,!a.isLoadingPrevious&&a.hasMorePrevious]])])):h("",!0)],32),t("div",Ct,[t("div",At,[t("div",null,[a.newMessageImage?(r(),l("div",St,[t("div",Pt,[a.newMessageImageUrl?(r(),l("img",{key:0,src:a.newMessageImageUrl,class:"w-full h-full object-cover"},null,8,Lt)):h("",!0),t("div",Bt,[t("div",{onClick:s[8]||(s[8]=(...i)=>o.removeImageAttachment&&o.removeImageAttachment(...i)),class:"cursor-pointer"},Tt)]),t("div",Dt,[t("div",It,g(o.formatBytes(a.newMessageImage.size)),1)])])])):h("",!0),a.newMessageAudio?(r(),l("div",Ut,[t("div",Ft,[t("div",Nt,[t("div",jt,[t("div",null,[t("audio",Zt,[t("source",{src:a.newMessageAudio.audio_preview_url,type:"audio/wav"},null,8,Vt)])]),t("div",$t,g(o.formatBytes(a.newMessageAudio.audio_blob.size)),1)]),t("div",{onClick:s[9]||(s[9]=(...i)=>o.removeAudioAttachment&&o.removeAudioAttachment(...i)),class:"flex my-auto text-sm text-gray-500 h-full px-1 hover:bg-gray-200 cursor-pointer"},Ht)])])])):h("",!0),a.newMessageFiles.length>0?(r(),l("div",zt,[t("div",Et,[(r(!0),l(b,null,A(a.newMessageFiles,i=>(r(),l("div",Wt,[t("div",qt,[t("span",Qt,g(i.name),1),t("span",Yt,g(o.formatBytes(i.size)),1)]),t("div",{onClick:f=>o.removeFileAttachment(i),class:"flex my-auto text-sm text-gray-500 h-full px-1 hover:bg-gray-200 cursor-pointer"},Jt,8,Kt)]))),256))])])):h("",!0),k(t("textarea",{id:"message-input",readonly:a.isSendingMessage,"onUpdate:modelValue":s[10]||(s[10]=i=>a.newMessageText=i),onKeydown:[s[11]||(s[11]=I(C((...i)=>o.onEnterPressed&&o.onEnterPressed(...i),["exact","prevent"]),["enter","native"])),s[12]||(s[12]=I(C((...i)=>o.onShiftEnterPressed&&o.onShiftEnterPressed(...i),["shift","exact","prevent"]),["enter","native"]))],class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5",rows:"3",placeholder:"Send a message..."},null,40,Xt),[[R,a.newMessageText]]),t("div",eo,[t("button",{onClick:s[13]||(s[13]=(...i)=>o.addFilesToMessage&&o.addFilesToMessage(...i)),type:"button",class:"my-auto mr-1 inline-flex items-center gap-x-1 rounded-md bg-gray-500 px-2.5 py-1.5 text-sm font-semibold text-white shadow-sm hover:bg-gray-400 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-gray-500"},oo),t("button",{onClick:s[14]||(s[14]=(...i)=>o.addImageToMessage&&o.addImageToMessage(...i)),type:"button",class:"my-auto mr-1 inline-flex items-center gap-x-1 rounded-md bg-gray-500 px-2.5 py-1.5 text-sm font-semibold text-white shadow-sm hover:bg-gray-400 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-gray-500"},ao),t("div",null,[M(c,{"is-recording-audio-attachment":a.isRecordingAudioAttachment,onStartRecording:s[15]||(s[15]=i=>o.startRecordingAudioAttachment(i)),onStopRecording:o.stopRecordingAudioAttachment},{default:T(()=>[t("span",null,"Recording: "+g(a.audioAttachmentRecordingDuration),1)]),_:1},8,["is-recording-audio-attachment","onStopRecording"])]),t("div",ro,[M(u,{onSend:o.sendMessage,onDeliveryMethodChanged:s[16]||(s[16]=i=>this.newMessageDeliveryMethod=i),"is-sending-message":a.isSendingMessage,"can-send-message":o.canSendMessage,"delivery-method":a.newMessageDeliveryMethod},null,8,["onSend","is-sending-message","can-send-message","delivery-method"])])])])])]),t("input",{ref:"image-input",onChange:s[17]||(s[17]=(...i)=>o.onImageInputChange&&o.onImageInputChange(...i)),type:"file",accept:"image/*",style:{display:"none"}},null,544),t("input",{ref:"file-input",onChange:s[18]||(s[18]=(...i)=>o.onFileInputChange&&o.onFileInputChange(...i)),type:"file",multiple:"",style:{display:"none"}},null,544)])):(r(),l("div",lo,mo))}const fo=S(_s,[["render",go]]),vo={name:"MessagesPage",components:{ConversationViewer:fo,MessagesSidebar:Ve},data(){return{reloadInterval:null,config:null,peers:{},selectedPeer:null,conversations:[],lxmfDeliveryAnnounces:[]}},beforeUnmount(){clearInterval(this.reloadInterval),P.off("message",this.onWebsocketMessage),U.off("compose-new-message",this.onComposeNewMessage)},mounted(){P.on("message",this.onWebsocketMessage),U.on("compose-new-message",this.onComposeNewMessage),this.getConfig(),this.getConversations(),this.getLxmfDeliveryAnnounces(),this.reloadInterval=setInterval(()=>{this.getConversations()},5e3)},methods:{async onComposeNewMessage(e){if(e==null&&(e=await v.prompt("Enter LXMF Address"),!e))return;const s=this.peers[e];if(s){this.onPeerClick(s);return}if(e.length!==32){v.alert("Invalid Address");return}this.onPeerClick({display_name:"Unknown Peer",destination_hash:e})},async getConfig(){try{const e=await window.axios.get("/api/v1/config");this.config=e.data.config}catch(e){console.log(e)}},async onWebsocketMessage(e){const s=JSON.parse(e.data);switch(s.type){case"config":{this.config=s.config;break}case"announce":{s.announce.aspect==="lxmf.delivery"&&this.updatePeerFromAnnounce(s.announce);break}case"lxmf.delivery":{await this.getConversations();break}}},async getLxmfDeliveryAnnounces(){try{const s=(await window.axios.get("/api/v1/announces",{params:{aspect:"lxmf.delivery",limit:500}})).data.announces;for(const n of s)this.updatePeerFromAnnounce(n)}catch(e){console.log(e)}},async getConversations(){try{const e=await window.axios.get("/api/v1/lxmf/conversations");this.conversations=e.data.conversations}catch(e){console.log(e)}},updatePeerFromAnnounce:function(e){this.peers[e.destination_hash]=e},onPeerClick:function(e){this.selectedPeer=e},onConversationClick:function(e){this.onPeerClick(e),this.$refs["conversation-viewer"].markConversationAsRead(e)}},watch:{conversations(){O.unreadConversationsCount=this.conversations.filter(e=>e.is_unread).length}}},_o={class:"flex flex-col flex-1 overflow-hidden min-w-full sm:min-w-[500px]"};function po(e,s,n,d,a,o){var i,f;const c=L("MessagesSidebar"),u=L("ConversationViewer");return r(),l(b,null,[M(c,{conversations:a.conversations,peers:a.peers,"selected-destination-hash":(i=a.selectedPeer)==null?void 0:i.destination_hash,onConversationClick:o.onConversationClick,onPeerClick:o.onPeerClick},null,8,["conversations","peers","selected-destination-hash","onConversationClick","onPeerClick"]),t("div",_o,[M(u,{ref:"conversation-viewer","my-lxmf-address-hash":(f=a.config)==null?void 0:f.lxmf_address_hash,"selected-peer":a.selectedPeer,conversations:a.conversations,onClose:s[0]||(s[0]=_=>a.selectedPeer=null),onReloadConversations:o.getConversations},null,8,["my-lxmf-address-hash","selected-peer","conversations","onReloadConversations"])])],64)}const yo=S(vo,[["render",po]]);export{yo as default};
