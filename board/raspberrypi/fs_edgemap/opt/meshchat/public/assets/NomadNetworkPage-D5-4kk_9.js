import{M as B,U as H,W as x,D as N}from"./app-B2omifMc.js";import{_ as D,e as L,o as g,q as h,k as d,y as A,z as F,B as C,H as U,S as O,m as S,t as z,A as y,E as M,W as j,x as q}from"./_plugin-vue_export-helper-BSLEAqPR.js";class T{constructor(e=!0){this.darkTheme=e,this.DEFAULT_FG_DARK="ddd",this.DEFAULT_FG_LIGHT="222",this.DEFAULT_BG="default",this.SELECTED_STYLES=null,this.STYLES_DARK={plain:{fg:this.DEFAULT_FG_DARK,bg:this.DEFAULT_BG,bold:!1,underline:!1,italic:!1},heading1:{fg:"222",bg:"bbb",bold:!1,underline:!1,italic:!1},heading2:{fg:"111",bg:"999",bold:!1,underline:!1,italic:!1},heading3:{fg:"000",bg:"777",bold:!1,underline:!1,italic:!1}},this.STYLES_LIGHT={plain:{fg:this.DEFAULT_FG_LIGHT,bg:this.DEFAULT_BG,bold:!1,underline:!1,italic:!1},heading1:{fg:"000",bg:"777",bold:!1,underline:!1,italic:!1},heading2:{fg:"111",bg:"aaa",bold:!1,underline:!1,italic:!1},heading3:{fg:"222",bg:"ccc",bold:!1,underline:!1,italic:!1}},this.darkTheme?this.SELECTED_STYLES=this.STYLES_DARK:this.SELECTED_STYLES=this.STYLES_LIGHT}static formatNomadnetworkUrl(e){return`nomadnetwork://${e}`}convertMicronToHtml(e){let t="",s={literal:!1,depth:0,fg_color:this.SELECTED_STYLES.plain.fg,bg_color:this.DEFAULT_BG,formatting:{bold:!1,underline:!1,italic:!1,strikethrough:!1},default_align:"left",align:"left",radio_groups:{}};const o=e.split(`
`);for(let i of o){const r=this.parseLine(i,s);if(r&&r.length>0)for(let l of r)t+=l.outerHTML;else t+="<br>"}return t}parseToHtml(e){const t=document.createDocumentFragment();let s={literal:!1,depth:0,fg_color:this.SELECTED_STYLES.plain.fg,bg_color:this.DEFAULT_BG,formatting:{bold:!1,underline:!1,italic:!1,strikethrough:!1},default_align:"left",align:"left",radio_groups:{}};const o=e.split(`
`);for(let i of o){const r=this.parseLine(i,s);if(r&&r.length>0)for(let l of r)t.appendChild(l);else t.appendChild(document.createElement("br"))}return t}parseLine(e,t){if(e.length>0){if(e==="`=")return t.literal=!t.literal,null;if(!t.literal){if(e[0]==="#")return null;if(e[0]==="<")return t.depth=0,this.parseLine(e.slice(1),t);if(e[0]===">"){let o=0;for(;o<e.length&&e[o]===">";)o++;t.depth=o;let i=e.slice(o);if(i.length>0){let r=null,l="heading"+o;this.SELECTED_STYLES[l]?r=this.SELECTED_STYLES[l]:r=this.SELECTED_STYLES.plain;const n=this.stateToStyle(t);this.styleToState(r,t);let c=this.makeOutput(t,i);if(this.styleToState(n,t),c&&c.length>0){const u=document.createElement("div");return this.applyAlignment(u,t),this.applySectionIndent(u,t),this.appendOutput(u,c,t),[u]}else return null}else return null}if(e[0]==="-"){e.length>1&&e[1];const o=document.createElement("hr");return this.applySectionIndent(o,t),[o]}}let s=this.makeOutput(t,e);if(s){let o=document.createElement("div");return this.applyAlignment(o,t),this.applySectionIndent(o,t),this.appendOutput(o,s,t),[o]}else return[document.createElement("br")]}else return[document.createElement("br")]}applyAlignment(e,t){e.style.textAlign=t.align||"left"}applySectionIndent(e,t){let s=(t.depth-1)*2;s>0&&(e.style.marginLeft=s*10+"px")}stateToStyle(e){return{fg:e.fg_color,bg:e.bg_color,bold:e.formatting.bold,underline:e.formatting.underline,italic:e.formatting.italic}}styleToState(e,t){e.fg!==void 0&&e.fg!==null&&(t.fg_color=e.fg),e.bg!==void 0&&e.bg!==null&&(t.bg_color=e.bg),e.bold!==void 0&&e.bold!==null&&(t.formatting.bold=e.bold),e.underline!==void 0&&e.underline!==null&&(t.formatting.underline=e.underline),e.italic!==void 0&&e.italic!==null&&(t.formatting.italic=e.italic)}appendOutput(e,t,s){let o=null,i=null;const r=()=>{o&&(e.appendChild(o),o=null,i=null)};for(let l of t)if(typeof l=="string"){let n=document.createElement("span");n.textContent=l,e.appendChild(n)}else if(Array.isArray(l)&&l.length===2){let[n,c]=l;this.stylesEqual(n,i)||(r(),o=document.createElement("span"),this.applyStyleToElement(o,n),i=n),o.textContent+=c}else if(l&&typeof l=="object"){if(r(),l.type==="field"){let n=document.createElement("input");n.type=l.masked?"password":"text",n.name=l.name,n.setAttribute("value",l.data),l.width&&(n.size=l.width),this.applyStyleToElement(n,this.styleFromState(l.style)),e.appendChild(n)}else if(l.type==="checkbox"){let n=document.createElement("label"),c=document.createElement("input");c.type="checkbox",c.name=l.name,c.value=l.value,l.prechecked&&c.setAttribute("checked",!0),n.appendChild(c),n.appendChild(document.createTextNode(" "+l.label)),this.applyStyleToElement(n,this.styleFromState(l.style)),e.appendChild(n)}else if(l.type==="radio"){let n=document.createElement("label"),c=document.createElement("input");c.type="radio",c.name=l.name,c.value=l.value,l.prechecked&&c.setAttribute("checked",!0),n.appendChild(c),n.appendChild(document.createTextNode(" "+l.label)),this.applyStyleToElement(n,this.styleFromState(l.style)),e.appendChild(n)}else if(l.type==="link"){let n=l.url.replace("nomadnetwork://","").replace("lxmf://","");const c=l.url;let u=document.createElement("a");u.href=c,u.title=c;let f=[],p={},_=!1;if(l.fields&&l.fields.length>0){for(const m of l.fields)if(m==="*")_=!0;else if(m.includes("=")){const[P,k]=m.split("=");p[P]=k}else f.push(m);let w="";_?w="*":w=f.join("|");const v=Object.entries(p);if(v.length>0){const m=v.map(([P,k])=>`${P}=${k}`).join("|");n+=n.includes("`")?`|${m}`:`\`${m}`}u.setAttribute("onclick",`event.preventDefault(); onNodePageUrlClick('${n}', '${w}', false, false)`)}else u.setAttribute("onclick",`event.preventDefault(); onNodePageUrlClick('${n}', null, false, false)`);u.textContent=l.label,this.applyStyleToElement(u,this.styleFromState(l.style)),e.appendChild(u)}}r()}stylesEqual(e,t){return!e&&!t?!0:!e||!t?!1:e.fg===t.fg&&e.bg===t.bg&&e.bold===t.bold&&e.underline===t.underline&&e.italic===t.italic}styleFromState(e){return e}applyStyleToElement(e,t){if(!t)return;let s=this.colorToCss(t.fg),o=this.colorToCss(t.bg);s&&s!=="default"&&(e.style.color=s),o&&o!=="default"&&(e.style.backgroundColor=o),t.bold&&(e.style.fontWeight="bold"),t.underline&&(e.style.textDecoration=e.style.textDecoration?e.style.textDecoration+" underline":"underline"),t.italic&&(e.style.fontStyle="italic")}colorToCss(e){if(!e||e==="default")return null;if(e.length===3&&/^[0-9a-fA-F]{3}$/.test(e)||e.length===6&&/^[0-9a-fA-F]{6}$/.test(e))return"#"+e;if(e.length===3&&e[0]==="g"){let t=parseInt(e.slice(1),10);isNaN(t)&&(t=50);let s=Math.floor(t*2.55).toString(16).padStart(2,"0");return"#"+s+s+s}return null}makeOutput(e,t){if(e.literal)return t==="\\`="&&(t="`="),[[this.stateToStyle(e),t]];let s=[],o="",i="text",r=!1,l=0,n=0;for(;n<t.length;){let c=t[n];if(l>0){l--,n++;continue}if(i==="formatting"){switch(c){case"_":e.formatting.underline=!e.formatting.underline;break;case"!":e.formatting.bold=!e.formatting.bold;break;case"*":e.formatting.italic=!e.formatting.italic;break;case"F":if(t.length>=n+4){let p=t.substr(n+1,3);e.fg_color=p,l=3}break;case"f":e.fg_color=this.SELECTED_STYLES.plain.fg;break;case"B":if(t.length>=n+4){let p=t.substr(n+1,3);e.bg_color=p,l=3}break;case"b":e.bg_color=this.DEFAULT_BG;break;case"`":e.formatting.bold=!1,e.formatting.underline=!1,e.formatting.italic=!1,e.fg_color=this.SELECTED_STYLES.plain.fg,e.bg_color=this.DEFAULT_BG,e.align=e.default_align;break;case"c":e.align=e.align==="center"?e.default_align:"center";break;case"l":e.align=e.align==="left"?e.default_align:"left";break;case"r":e.align=e.align==="right"?e.default_align:"right";break;case"a":e.align=e.default_align;break;case"<":o.length>0&&(s.push([this.stateToStyle(e),o]),o="");let u=this.parseField(t,n,e);if(u){s.push(u.obj),n+=u.skip;continue}break;case"[":o.length>0&&(s.push([this.stateToStyle(e),o]),o="");let f=this.parseLink(t,n,e);if(f){s.push(f.obj),n+=f.skip;continue}break}i="text",o.length>0}else c==="\\"?r?(o+=c,r=!1):r=!0:c==="`"?r?(o+=c,r=!1):(o.length>0&&(s.push([this.stateToStyle(e),o]),o=""),i="formatting"):(r&&(o+="\\",r=!1),o+=c);n++}return o.length>0&&s.push([this.stateToStyle(e),o]),s.length>0?s:null}parseField(e,t,s){let o=t+1,i=e.indexOf("`",o);if(i===-1)return null;let r=e.substring(o,i),l=!1,n=24,c="field",u=r,f="",p=!1;if(r.includes("|")){let k=r.split("|"),b=k[0];if(u=k[1],b.includes("^")?(c="radio",b=b.replace("^","")):b.includes("?")?(c="checkbox",b=b.replace("?","")):b.includes("!")&&(l=!0,b=b.replace("!","")),b.length>0){let E=parseInt(b,10);isNaN(E)||(n=Math.min(E,256))}k.length>2&&(f=k[2]),k.length>3&&k[3]==="*"&&(p=!0)}let _=e.indexOf(">",i);if(_===-1)return null;let w=e.substring(i+1,_),v=this.stateToStyle(s),m=null;c==="checkbox"||c==="radio"?m={type:c,name:u,value:f||w,label:w,prechecked:p,style:v}:m={type:"field",name:u,width:n,masked:l,data:w,style:v};let P=_-t+2;return{obj:m,skip:P}}parseLink(e,t,s){let o=e.indexOf("]",t);if(o===-1)return null;let i=e.substring(t+1,o),r=i.split("`"),l="",n="",c="";if(r.length===1?(l="",n=i):r.length===2?(l=r[0],n=r[1]):r.length===3&&(l=r[0],n=r[1],c=r[2]),n.length===0)return null;l===""&&(l=n),n=T.formatNomadnetworkUrl(n);let u=this.stateToStyle(s),f={type:"link",url:n,label:l,fields:c?c.split("|"):[],style:u},p=o-t+2;return{obj:f,skip:p}}}const R={name:"NomadNetworkSidebar",components:{MaterialDesignIcon:B},props:{nodes:Object,selectedDestinationHash:String},data(){return{nodesSearchTerm:""}},methods:{onNodeClick(a){this.$emit("node-click",a)},formatTimeAgo:function(a){return H.formatTimeAgo(a)}},computed:{nodesCount(){return Object.keys(this.nodes).length},nodesOrderedByLatestAnnounce(){return Object.values(this.nodes).sort(function(e,t){const s=new Date(e.updated_at).getTime();return new Date(t.updated_at).getTime()-s})},searchedNodes(){return this.nodesOrderedByLatestAnnounce.filter(a=>{const e=this.nodesSearchTerm.toLowerCase(),t=a.display_name.toLowerCase().includes(e),s=a.destination_hash.toLowerCase().includes(e);return t||s})}}},I={class:"flex flex-col w-80 min-w-80"},K={class:"flex-1 flex flex-col bg-white dark:bg-zinc-950 border-r dark:border-zinc-800 overflow-hidden"},V={key:0,class:"p-1 border-b border-gray-300 dark:border-zinc-800"},$=["placeholder"],G={class:"flex h-full overflow-y-auto"},W={key:0,class:"w-full"},Y=["onClick"],Z={class:"my-auto mr-2"},J={class:"bg-gray-200 dark:bg-zinc-800 text-gray-500 dark:text-gray-400 p-2 rounded"},Q={class:"text-gray-900 dark:text-gray-100"},X={class:"text-gray-500 dark:text-gray-400 text-sm"},ee={key:1,class:"mx-auto my-auto text-center leading-5"},te={key:0,class:"flex flex-col"},oe=M('<div class="mx-auto mb-1"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 text-gray-500 dark:text-gray-400"><path stroke-linecap="round" stroke-linejoin="round" d="M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442-.745.361-1.45.999-1.45 1.827v.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 5.25h.008v.008H12v-.008Z"></path></svg></div><div class="font-semibold text-gray-900 dark:text-gray-100">No Nodes Discovered</div><div class="text-gray-500 dark:text-gray-400">Waiting for a node to announce!</div>',3),ne=[oe],le={key:1,class:"flex flex-col"},ae=M('<div class="mx-auto mb-1"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 text-gray-500 dark:text-gray-400"><path stroke-linecap="round" stroke-linejoin="round" d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"></path></svg></div><div class="font-semibold text-gray-900 dark:text-gray-100">No Search Results</div><div class="text-gray-500 dark:text-gray-400">Your search didn&#39;t match any Nodes!</div>',3),se=[ae];function ie(a,e,t,s,o,i){const r=L("MaterialDesignIcon");return g(),h("div",I,[d("div",K,[i.nodesCount>0?(g(),h("div",V,[A(d("input",{"onUpdate:modelValue":e[0]||(e[0]=l=>o.nodesSearchTerm=l),type:"text",placeholder:`Search ${i.nodesCount} Nodes...`,class:"bg-gray-50 dark:bg-zinc-900 border border-gray-300 dark:border-zinc-700 text-gray-900 dark:text-gray-100 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:placeholder-gray-400"},null,8,$),[[F,o.nodesSearchTerm]])])):C("",!0),d("div",G,[i.searchedNodes.length>0?(g(),h("div",W,[(g(!0),h(U,null,O(i.searchedNodes,l=>(g(),h("div",{onClick:n=>i.onNodeClick(l),class:S(["flex cursor-pointer p-2 border-l-2",[l.destination_hash===t.selectedDestinationHash?"bg-gray-100 dark:bg-zinc-800 border-blue-500":"bg-white dark:bg-zinc-950 border-transparent hover:bg-gray-50 dark:hover:bg-zinc-900 hover:border-gray-200 dark:hover:border-zinc-700"]])},[d("div",Z,[d("div",J,[z(r,{"icon-name":"server-network-outline",class:"w-6 h-6"})])]),d("div",null,[d("div",Q,y(l.display_name),1),d("div",X,y(i.formatTimeAgo(l.updated_at)),1)])],10,Y))),256))])):(g(),h("div",ee,[i.nodesCount===0?(g(),h("div",te,ne)):C("",!0),o.nodesSearchTerm!==""&&i.nodesCount>0?(g(),h("div",le,se)):C("",!0)]))])])])}const re=D(R,[["render",ie]]),de={name:"NomadNetworkPage",components:{NomadNetworkSidebar:re},props:{destinationHash:String},data(){return{nodes:{},selectedNode:null,selectedNodePath:null,isLoadingNodePage:!1,isShowingNodePageSource:!1,defaultNodePagePath:"/page/index.mu",nodePageRequestSequence:0,nodePagePath:null,nodePagePathUrlInput:null,nodePageContent:null,nodePageProgress:0,nodePagePathHistory:[],nodePageCache:{},isDownloadingNodeFile:!1,nodeFilePath:null,nodeFileProgress:0,nomadnetPageDownloadCallbacks:{},nomadnetFileDownloadCallbacks:{}}},beforeUnmount(){x.off("message",this.onWebsocketMessage)},mounted(){x.on("message",this.onWebsocketMessage),window.onNodePageUrlClick=(a,e=null)=>{this.onNodePageUrlClick(a,e)},this.destinationHash&&(async()=>(await this.getNomadnetworkNodeAnnounce(this.destinationHash),await this.onNodePageUrlClick(`${this.destinationHash}:${this.defaultNodePagePath}`)))(),this.getNomadnetworkNodeAnnounces()},methods:{async onWebsocketMessage(a){const e=JSON.parse(a.data);switch(e.type){case"announce":{e.announce.aspect==="nomadnetwork.node"&&this.updateNodeFromAnnounce(e.announce);break}case"nomadnet.page.download":{const t=e.nomadnet_page_download,s=this.getNomadnetPageDownloadCallbackKey(t.destination_hash,t.page_path),o=this.nomadnetPageDownloadCallbacks[s];if(!o){console.log("did not find nomadnet page download callback for key: "+s);return}if(t.status==="success"&&o.onSuccessCallback){o.onSuccessCallback(t.page_content),delete this.nomadnetPageDownloadCallbacks[s];return}if(t.status==="failure"&&o.onFailureCallback){o.onFailureCallback(t.failure_reason),delete this.nomadnetPageDownloadCallbacks[s];return}if(t.status==="progress"&&o.onProgressCallback){o.onProgressCallback(t.progress);return}break}case"nomadnet.file.download":{const t=e.nomadnet_file_download,s=this.getNomadnetFileDownloadCallbackKey(t.destination_hash,t.file_path),o=this.nomadnetFileDownloadCallbacks[s];if(!o){console.log("did not find nomadnet file download callback for key: "+s);return}if(t.status==="success"&&o.onSuccessCallback){o.onSuccessCallback(t.file_name,t.file_bytes),delete this.nomadnetFileDownloadCallbacks[s];return}if(t.status==="failure"&&o.onFailureCallback){o.onFailureCallback(t.failure_reason),delete this.nomadnetFileDownloadCallbacks[s];return}if(t.status==="progress"&&o.onProgressCallback){o.onProgressCallback(t.progress);return}break}}},onDestinationPathClick:function(a){N.alert(`${a.hops} ${a.hops===1?"hop":"hops"} away via ${a.next_hop_interface}`)},async getNomadnetworkNodeAnnounces(){try{const e=(await window.axios.get("/api/v1/announces",{params:{aspect:"nomadnetwork.node"}})).data.announces;for(const t of e)this.updateNodeFromAnnounce(t)}catch(a){console.log(a)}},async getNomadnetworkNodeAnnounce(a){try{const t=(await window.axios.get("/api/v1/announces",{params:{destination_hash:a,limit:1}})).data.announces;for(const s of t)this.updateNodeFromAnnounce(s)}catch(e){console.log(e)}},updateNodeFromAnnounce:function(a){this.nodes[a.destination_hash]=a},async openUrl(){const a=await N.prompt("Enter a Nomadnet URL");a&&await this.onNodePageUrlClick(a)},async loadNodePage(a,e,t=null,s=!0,o=!0){this.$router.replace({name:"nomadnetwork",params:{destinationHash:a}});const i=++this.nodePageRequestSequence,r=this.nodePagePath;if(this.isLoadingNodePage=!0,this.nodePagePath=`${a}:${e}`,this.nodePageContent=null,this.nodePageProgress=0,this.nodePagePathUrlInput=this.nodePagePath,this.getNodePath(a),s&&r!=null&&r!==this.nodePagePath&&this.nodePagePathHistory.push(r),o){const l=`${a}:${e}`,n=this.nodePageCache[l];if(n!=null){this.nodePageContent=n,this.renderPageContent(e,n),this.isLoadingNodePage=!1;return}}this.downloadNomadNetPage(a,e,t,l=>{if(i!==this.nodePageRequestSequence){console.log("ignoring page content callback for previous page request");return}this.nodePageContent=l;const n=`${a}:${e}`;this.nodePageCache[n]=this.nodePageContent,this.renderPageContent(e,l),this.isLoadingNodePage=!1,this.getNodePath(a)},l=>{if(i!==this.nodePageRequestSequence){console.log("ignoring failure callback for previous page request");return}this.nodePageContent=`Failed loading page: ${l}`,this.isLoadingNodePage=!1,this.getNodePath(a)},l=>{if(i!==this.nodePageRequestSequence){console.log("ignoring progress callback for previous page request");return}this.nodePageProgress=Math.round(l*100)})},renderPageContent(a,e){if(!this.isShowingNodePageSource){const[t]=a.split("`");if(t.endsWith(".mu"))return new T().convertMicronToHtml(e)}return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},toggleNodePageSource(){this.isShowingNodePageSource=!this.isShowingNodePageSource},async reloadNodePage(){this.onNodePageUrlClick(this.nodePagePath,null,!1,!1)},async loadPreviousNodePage(){const a=this.nodePagePathHistory.pop();a&&this.onNodePageUrlClick(a,null,null,!0)},parseNomadnetworkUrl:function(a){if(a.startsWith(":")){var e=a.substring(1);return e===""&&(e=this.defaultNodePagePath),{destination_hash:null,path:e}}if(a.includes(":")){const[t,...s]=a.split(":");if(t.length===32)return{destination_hash:t,path:s.join(":")}}return a.length===32?{destination_hash:a,path:this.defaultNodePagePath}:null},async onNodePageUrlClick(a,e=null,t=!0,s=!1){let o=[];if(e==="*"){s=!1;const r=document.querySelectorAll(".nodeContainer input"),l={};for(const n of r)n.type==="radio"||n.type==="checkbox"?n.checked&&(l[n.name]=n.value):l[n.name||n.id||n.type]=n.value;o=l}else if(e!==null&&e!==""){s=!1;const r=e.split("|"),l=document.querySelectorAll(".nodeContainer input"),n={};for(const c of l)r.includes(c.name)&&(c.type==="radio"||c.type==="checkbox"?c.checked&&(n[c.name]=c.value):n[c.name]=c.value);o=n}if(console.log(o),a.startsWith("http://")||a.startsWith("https://")){window.open(a,"_blank");return}if(a.startsWith("lxmf@")){const r=a.replace("lxmf@","");if(r.length===32){await this.$router.push({name:"messages",params:{destinationHash:r}});return}}const i=this.parseNomadnetworkUrl(a);if(i!=null){const r=i.destination_hash||this.selectedNode.destination_hash;if(i.path.startsWith("/file/")){if(this.isDownloadingNodeFile){N.alert("An existing download is in progress. Please wait for it to finish before starting another download.");return}this.isDownloadingNodeFile=!0,this.nodeFilePath=i.path.split("/").pop(),this.nodeFileProgress=0,this.downloadNomadNetFile(r,i.path,(l,n)=>{this.isDownloadingNodeFile=!1,this.downloadFileFromBase64(l,n)},l=>{this.isDownloadingNodeFile=!1,N.alert(`Failed to download file: ${l}`)},l=>{this.nodeFileProgress=Math.round(l*100)});return}this.selectedNode=this.nodes[r]||{display_name:"Unknown Node",destination_hash:r},this.loadNodePage(r,i.path,o,t,s);return}N.alert("unsupported url: "+a)},downloadFileFromBase64:async function(a,e){const t=atob(e),s=new Array(t.length);for(let n=0;n<t.length;n++)s[n]=t.charCodeAt(n);const o=new Uint8Array(s),i=new Blob([o]),r=URL.createObjectURL(i),l=document.createElement("a");l.href=r,l.download=a,l.style.display="none",document.body.append(l),l.click(),l.remove(),setTimeout(()=>URL.revokeObjectURL(r),1e4)},onNodeClick:function(a){this.selectedNode=a,this.loadNodePage(a.destination_hash,this.defaultNodePagePath)},onCloseNodeViewer:function(){this.selectedNode=null,this.$router.replace({name:"nomadnetwork"})},getNomadnetPageDownloadCallbackKey:function(a,e){return`${a}:${e}`},getNomadnetFileDownloadCallbackKey:function(a,e){return`${a}:${e}`},async getNodePath(a){this.selectedNodePath=null;try{const e=await window.axios.get(`/api/v1/destination/${a}/path`);this.selectedNodePath=e.data.path}catch(e){console.log(e)}},downloadNomadNetFile(a,e,t,s,o){try{this.nomadnetFileDownloadCallbacks[this.getNomadnetFileDownloadCallbackKey(a,e)]={onSuccessCallback:t,onFailureCallback:s,onProgressCallback:o},x.send(JSON.stringify({type:"nomadnet.file.download",nomadnet_file_download:{destination_hash:a,file_path:e}}))}catch(i){console.error(i)}},downloadNomadNetPage(a,e,t,s,o,i){try{this.nomadnetPageDownloadCallbacks[this.getNomadnetPageDownloadCallbackKey(a,e)]={onSuccessCallback:s,onFailureCallback:o,onProgressCallback:i},x.send(JSON.stringify({type:"nomadnet.page.download",nomadnet_page_download:{destination_hash:a,page_path:e,field_data:t}}))}catch(r){console.error(r)}},renderedNodePageContent(){return this.renderPageContent(this.nodePagePath,this.nodePageContent)}}},ce={class:"flex flex-col flex-1 overflow-hidden min-w-full sm:min-w-[500px] dark:bg-zinc-950"},ue={key:0,class:"flex flex-col h-full bg-white dark:bg-zinc-950 overflow-hidden sm:m-2 sm:border dark:border-zinc-800 sm:rounded-xl sm:shadow dark:shadow-zinc-900"},ge={class:"flex p-2 border-b border-gray-300 dark:border-zinc-800"},he={class:"my-auto dark:text-gray-100"},fe={class:"font-semibold"},pe={class:"my-auto ml-auto mr-2"},me=d("div",{class:"flex text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-zinc-800 hover:bg-gray-200 dark:hover:bg-zinc-700 p-1 rounded-full"},[d("div",null,[d("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",class:"w-5 h-5"},[d("path",{d:"M6.28 5.22a.75.75 0 0 0-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 1 0 1.06 1.06L10 11.06l3.72 3.72a.75.75 0 1 0 1.06-1.06L11.06 10l3.72-3.72a.75.75 0 0 0-1.06-1.06L10 8.94 6.28 5.22Z"})])])],-1),be=[me],ke={class:"flex w-full border-gray-300 dark:border-zinc-800 border-b p-2"},ye=d("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",class:"w-5 h-5"},[d("path",{"fill-rule":"evenodd",d:"M9.293 2.293a1 1 0 0 1 1.414 0l7 7A1 1 0 0 1 17 11h-1v6a1 1 0 0 1-1 1h-2a1 1 0 0 1-1-1v-3a1 1 0 0 0-1-1H9a1 1 0 0 0-1 1v3a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-6H3a1 1 0 0 1-.707-1.707l7-7Z","clip-rule":"evenodd"})],-1),we=[ye],_e=d("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",class:"w-5 h-5"},[d("path",{"fill-rule":"evenodd",d:"M15.312 11.424a5.5 5.5 0 0 1-9.201 2.466l-.312-.311h2.433a.75.75 0 0 0 0-1.5H3.989a.75.75 0 0 0-.75.75v4.242a.75.75 0 0 0 1.5 0v-2.43l.31.31a7 7 0 0 0 11.712-3.138.75.75 0 0 0-1.449-.39Zm1.23-3.723a.75.75 0 0 0 .219-.53V2.929a.75.75 0 0 0-1.5 0V5.36l-.31-.31A7 7 0 0 0 3.239 8.188a.75.75 0 1 0 1.448.389A5.5 5.5 0 0 1 13.89 6.11l.311.31h-2.432a.75.75 0 0 0 0 1.5h4.243a.75.75 0 0 0 .53-.219Z","clip-rule":"evenodd"})],-1),ve=[_e],Pe=d("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"size-5"},[d("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M17.25 6.75 22.5 12l-5.25 5.25m-10.5 0L1.5 12l5.25-5.25m7.5-3-4.5 16.5"})],-1),Ne=[Pe],Ce=["disabled"],xe=d("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",class:"w-5 h-5"},[d("path",{"fill-rule":"evenodd",d:"M17 10a.75.75 0 0 1-.75.75H5.612l4.158 3.96a.75.75 0 1 1-1.04 1.08l-5.5-5.25a.75.75 0 0 1 0-1.08l5.5-5.25a.75.75 0 1 1 1.04 1.08L5.612 9.25H16.25A.75.75 0 0 1 17 10Z","clip-rule":"evenodd"})],-1),Se=[xe],Te={class:"my-auto mx-2 w-full"},Ee=d("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",class:"w-5 h-5"},[d("path",{"fill-rule":"evenodd",d:"M3 10a.75.75 0 0 1 .75-.75h10.638L10.23 5.29a.75.75 0 1 1 1.04-1.08l5.5 5.25a.75.75 0 0 1 0 1.08l-5.5 5.25a.75.75 0 1 1-1.04-1.08l4.158-3.96H3.75A.75.75 0 0 1 3 10Z","clip-rule":"evenodd"})],-1),De=[Ee],Le={class:"h-full overflow-y-scroll p-3 bg-black text-white nodeContainer"},Ae={key:0,class:"flex"},Fe=d("div",{class:"my-auto"},[d("svg",{class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[d("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),d("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})])],-1),Ue={class:"my-auto"},ze=["innerHTML"],Me={key:0,class:"flex w-full border-gray-300 dark:border-zinc-800 border-t p-2 dark:text-gray-100"},Be=d("div",{class:"my-auto mr-2"},[d("svg",{class:"animate-spin h-5 w-5",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[d("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),d("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})])],-1),He={class:"my-auto"},Oe={key:1,class:"flex flex-col mx-auto my-auto text-center leading-5 dark:text-gray-100"},je=d("div",{class:"mx-auto mb-1"},[d("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-6 h-6 dark:text-gray-300"},[d("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 21a9.004 9.004 0 0 0 8.716-6.747M12 21a9.004 9.004 0 0 1-8.716-6.747M12 21c2.485 0 4.5-4.03 4.5-9S14.485 3 12 3m0 18c-2.485 0-4.5-4.03-4.5-9S9.515 3 12 3m0 0a8.997 8.997 0 0 1 7.843 4.582M12 3a8.997 8.997 0 0 0-7.843 4.582m15.686 0A11.953 11.953 0 0 1 12 10.5c-2.998 0-5.74-1.1-7.843-2.918m15.686 0A8.959 8.959 0 0 1 21 12c0 .778-.099 1.533-.284 2.253m0 0A17.919 17.919 0 0 1 12 16.5c-3.162 0-6.133-.815-8.716-2.247m0 0A9.015 9.015 0 0 1 3 12c0-1.605.42-3.113 1.157-4.418"})])],-1),qe=d("div",{class:"font-semibold"},"No Active Node",-1),Re=d("div",null,"Select a Node to start browsing!",-1),Ie={class:"mx-auto mt-2"};function Ke(a,e,t,s,o,i){var l;const r=L("NomadNetworkSidebar");return g(),h(U,null,[z(r,{nodes:o.nodes,"selected-destination-hash":(l=o.selectedNode)==null?void 0:l.destination_hash,onNodeClick:i.onNodeClick},null,8,["nodes","selected-destination-hash","onNodeClick"]),d("div",ce,[o.selectedNode?(g(),h("div",ue,[d("div",ge,[d("div",he,[d("span",fe,y(o.selectedNode.display_name),1),o.selectedNodePath?(g(),h("span",{key:0,onClick:e[0]||(e[0]=n=>i.onDestinationPathClick(o.selectedNodePath)),class:"text-sm cursor-pointer"}," - "+y(o.selectedNodePath.hops)+" "+y(o.selectedNodePath.hops===1?"hop":"hops")+" away",1)):C("",!0)]),d("div",pe,[d("div",{onClick:e[1]||(e[1]=(...n)=>i.onCloseNodeViewer&&i.onCloseNodeViewer(...n)),class:"cursor-pointer"},be)])]),d("div",ke,[d("button",{onClick:e[2]||(e[2]=n=>i.loadNodePage(o.selectedNode.destination_hash,o.defaultNodePagePath)),type:"button",class:"my-auto text-gray-500 dark:text-gray-300 bg-gray-200 dark:bg-zinc-800 hover:bg-gray-300 dark:hover:bg-zinc-700 rounded p-1 cursor-pointer"},we),d("button",{onClick:e[3]||(e[3]=(...n)=>i.reloadNodePage&&i.reloadNodePage(...n)),type:"button",class:"ml-1 my-auto text-gray-500 dark:text-gray-300 bg-gray-200 dark:bg-zinc-800 hover:bg-gray-300 dark:hover:bg-zinc-700 rounded p-1 cursor-pointer"},ve),d("button",{onClick:e[4]||(e[4]=(...n)=>i.toggleNodePageSource&&i.toggleNodePageSource(...n)),type:"button",title:"Toggle Source Code",class:S(["ml-1 my-auto text-gray-500 dark:text-gray-300 rounded p-1 cursor-pointer",[o.isShowingNodePageSource?"bg-green-500 hover:bg-green-600 text-white":"bg-gray-200 dark:bg-zinc-800 hover:bg-gray-300 dark:hover:bg-zinc-700"]])},Ne,2),d("button",{onClick:e[5]||(e[5]=(...n)=>i.loadPreviousNodePage&&i.loadPreviousNodePage(...n)),type:"button",disabled:o.nodePagePathHistory.length===0,class:S([[o.nodePagePathHistory.length>0?"text-gray-500 dark:text-gray-300 bg-gray-200 dark:bg-zinc-800 hover:bg-gray-300 dark:hover:bg-zinc-700":"text-gray-400 dark:text-gray-500 bg-gray-100 dark:bg-zinc-900"],"ml-1 my-auto rounded p-1 cursor-pointer"])},Se,10,Ce),d("div",Te,[A(d("input",{"onUpdate:modelValue":e[6]||(e[6]=n=>o.nodePagePathUrlInput=n),onKeyup:e[7]||(e[7]=j(n=>i.onNodePageUrlClick(o.nodePagePathUrlInput),["enter"])),type:"text",placeholder:"Enter Destination URL",class:"bg-gray-50 dark:bg-zinc-900 border border-gray-300 dark:border-zinc-700 text-gray-900 dark:text-gray-100 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full px-2.5 py-1.5 dark:placeholder-gray-400"},null,544),[[F,o.nodePagePathUrlInput]])]),d("button",{onClick:e[8]||(e[8]=n=>i.onNodePageUrlClick(o.nodePagePathUrlInput)),type:"button",class:"my-auto text-gray-500 dark:text-gray-300 bg-gray-200 dark:bg-zinc-800 hover:bg-gray-300 dark:hover:bg-zinc-700 rounded p-1 cursor-pointer"},De)]),d("div",Le,[o.isLoadingNodePage?(g(),h("div",Ae,[Fe,d("div",Ue,"Loading "+y(o.nodePageProgress)+"%",1)])):(g(),h("pre",{key:1,innerHTML:i.renderedNodePageContent(),class:"h-full break-words whitespace-pre-wrap"},null,8,ze))]),o.isDownloadingNodeFile?(g(),h("div",Me,[Be,d("div",He,"Downloading: "+y(o.nodeFilePath)+" ("+y(o.nodeFileProgress)+"%)",1)])):C("",!0)])):(g(),h("div",Oe,[je,qe,Re,d("div",Ie,[d("button",{onClick:e[9]||(e[9]=q((...n)=>i.openUrl&&i.openUrl(...n),["stop"])),type:"button",class:"my-auto inline-flex items-center gap-x-1 rounded-md bg-gray-500 px-2 py-1 text-sm font-semibold text-white shadow-sm hover:bg-gray-400 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-gray-500 dark:bg-zinc-800 dark:text-white dark:hover:bg-zinc-700 dark:focus-visible:outline-zinc-500"}," Open a Nomadnet URL ")])]))])],64)}const Ge=D(de,[["render",Ke]]);export{Ge as default};
