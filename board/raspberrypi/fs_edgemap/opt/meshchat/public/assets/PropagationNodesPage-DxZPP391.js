import{_ as p,W as g,U as f,o as a,c as n,h as m,v as b,a as e,b as l,F as x,f as v,t as d,d as u}from"./app-CqTJZnNE.js";const y={name:"PropagationNodesPage",data(){return{searchTerm:"",propagationNodes:[],config:{lxmf_preferred_propagation_node_destination_hash:null}}},beforeUnmount(){g.off("message",this.onWebsocketMessage)},mounted(){g.on("message",this.onWebsocketMessage),this.getConfig(),this.loadPropagationNodes()},methods:{async onWebsocketMessage(o){const s=JSON.parse(o.data);switch(s.type){case"config":{this.config=s.config;break}}},async getConfig(){try{const o=await window.axios.get("/api/v1/config");this.config=o.data.config}catch(o){console.log(o)}},async updateConfig(o){try{const s=await window.axios.patch("/api/v1/config",o);this.config=s.data.config}catch(s){alert("Failed to save config!"),console.log(s)}},async loadPropagationNodes(){try{const o=await window.axios.get("/api/v1/lxmf/propagation-nodes",{params:{limit:500}});this.propagationNodes=o.data.lxmf_propagation_nodes}catch{}},async usePropagationNode(o){await this.updateConfig({lxmf_preferred_propagation_node_destination_hash:o})},async stopUsingPropagationNode(){await this.updateConfig({lxmf_preferred_propagation_node_destination_hash:null})},formatTimeAgo:function(o){return f.formatTimeAgo(o)}},computed:{searchedPropagationNodes(){return this.propagationNodes.filter(o=>{var t,i;const s=this.searchTerm.toLowerCase(),c=((i=(t=o.operator_display_name)==null?void 0:t.toLowerCase())==null?void 0:i.includes(s))??!1,h=o.destination_hash.toLowerCase().includes(s);return c||h})}}},w={class:"flex flex-col flex-1 overflow-hidden min-w-full sm:min-w-[500px]"},k={key:0,class:"flex bg-white p-1 border-b border-gray-300"},N=["placeholder"],P={class:"h-full overflow-y-auto"},C={key:0,class:"p-2 space-y-2 w-full"},T={class:"border rounded bg-white shadow"},U={class:"p-1 flex"},S={class:"my-auto"},A={class:"font-semibold"},L={class:"text-sm"},B={class:"ml-auto my-auto"},D=["onClick"],M={class:"bg-gray-50 p-1"},V={class:"text-gray-500 text-sm"},W={key:0},O=e("span",null,[u(" • "),e("span",{class:"text-red-500"},"Disabled by Operator")],-1),j=[O],F={key:1},H=e("span",null,[u(" • "),e("span",{class:"text-green-500"},"Preferred")],-1),R=[H],Z={key:1,class:"flex h-full"},z={class:"mx-auto my-auto text-center leading-5"},E={key:0,class:"flex flex-col"},J=e("div",{class:"mx-auto mb-1"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"size-6"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M2.25 13.5h3.86a2.25 2.25 0 0 1 2.012 1.244l.256.512a2.25 2.25 0 0 0 2.013 1.244h3.218a2.25 2.25 0 0 0 2.013-1.244l.256-.512a2.25 2.25 0 0 1 2.013-1.244h3.859m-19.5.338V18a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18v-4.162c0-.224-.034-.447-.1-.661L19.24 5.338a2.25 2.25 0 0 0-2.15-1.588H6.911a2.25 2.25 0 0 0-2.15 1.588L2.35 13.177a2.25 2.25 0 0 0-.1.661Z"})])],-1),Y=e("div",{class:"font-semibold"},"No Propagation Nodes",-1),q=e("div",null,"Check back later, once someone has announced.",-1),G={class:"mt-2"},I={key:1,class:"flex flex-col"},K=e("div",{class:"mx-auto mb-1"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-6 h-6"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"})])],-1),Q=e("div",{class:"font-semibold"},"No Search Results",-1),X=e("div",null,"Your search didn't match any Propagation Nodes!",-1),$=[K,Q,X];function ee(o,s,c,h,t,i){return a(),n("div",w,[t.propagationNodes.length>0?(a(),n("div",k,[m(e("input",{"onUpdate:modelValue":s[0]||(s[0]=r=>t.searchTerm=r),type:"text",placeholder:`Search ${t.propagationNodes.length} Propagation Nodes...`,class:"w-full bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"},null,8,N),[[b,t.searchTerm]])])):l("",!0),e("div",P,[i.searchedPropagationNodes.length>0?(a(),n("div",C,[(a(!0),n(x,null,v(i.searchedPropagationNodes,r=>(a(),n("div",T,[e("div",U,[e("div",S,[e("div",A,d(r.operator_display_name??"Unknown Operator"),1),e("div",L,"<"+d(r.destination_hash)+">",1)]),e("div",B,[t.config.lxmf_preferred_propagation_node_destination_hash===r.destination_hash?(a(),n("button",{key:0,onClick:s[1]||(s[1]=(..._)=>i.stopUsingPropagationNode&&i.stopUsingPropagationNode(..._)),type:"button",class:"my-auto inline-flex items-center gap-x-1 rounded-md bg-red-500 px-2 py-1 text-sm font-semibold text-white shadow-sm hover:bg-red-400 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-red-500"}," Stop Using Node ")):(a(),n("button",{key:1,onClick:_=>i.usePropagationNode(r.destination_hash),type:"button",class:"my-auto inline-flex items-center gap-x-1 rounded-md bg-gray-500 px-2 py-1 text-sm font-semibold text-white shadow-sm hover:bg-gray-400 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-gray-500"}," Set as Preferred ",8,D))])]),e("div",M,[e("div",V,[e("span",null,"Announced "+d(i.formatTimeAgo(r.updated_at)),1),r.is_propagation_enabled===!1?(a(),n("span",W,j)):l("",!0),t.config.lxmf_preferred_propagation_node_destination_hash===r.destination_hash?(a(),n("span",F,R)):l("",!0)])])]))),256))])):(a(),n("div",Z,[e("div",z,[t.propagationNodes.length===0?(a(),n("div",E,[J,Y,q,e("div",G,[e("button",{onClick:s[2]||(s[2]=(...r)=>i.loadPropagationNodes&&i.loadPropagationNodes(...r)),type:"button",class:"my-auto inline-flex items-center gap-x-1 rounded-md bg-gray-500 px-2 py-1 text-sm font-semibold text-white shadow-sm hover:bg-gray-400 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-gray-500"}," Reload ")])])):l("",!0),t.searchTerm!==""&&t.propagationNodes.length>0?(a(),n("div",I,$)):l("",!0)])]))])])}const se=p(y,[["render",ee]]);export{se as default};
